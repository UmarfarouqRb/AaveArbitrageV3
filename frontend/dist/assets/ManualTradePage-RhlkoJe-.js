import{d1 as G,d2 as K,d3 as Y,cW as r,cX as e}from"./index-LR5GKwfl.js";const R=void 0;throw new Error("Fatal Error: VITE_API_URL is not set in the production environment.");const q=`${R}/api/simulate-trade`,z=`${R}/api/prepare-trade`,Q={"base-mainnet":"https://basescan.org","base-sepolia":"https://sepolia.basescan.org"},C={base:{WETH:"0x4200000000000000000000000000000000000006",USDC:"0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",cbBTC:"0xcbB7C0000aB88B473b1f5aFd9ef808440eed33Bf",DAI:"0x50c5725949a6f0c72e6c4a641f24049a917db0cb",DEGEN:"0x4ed4e862860bed51a9570b96d89af5e1b0efefed",BRETT:"0x532f27101965dd16442e59d40670faf2ebb144e4",AERO:"0x940181a94a35a4569e4529a3cdfb74e38fd98631"}},x=["Aerodrome","PancakeSwap"],Z=()=>{var D;const{network:u}=G(),{user:$}=K(),{wallets:L}=Y(),[o,F]=r.useState(((D=C[u])==null?void 0:D.USDC)||""),[l,O]=r.useState(""),[c,B]=r.useState("1000"),[m,I]=r.useState(x[0]),[b,w]=r.useState(x[1]),[h,_]=r.useState(!0),[S,E]=r.useState(!1),[v,f]=r.useState(null),[j,y]=r.useState(null),[k,P]=r.useState(!1),[a,T]=r.useState(null),[A,N]=r.useState(null),p=t=>{const s=Object.entries(C[u]||{});for(const[n,i]of s)if(i.toLowerCase()===t.toLowerCase())return n;return t.substring(0,6)},U=t=>{const s=t.target.value;I(s),w(s===x[0]?x[1]:x[0])},H=r.useCallback(async()=>{if(!o||!l||!c){N("Please fill in all fields.");return}P(!0),N(null),T(null);try{const s=await fetch(q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({network:u,tokenA:o,tokenB:l,loanAmount:c,dex1:m,dex2:b,stable:h})});if(!s.ok){const i=await s.json();throw new Error(i.message||"Simulation failed")}const n=await s.json();T(n)}catch(t){N(t.message)}finally{P(!1)}},[u,o,l,c,m,b,h]),X=async()=>{if(!a||!a.isProfitable){f("No profitable trade to execute.");return}E(!0),f(null),y(null);const t=async s=>{try{await fetch("/api/manual-trade-history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}catch(n){console.error("Failed to save manual trade history:",n)}};try{const s=L[0];if(!s)throw new Error("No wallet connected.");const n={network:u,tokenA:o,tokenB:l,loanAmount:c,userAddress:$.wallet.address,dex1:m,dex2:b,bestFee1:a.bestFee1,bestFee2:a.bestFee2,stable:h},i=await fetch(z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){const W=await i.json();throw new Error(W.message||"Failed to prepare trade")}const{unsignedTx:d}=await i.json(),J=await(await s.getEthersProvider()).getSigner();d.gasPrice&&(d.gasPrice=BigInt(d.gasPrice)),d.gasLimit&&(d.gasLimit=BigInt(d.gasLimit));const g=await J.sendTransaction(d);y({txHash:g.hash,status:"pending"}),await g.wait(),y({txHash:g.hash,status:"success",profit:"View on explorer"}),await t({timestamp:new Date().toISOString(),pair:`${p(o)} -> ${p(l)}`,route:`${m} -> ${b}`,loanAmount:`${c} ${p(o)}`,status:"Success",actualProfit:a.estimatedProfit,txHash:g.hash,error:null})}catch(s){console.error("Execution Error:",s);const n=s.message||"An unexpected error occurred.";f(n),await t({timestamp:new Date().toISOString(),pair:`${p(o)} -> ${p(l)}`,route:`${m} -> ${b}`,loanAmount:`${c} ${p(o)}`,status:"Failed",actualProfit:"N/A",txHash:null,error:n})}finally{E(!1)}},M=a&&a.isProfitable,V=Q[u]||"https://basescan.org";return e.jsxs("div",{className:"max-w-lg mx-auto bg-card-background p-4 sm:p-6 rounded-2xl border border-border-color",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-text-primary",children:"Manual Arbitrage"}),e.jsxs("div",{className:"bg-background p-4 rounded-xl mb-2",children:[e.jsx("label",{className:"text-xs text-text-secondary",children:"Loan Token"}),e.jsx("input",{type:"text",value:o,onChange:t=>F(t.target.value),className:"w-full bg-transparent text-2xl font-mono text-text-primary focus:outline-none"})]}),e.jsxs("div",{className:"bg-background p-4 rounded-xl mb-4",children:[e.jsx("label",{className:"text-xs text-text-secondary",children:"Target Token"}),e.jsx("input",{type:"text",value:l,onChange:t=>O(t.target.value),className:"w-full bg-transparent text-2xl font-mono text-text-primary focus:outline-none"})]}),e.jsxs("div",{className:"bg-background p-4 rounded-xl mb-4",children:[e.jsx("label",{className:"text-xs text-text-secondary",children:"Loan Amount"}),e.jsx("input",{type:"text",value:c,onChange:t=>B(t.target.value),className:"w-full bg-transparent text-2xl font-mono text-text-primary focus:outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-background p-3 rounded-xl",children:[e.jsx("label",{className:"text-xs text-text-secondary",children:"DEX 1"}),e.jsx("select",{value:m,onChange:U,className:"w-full bg-transparent text-text-primary focus:outline-none",children:x.map(t=>e.jsx("option",{value:t,className:"bg-background",children:t},t))})]}),e.jsxs("div",{className:"bg-background p-3 rounded-xl",children:[e.jsx("label",{className:"text-xs text-text-secondary",children:"DEX 2"}),e.jsx("select",{value:b,onChange:t=>w(t.target.value),className:"w-full bg-transparent text-text-primary focus:outline-none",children:x.map(t=>e.jsx("option",{value:t,className:"bg-background",children:t},t))})]})]}),e.jsxs("div",{className:"flex items-center justify-center mb-6",children:[e.jsx("input",{type:"checkbox",id:"volatile-swap",checked:!h,onChange:t=>_(!t.target.checked),className:"h-4 w-4 rounded border-border-color text-primary-button-bg focus:ring-primary-button-bg"}),e.jsx("label",{htmlFor:"volatile-swap",className:"ml-2 text-sm text-text-secondary",children:"Volatile Swap"})]}),e.jsx("button",{onClick:H,disabled:k,className:"w-full font-bold py-3 px-4 rounded-xl transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-lg bg-primary-button-bg text-primary-button-text hover:bg-primary-button-hover-bg",children:k?"Simulating...":"Simulate Trade"}),A&&e.jsxs("p",{className:"text-error-color mt-4 text-center",children:["Simulation Error: ",A]}),a&&e.jsxs("div",{className:"mt-6 p-4 bg-background rounded-xl",children:[e.jsx("h3",{className:"font-bold text-lg text-text-primary mb-2",children:"Simulation Result"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Estimated Profit:"})," ",e.jsx("span",{className:a.isProfitable?"text-success-color":"text-error-color",children:a.estimatedProfit})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Is Profitable:"})," ",e.jsx("span",{className:a.isProfitable?"text-success-color":"text-error-color",children:a.isProfitable?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Fee (DEX 1):"})," ",e.jsx("span",{children:a.bestFee1})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Fee (DEX 2):"})," ",e.jsx("span",{children:a.bestFee2})]})]}),M&&e.jsx("button",{onClick:X,disabled:S,className:"w-full font-bold py-3 px-4 rounded-xl transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-lg bg-accent-bg text-accent-text hover:bg-accent-hover-bg mt-4",children:S?"Executing...":"Execute Trade"})]}),v&&e.jsxs("p",{className:"text-error-color mt-4 text-center",children:["Execution Error: ",v]}),j&&e.jsxs("div",{className:"mt-6 p-4 bg-background rounded-xl text-center",children:[e.jsxs("p",{className:"font-bold text-lg",children:["Status: ",j.status]}),e.jsx("a",{href:`${V}/tx/${j.txHash}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary-button-bg hover:underline mt-2 inline-block",children:"View on Explorer"})]})]})},se=()=>e.jsx(Z,{});export{se as default};
