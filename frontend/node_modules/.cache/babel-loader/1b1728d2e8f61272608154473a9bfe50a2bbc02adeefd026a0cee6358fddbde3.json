{"ast":null,"code":"import { useQuery } from \"@tanstack/react-query\";\nimport { toFunctionSelector } from \"viem\";\nimport { NATIVE_TOKEN_ADDRESS } from \"../../../constants/addresses.js\";\nimport { getCompilerMetadata } from \"../../../contract/actions/get-compiler-metadata.js\";\nimport { getContract } from \"../../../contract/contract.js\";\nimport { decimals } from \"../../../extensions/erc20/read/decimals.js\";\nimport { getToken } from \"../../../pay/convert/get-token.js\";\nimport { encode } from \"../../../transaction/actions/encode.js\";\nimport { getTransactionGasCost } from \"../../../transaction/utils.js\";\nimport { stringify } from \"../../../utils/json.js\";\nimport { resolvePromisedValue } from \"../../../utils/promise/resolve-promised-value.js\";\nimport { toTokens } from \"../../../utils/units.js\";\nimport { hasSponsoredTransactionsEnabled } from \"../../../wallets/smart/is-smart-wallet.js\";\nimport { formatTokenAmount } from \"../../web/ui/ConnectWallet/screens/formatTokenBalance.js\";\nimport { useChainMetadata } from \"./others/useChainQuery.js\";\n/**\n * Hook to fetch comprehensive transaction details including contract metadata,\n * function information, cost calculations, and gas estimates.\n */\nexport function useTransactionDetails(_ref) {\n  let {\n    transaction,\n    client,\n    wallet\n  } = _ref;\n  const chainMetadata = useChainMetadata(transaction.chain);\n  const hasSponsoredTransactions = hasSponsoredTransactionsEnabled(wallet);\n  return useQuery({\n    enabled: !!transaction.to && !!chainMetadata.data,\n    queryFn: async () => {\n      var _chainMetadata$data;\n      const contract = getContract({\n        address: transaction.to,\n        chain: transaction.chain,\n        client\n      });\n      const [contractMetadata, value, erc20Value, transactionData] = await Promise.all([getCompilerMetadata(contract).catch(() => null), resolvePromisedValue(transaction.value), resolvePromisedValue(transaction.erc20Value), encode(transaction).catch(() => \"0x\")]);\n      const [tokenInfo, gasCostWei] = await Promise.all([getToken(client, (erc20Value === null || erc20Value === void 0 ? void 0 : erc20Value.tokenAddress) || NATIVE_TOKEN_ADDRESS, transaction.chain.id), hasSponsoredTransactions ? 0n : getTransactionGasCost(transaction).catch(() => null)]);\n      // Process function info from ABI if available\n      let functionInfo = {\n        description: undefined,\n        functionName: \"Contract Call\",\n        selector: \"0x\"\n      };\n      if (contractMetadata !== null && contractMetadata !== void 0 && contractMetadata.abi && transactionData.length >= 10) {\n        try {\n          const selector = transactionData.slice(0, 10);\n          const abi = contractMetadata.abi;\n          // Find matching function in ABI\n          const abiItems = Array.isArray(abi) ? abi : [];\n          const functions = abiItems.filter(item => item && typeof item === \"object\" && \"type\" in item && item.type === \"function\").map(item => item);\n          const matchingFunction = functions.find(fn => {\n            return toFunctionSelector(fn) === selector;\n          });\n          if (matchingFunction) {\n            functionInfo = {\n              description: undefined,\n              functionName: matchingFunction.name,\n              selector // Skip devdoc for now\n            };\n          }\n        } catch (_unused) {\n          // Keep default values\n        }\n      }\n      const resolveDecimals = async () => {\n        if (tokenInfo) {\n          return tokenInfo.decimals;\n        }\n        if (erc20Value) {\n          return decimals({\n            contract: getContract({\n              address: erc20Value.tokenAddress,\n              chain: transaction.chain,\n              client\n            })\n          });\n        }\n        return 18;\n      };\n      const decimal = await resolveDecimals();\n      const costWei = erc20Value ? erc20Value.amountWei : value || 0n;\n      const nativeTokenSymbol = ((_chainMetadata$data = chainMetadata.data) === null || _chainMetadata$data === void 0 || (_chainMetadata$data = _chainMetadata$data.nativeCurrency) === null || _chainMetadata$data === void 0 ? void 0 : _chainMetadata$data.symbol) || \"ETH\";\n      const tokenSymbol = (tokenInfo === null || tokenInfo === void 0 ? void 0 : tokenInfo.symbol) || nativeTokenSymbol;\n      const totalCostWei = erc20Value && erc20Value.tokenAddress.toLowerCase() !== NATIVE_TOKEN_ADDRESS ? erc20Value.amountWei : (value || 0n) + (gasCostWei || 0n);\n      const totalCost = toTokens(totalCostWei, decimal);\n      return {\n        contractMetadata,\n        costWei,\n        functionInfo,\n        gasCostDisplay: gasCostWei ? \"\".concat(formatTokenAmount(gasCostWei, 18), \" \").concat(nativeTokenSymbol) : null,\n        gasCostWei,\n        tokenInfo,\n        totalCost,\n        totalCostWei,\n        txCostDisplay: \"\".concat(formatTokenAmount(costWei, decimal), \" \").concat(tokenSymbol)\n      };\n    },\n    queryKey: [\"transaction-details\", stringify(transaction), hasSponsoredTransactions]\n  });\n}","map":{"version":3,"names":["useQuery","toFunctionSelector","NATIVE_TOKEN_ADDRESS","getCompilerMetadata","getContract","decimals","getToken","encode","getTransactionGasCost","stringify","resolvePromisedValue","toTokens","hasSponsoredTransactionsEnabled","formatTokenAmount","useChainMetadata","useTransactionDetails","_ref","transaction","client","wallet","chainMetadata","chain","hasSponsoredTransactions","enabled","to","data","queryFn","_chainMetadata$data","contract","address","contractMetadata","value","erc20Value","transactionData","Promise","all","catch","tokenInfo","gasCostWei","tokenAddress","id","functionInfo","description","undefined","functionName","selector","abi","length","slice","abiItems","Array","isArray","functions","filter","item","type","map","matchingFunction","find","fn","name","_unused","resolveDecimals","decimal","costWei","amountWei","nativeTokenSymbol","nativeCurrency","symbol","tokenSymbol","totalCostWei","toLowerCase","totalCost","gasCostDisplay","concat","txCostDisplay","queryKey"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/react/core/hooks/useTransactionDetails.ts"],"sourcesContent":["import { useQuery } from \"@tanstack/react-query\";\nimport type { AbiFunction } from \"abitype\";\nimport { toFunctionSelector } from \"viem\";\nimport type { TokenWithPrices } from \"../../../bridge/index.js\";\nimport type { ThirdwebClient } from \"../../../client/client.js\";\nimport { NATIVE_TOKEN_ADDRESS } from \"../../../constants/addresses.js\";\nimport type { CompilerMetadata } from \"../../../contract/actions/compiler-metadata.js\";\nimport { getCompilerMetadata } from \"../../../contract/actions/get-compiler-metadata.js\";\nimport { getContract } from \"../../../contract/contract.js\";\nimport { decimals } from \"../../../extensions/erc20/read/decimals.js\";\nimport { getToken } from \"../../../pay/convert/get-token.js\";\nimport { encode } from \"../../../transaction/actions/encode.js\";\nimport type { PreparedTransaction } from \"../../../transaction/prepare-transaction.js\";\nimport { getTransactionGasCost } from \"../../../transaction/utils.js\";\nimport { stringify } from \"../../../utils/json.js\";\nimport { resolvePromisedValue } from \"../../../utils/promise/resolve-promised-value.js\";\nimport { toTokens } from \"../../../utils/units.js\";\nimport type { Wallet } from \"../../../wallets/interfaces/wallet.js\";\nimport { hasSponsoredTransactionsEnabled } from \"../../../wallets/smart/is-smart-wallet.js\";\nimport { formatTokenAmount } from \"../../web/ui/ConnectWallet/screens/formatTokenBalance.js\";\nimport { useChainMetadata } from \"./others/useChainQuery.js\";\n\ninterface TransactionDetails {\n  contractMetadata: CompilerMetadata | null;\n  functionInfo: {\n    functionName: string;\n    selector: string;\n    description?: string;\n  };\n  txCostDisplay: string;\n  gasCostDisplay: string | null;\n  tokenInfo: TokenWithPrices | null;\n  costWei: bigint;\n  gasCostWei: bigint | null;\n  totalCost: string;\n  totalCostWei: bigint;\n}\n\ninterface UseTransactionDetailsOptions {\n  transaction: PreparedTransaction;\n  client: ThirdwebClient;\n  wallet: Wallet | undefined;\n}\n\n/**\n * Hook to fetch comprehensive transaction details including contract metadata,\n * function information, cost calculations, and gas estimates.\n */\nexport function useTransactionDetails({\n  transaction,\n  client,\n  wallet,\n}: UseTransactionDetailsOptions) {\n  const chainMetadata = useChainMetadata(transaction.chain);\n  const hasSponsoredTransactions = hasSponsoredTransactionsEnabled(wallet);\n\n  return useQuery({\n    enabled: !!transaction.to && !!chainMetadata.data,\n    queryFn: async (): Promise<TransactionDetails> => {\n      const contract = getContract({\n        address: transaction.to as string,\n        chain: transaction.chain,\n        client,\n      });\n\n      const [contractMetadata, value, erc20Value, transactionData] =\n        await Promise.all([\n          getCompilerMetadata(contract).catch(() => null),\n          resolvePromisedValue(transaction.value),\n          resolvePromisedValue(transaction.erc20Value),\n          encode(transaction).catch(() => \"0x\"),\n        ]);\n\n      const [tokenInfo, gasCostWei] = await Promise.all([\n        getToken(\n          client,\n          erc20Value?.tokenAddress || NATIVE_TOKEN_ADDRESS,\n          transaction.chain.id,\n        ),\n        hasSponsoredTransactions\n          ? 0n\n          : getTransactionGasCost(transaction).catch(() => null),\n      ]);\n\n      // Process function info from ABI if available\n      let functionInfo = {\n        description: undefined,\n        functionName: \"Contract Call\",\n        selector: \"0x\",\n      };\n\n      if (contractMetadata?.abi && transactionData.length >= 10) {\n        try {\n          const selector = transactionData.slice(0, 10) as `0x${string}`;\n          const abi = contractMetadata.abi;\n\n          // Find matching function in ABI\n          const abiItems = Array.isArray(abi) ? abi : [];\n          const functions = abiItems\n            .filter(\n              (item) =>\n                item &&\n                typeof item === \"object\" &&\n                \"type\" in item &&\n                (item as { type: string }).type === \"function\",\n            )\n            .map((item) => item as AbiFunction);\n\n          const matchingFunction = functions.find((fn) => {\n            return toFunctionSelector(fn) === selector;\n          });\n\n          if (matchingFunction) {\n            functionInfo = {\n              description: undefined,\n              functionName: matchingFunction.name,\n              selector, // Skip devdoc for now\n            };\n          }\n        } catch {\n          // Keep default values\n        }\n      }\n\n      const resolveDecimals = async () => {\n        if (tokenInfo) {\n          return tokenInfo.decimals;\n        }\n        if (erc20Value) {\n          return decimals({\n            contract: getContract({\n              address: erc20Value.tokenAddress,\n              chain: transaction.chain,\n              client,\n            }),\n          });\n        }\n        return 18;\n      };\n\n      const decimal = await resolveDecimals();\n      const costWei = erc20Value ? erc20Value.amountWei : value || 0n;\n      const nativeTokenSymbol =\n        chainMetadata.data?.nativeCurrency?.symbol || \"ETH\";\n      const tokenSymbol = tokenInfo?.symbol || nativeTokenSymbol;\n\n      const totalCostWei =\n        erc20Value &&\n        erc20Value.tokenAddress.toLowerCase() !== NATIVE_TOKEN_ADDRESS\n          ? erc20Value.amountWei\n          : (value || 0n) + (gasCostWei || 0n);\n      const totalCost = toTokens(totalCostWei, decimal);\n\n      return {\n        contractMetadata,\n        costWei,\n        functionInfo,\n        gasCostDisplay: gasCostWei\n          ? `${formatTokenAmount(gasCostWei, 18)} ${nativeTokenSymbol}`\n          : null,\n        gasCostWei,\n        tokenInfo,\n        totalCost,\n        totalCostWei,\n        txCostDisplay: `${formatTokenAmount(costWei, decimal)} ${tokenSymbol}`,\n      };\n    },\n    queryKey: [\n      \"transaction-details\",\n      stringify(transaction),\n      hasSponsoredTransactions,\n    ],\n  });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}