{"ast":null,"code":"import _objectSpread from \"/home/user/Arbitrage/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { getThirdwebBaseUrl } from \"../../../../../utils/domains.js\";\nimport { getLoginUrl } from \"../../../core/authentication/getLoginPath.js\";\nimport { DEFAULT_POP_UP_SIZE } from \"./constants.js\";\nconst closeWindow = _ref => {\n  let {\n    isWindowOpenedByFn,\n    win,\n    closeOpenedWindow\n  } = _ref;\n  if (isWindowOpenedByFn) {\n    win === null || win === void 0 || win.close();\n  } else {\n    if (win && closeOpenedWindow) {\n      closeOpenedWindow(win);\n    } else if (win) {\n      win.close();\n    }\n  }\n};\nexport async function loginWithOauthRedirect(options) {\n  const loginUrl = getLoginUrl(_objectSpread(_objectSpread({}, options), {}, {\n    mode: options.mode || \"redirect\"\n  }));\n  if (options.mode === \"redirect\") {\n    window.location.href = loginUrl;\n  } else {\n    window.open(loginUrl);\n  }\n  // wait for 5 secs for the redirect to happen\n  // that way it interrupts the rest of the execution that would normally keep connecting\n  await new Promise(resolve => setTimeout(resolve, 5000));\n}\nexport const loginWithOauth = async options => {\n  let win = options.openedWindow;\n  let isWindowOpenedByFn = false;\n  if (!win) {\n    win = window.open(getLoginUrl(_objectSpread(_objectSpread({}, options), {}, {\n      mode: \"popup\"\n    })), \"Login to \".concat(options.authOption), DEFAULT_POP_UP_SIZE);\n    isWindowOpenedByFn = true;\n  }\n  if (!win) {\n    throw new Error(\"Something went wrong opening pop-up\");\n  }\n  const result = await new Promise((resolve, reject) => {\n    // detect when the user closes the login window\n    const pollTimer = window.setInterval(async () => {\n      if (win.closed) {\n        clearInterval(pollTimer);\n        window.removeEventListener(\"message\", messageListener);\n        reject(new Error(\"User closed login window\"));\n      }\n    }, 1000);\n    const messageListener = async event => {\n      if (event.origin !== getThirdwebBaseUrl(\"inAppWallet\")) {\n        return;\n      }\n      if (typeof event.data !== \"object\") {\n        reject(new Error(\"Invalid event data\"));\n        return;\n      }\n      switch (event.data.eventType) {\n        case \"oauthSuccessResult\":\n          {\n            window.removeEventListener(\"message\", messageListener);\n            clearInterval(pollTimer);\n            closeWindow({\n              closeOpenedWindow: options.closeOpenedWindow,\n              isWindowOpenedByFn,\n              win\n            });\n            if (event.data.authResult) {\n              resolve(event.data.authResult);\n            }\n            break;\n          }\n        case \"oauthFailureResult\":\n          {\n            window.removeEventListener(\"message\", messageListener);\n            clearInterval(pollTimer);\n            closeWindow({\n              closeOpenedWindow: options.closeOpenedWindow,\n              isWindowOpenedByFn,\n              win\n            });\n            reject(new Error(event.data.errorString));\n            break;\n          }\n        default:\n          {\n            // no-op, DO NOT THROW HERE\n          }\n      }\n    };\n    window.addEventListener(\"message\", messageListener);\n  });\n  return result;\n};","map":{"version":3,"names":["getThirdwebBaseUrl","getLoginUrl","DEFAULT_POP_UP_SIZE","closeWindow","_ref","isWindowOpenedByFn","win","closeOpenedWindow","close","loginWithOauthRedirect","options","loginUrl","_objectSpread","mode","window","location","href","open","Promise","resolve","setTimeout","loginWithOauth","openedWindow","concat","authOption","Error","result","reject","pollTimer","setInterval","closed","clearInterval","removeEventListener","messageListener","event","origin","data","eventType","authResult","errorString","addEventListener"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/wallets/in-app/web/lib/auth/oauth.ts"],"sourcesContent":["import type { ThirdwebClient } from \"../../../../../client/client.js\";\nimport { getThirdwebBaseUrl } from \"../../../../../utils/domains.js\";\nimport type { OAuthOption } from \"../../../../../wallets/types.js\";\nimport { getLoginUrl } from \"../../../core/authentication/getLoginPath.js\";\nimport type { AuthStoredTokenWithCookieReturnType } from \"../../../core/authentication/types.js\";\nimport type { Ecosystem } from \"../../../core/wallet/types.js\";\nimport { DEFAULT_POP_UP_SIZE } from \"./constants.js\";\n\nconst closeWindow = ({\n  isWindowOpenedByFn,\n  win,\n  closeOpenedWindow,\n}: {\n  win?: Window | null;\n  isWindowOpenedByFn: boolean;\n  closeOpenedWindow?: (openedWindow: Window) => void;\n}) => {\n  if (isWindowOpenedByFn) {\n    win?.close();\n  } else {\n    if (win && closeOpenedWindow) {\n      closeOpenedWindow(win);\n    } else if (win) {\n      win.close();\n    }\n  }\n};\n\nexport async function loginWithOauthRedirect(options: {\n  authOption: OAuthOption;\n  client: ThirdwebClient;\n  ecosystem?: Ecosystem;\n  redirectUrl?: string;\n  mode?: \"redirect\" | \"popup\" | \"window\";\n}): Promise<void> {\n  const loginUrl = getLoginUrl({\n    ...options,\n    mode: options.mode || \"redirect\",\n  });\n  if (options.mode === \"redirect\") {\n    window.location.href = loginUrl;\n  } else {\n    window.open(loginUrl);\n  }\n  // wait for 5 secs for the redirect to happen\n  // that way it interrupts the rest of the execution that would normally keep connecting\n  await new Promise((resolve) => setTimeout(resolve, 5000));\n}\n\nexport const loginWithOauth = async (options: {\n  authOption: OAuthOption;\n  client: ThirdwebClient;\n  ecosystem?: Ecosystem;\n  openedWindow?: Window | null | undefined;\n  closeOpenedWindow?: ((openedWindow: Window) => void) | undefined;\n}): Promise<AuthStoredTokenWithCookieReturnType> => {\n  let win = options.openedWindow;\n  let isWindowOpenedByFn = false;\n  if (!win) {\n    win = window.open(\n      getLoginUrl({ ...options, mode: \"popup\" }),\n      `Login to ${options.authOption}`,\n      DEFAULT_POP_UP_SIZE,\n    );\n    isWindowOpenedByFn = true;\n  }\n  if (!win) {\n    throw new Error(\"Something went wrong opening pop-up\");\n  }\n\n  const result = await new Promise<AuthStoredTokenWithCookieReturnType>(\n    (resolve, reject) => {\n      // detect when the user closes the login window\n      const pollTimer = window.setInterval(async () => {\n        if (win.closed) {\n          clearInterval(pollTimer);\n          window.removeEventListener(\"message\", messageListener);\n          reject(new Error(\"User closed login window\"));\n        }\n      }, 1000);\n\n      const messageListener = async (\n        event: MessageEvent<{\n          eventType: string;\n          authResult?: AuthStoredTokenWithCookieReturnType;\n          errorString?: string;\n        }>,\n      ) => {\n        if (event.origin !== getThirdwebBaseUrl(\"inAppWallet\")) {\n          return;\n        }\n        if (typeof event.data !== \"object\") {\n          reject(new Error(\"Invalid event data\"));\n          return;\n        }\n\n        switch (event.data.eventType) {\n          case \"oauthSuccessResult\": {\n            window.removeEventListener(\"message\", messageListener);\n            clearInterval(pollTimer);\n            closeWindow({\n              closeOpenedWindow: options.closeOpenedWindow,\n              isWindowOpenedByFn,\n              win,\n            });\n            if (event.data.authResult) {\n              resolve(event.data.authResult);\n            }\n            break;\n          }\n          case \"oauthFailureResult\": {\n            window.removeEventListener(\"message\", messageListener);\n            clearInterval(pollTimer);\n            closeWindow({\n              closeOpenedWindow: options.closeOpenedWindow,\n              isWindowOpenedByFn,\n              win,\n            });\n            reject(new Error(event.data.errorString));\n            break;\n          }\n          default: {\n            // no-op, DO NOT THROW HERE\n          }\n        }\n      };\n      window.addEventListener(\"message\", messageListener);\n    },\n  );\n  return result;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}