{"ast":null,"code":"import _objectSpread from \"/home/user/Arbitrage/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { decodeErrorResult } from \"viem\";\nimport { getContract } from \"../../../contract/contract.js\";\nimport { parseEventLogs } from \"../../../event/actions/parse-logs.js\";\nimport { userOperationRevertReasonEvent } from \"../../../extensions/erc4337/__generated__/IEntryPoint/events/UserOperationRevertReason.js\";\nimport { postOpRevertReasonEvent } from \"../../../extensions/erc4337/__generated__/IEntryPoint_v07/events/PostOpRevertReason.js\";\nimport { isContractDeployed } from \"../../../utils/bytecode/is-contract-deployed.js\";\nimport { hexToBigInt } from \"../../../utils/encoding/hex.js\";\nimport { getClientFetch } from \"../../../utils/fetch.js\";\nimport { stringify } from \"../../../utils/json.js\";\nimport { toEther } from \"../../../utils/units.js\";\nimport { getEntrypointFromFactory } from \"../index.js\";\nimport { formatUserOperationReceipt } from \"../types.js\";\nimport { predictSmartAccountAddress } from \"./calls.js\";\nimport { ENTRYPOINT_ADDRESS_v0_6, getDefaultBundlerUrl, MANAGED_ACCOUNT_GAS_BUFFER } from \"./constants.js\";\nimport { prepareUserOp } from \"./userop.js\";\nimport { hexlifyUserOp } from \"./utils.js\";\n/**\n * Bundle a user operation.\n * @param args - The options for bundling a user operation.\n * @returns The bundle hash of the user operation.\n * @example\n * ```ts\n * import { bundleUserOp } from \"thirdweb/wallets/smart\";\n *\n * const userOpHash = await bundleUserOp({\n *  userOp,\n *  options,\n * });\n * ```\n * @walletUtils\n */\nexport async function bundleUserOp(args) {\n  var _args$options$entrypo;\n  return sendBundlerRequest(_objectSpread(_objectSpread({}, args), {}, {\n    operation: \"eth_sendUserOperation\",\n    params: [hexlifyUserOp(args.userOp), (_args$options$entrypo = args.options.entrypointAddress) !== null && _args$options$entrypo !== void 0 ? _args$options$entrypo : ENTRYPOINT_ADDRESS_v0_6]\n  }));\n}\n/**\n * Estimate the gas cost of a user operation.\n * @param args - The options for estimating the gas cost of a user operation.\n * @returns The estimated gas cost of the user operation.\n * @example\n * ```ts\n * import { estimateUserOpGas } from \"thirdweb/wallets/smart\";\n *\n * const gasCost = await estimateUserOpGas({\n *  userOp,\n *  options,\n * });\n * ```\n * @walletUtils\n */\nexport async function estimateUserOpGas(args, stateOverrides) {\n  var _args$options$entrypo2;\n  const res = await sendBundlerRequest(_objectSpread(_objectSpread({}, args), {}, {\n    operation: \"eth_estimateUserOperationGas\",\n    params: [hexlifyUserOp(args.userOp), (_args$options$entrypo2 = args.options.entrypointAddress) !== null && _args$options$entrypo2 !== void 0 ? _args$options$entrypo2 : ENTRYPOINT_ADDRESS_v0_6, stateOverrides !== null && stateOverrides !== void 0 ? stateOverrides : {}]\n  }));\n  // add gas buffer for managed account factory delegate calls\n  return {\n    callGasLimit: hexToBigInt(res.callGasLimit) + MANAGED_ACCOUNT_GAS_BUFFER,\n    paymasterPostOpGasLimit: res.paymasterPostOpGasLimit !== undefined ? hexToBigInt(res.paymasterPostOpGasLimit) : undefined,\n    paymasterVerificationGasLimit: res.paymasterVerificationGasLimit !== undefined ? hexToBigInt(res.paymasterVerificationGasLimit) : undefined,\n    preVerificationGas: hexToBigInt(res.preVerificationGas),\n    verificationGas: res.verificationGas !== undefined ? hexToBigInt(res.verificationGas) : undefined,\n    verificationGasLimit: hexToBigInt(res.verificationGasLimit)\n  };\n}\n/**\n * Estimate the gas cost of a user operation.\n * @param args - The options for estimating the gas cost of a user operation.\n * @returns The estimated gas cost of the user operation.\n * @example\n * ```ts\n * import { estimateUserOpGasCost } from \"thirdweb/wallets/smart\";\n *\n * const gasCost = await estimateUserOpGasCost({\n *  transactions,\n *  adminAccount,\n *  client,\n *  smartWalletOptions,\n * });\n * ```\n * @walletUtils\n */\nexport async function estimateUserOpGasCost(args) {\n  var _args$smartWalletOpti, _userOp$maxFeePerGas;\n  // if factory is passed, but no entrypoint, try to resolve entrypoint from factory\n  if (args.smartWalletOptions.factoryAddress && !((_args$smartWalletOpti = args.smartWalletOptions.overrides) !== null && _args$smartWalletOpti !== void 0 && _args$smartWalletOpti.entrypointAddress)) {\n    const entrypointAddress = await getEntrypointFromFactory(args.smartWalletOptions.factoryAddress, args.client, args.smartWalletOptions.chain);\n    if (entrypointAddress) {\n      args.smartWalletOptions.overrides = _objectSpread(_objectSpread({}, args.smartWalletOptions.overrides), {}, {\n        entrypointAddress\n      });\n    }\n  }\n  const userOp = await prepareUserOp({\n    adminAccount: args.adminAccount,\n    client: args.client,\n    isDeployedOverride: await isContractDeployed(getContract({\n      address: await predictSmartAccountAddress({\n        adminAddress: args.adminAccount.address,\n        chain: args.smartWalletOptions.chain,\n        client: args.client,\n        factoryAddress: args.smartWalletOptions.factoryAddress\n      }),\n      chain: args.smartWalletOptions.chain,\n      client: args.client\n    })),\n    smartWalletOptions: args.smartWalletOptions,\n    transactions: args.transactions,\n    waitForDeployment: false\n  });\n  let gasLimit = 0n;\n  if (\"paymasterVerificationGasLimit\" in userOp) {\n    var _userOp$paymasterVeri, _userOp$paymasterPost, _userOp$verificationG, _userOp$preVerificati, _userOp$callGasLimit;\n    // v0.7\n    gasLimit = BigInt((_userOp$paymasterVeri = userOp.paymasterVerificationGasLimit) !== null && _userOp$paymasterVeri !== void 0 ? _userOp$paymasterVeri : 0) + BigInt((_userOp$paymasterPost = userOp.paymasterPostOpGasLimit) !== null && _userOp$paymasterPost !== void 0 ? _userOp$paymasterPost : 0) + BigInt((_userOp$verificationG = userOp.verificationGasLimit) !== null && _userOp$verificationG !== void 0 ? _userOp$verificationG : 0) + BigInt((_userOp$preVerificati = userOp.preVerificationGas) !== null && _userOp$preVerificati !== void 0 ? _userOp$preVerificati : 0) + BigInt((_userOp$callGasLimit = userOp.callGasLimit) !== null && _userOp$callGasLimit !== void 0 ? _userOp$callGasLimit : 0);\n  } else {\n    var _userOp$verificationG2, _userOp$preVerificati2, _userOp$callGasLimit2;\n    // v0.6\n    gasLimit = BigInt((_userOp$verificationG2 = userOp.verificationGasLimit) !== null && _userOp$verificationG2 !== void 0 ? _userOp$verificationG2 : 0) + BigInt((_userOp$preVerificati2 = userOp.preVerificationGas) !== null && _userOp$preVerificati2 !== void 0 ? _userOp$preVerificati2 : 0) + BigInt((_userOp$callGasLimit2 = userOp.callGasLimit) !== null && _userOp$callGasLimit2 !== void 0 ? _userOp$callGasLimit2 : 0);\n  }\n  const gasCost = gasLimit * ((_userOp$maxFeePerGas = userOp.maxFeePerGas) !== null && _userOp$maxFeePerGas !== void 0 ? _userOp$maxFeePerGas : 0n);\n  return {\n    ether: toEther(gasCost),\n    wei: gasCost\n  };\n}\n/**\n * Get the gas fees of a user operation.\n * @param args - The options for getting the gas price of a user operation.\n * @returns The gas price of the user operation.\n * @example\n * ```ts\n * import { getUserOpGasPrice } from \"thirdweb/wallets/smart\";\n *\n * const fees = await getUserOpGasPrice({\n *  options,\n * });\n * ```\n * @walletUtils\n */\nexport async function getUserOpGasFees(args) {\n  const res = await sendBundlerRequest(_objectSpread(_objectSpread({}, args), {}, {\n    operation: \"thirdweb_getUserOperationGasPrice\",\n    params: []\n  }));\n  return {\n    maxFeePerGas: hexToBigInt(res.maxFeePerGas),\n    maxPriorityFeePerGas: hexToBigInt(res.maxPriorityFeePerGas)\n  };\n}\n/**\n * Get the receipt of a user operation.\n * @param args - The options for getting the receipt of a user operation.\n * @returns The receipt of the user operation.\n * @example\n * ```ts\n * import { getUserOpReceipt } from \"thirdweb/wallets/smart\";\n *\n * const receipt = await getUserOpReceipt({\n *  client,\n *  chain,\n *  userOpHash,\n * });\n * ```\n * @walletUtils\n */\nexport async function getUserOpReceipt(args) {\n  const res = await getUserOpReceiptRaw(args);\n  if (!res) {\n    return undefined;\n  }\n  if (res.success === false) {\n    var _logs$;\n    // parse revert reason\n    const logs = parseEventLogs({\n      events: [userOperationRevertReasonEvent(), postOpRevertReasonEvent()],\n      logs: res.logs\n    });\n    const revertReason = (_logs$ = logs[0]) === null || _logs$ === void 0 || (_logs$ = _logs$.args) === null || _logs$ === void 0 ? void 0 : _logs$.revertReason;\n    if (!revertReason) {\n      throw new Error(\"UserOp failed at txHash: \".concat(res.receipt.transactionHash));\n    }\n    const revertMsg = decodeErrorResult({\n      data: revertReason\n    });\n    throw new Error(\"UserOp failed with reason: '\".concat(revertMsg.args.join(\",\"), \"' at txHash: \").concat(res.receipt.transactionHash));\n  }\n  return res.receipt;\n}\n/**\n * Get the receipt of a user operation.\n * @param args - The options for getting the receipt of a user operation.\n * @returns The raw receipt of the user operation.\n * @example\n * ```ts\n * import { getUserOpReceiptRaw } from \"thirdweb/wallets/smart\";\n *\n * const receipt = await getUserOpReceiptRaw({\n *  client,\n *  chain,\n *  userOpHash,\n * });\n * ```\n * @walletUtils\n */\nexport async function getUserOpReceiptRaw(args) {\n  const res = await sendBundlerRequest({\n    operation: \"eth_getUserOperationReceipt\",\n    options: args,\n    params: [args.userOpHash]\n  });\n  if (!res) {\n    return undefined;\n  }\n  return formatUserOperationReceipt(res);\n}\n/**\n * @internal\n */\nexport async function getZkPaymasterData(args) {\n  const res = await sendBundlerRequest({\n    operation: \"zk_paymasterData\",\n    options: args.options,\n    params: [args.transaction]\n  });\n  return {\n    paymaster: res.paymaster,\n    paymasterInput: res.paymasterInput\n  };\n}\n/**\n * @internal\n */\nexport async function executeWithSignature(args) {\n  const res = await sendBundlerRequest(_objectSpread(_objectSpread({}, args), {}, {\n    operation: \"tw_execute\",\n    params: [args.eoaAddress, args.wrappedCalls, args.signature, args.authorization]\n  }));\n  if (!res.queueId) {\n    throw new Error(\"Error executing 7702 transaction: \".concat(stringify(res)));\n  }\n  return {\n    transactionId: res.queueId\n  };\n}\n/**\n * @internal\n */\nexport async function getQueuedTransactionHash(args) {\n  const res = await sendBundlerRequest(_objectSpread(_objectSpread({}, args), {}, {\n    operation: \"tw_getTransactionHash\",\n    params: [args.transactionId]\n  }));\n  return {\n    transactionHash: res.transactionHash\n  };\n}\nexport async function broadcastZkTransaction(args) {\n  const res = await sendBundlerRequest({\n    operation: \"zk_broadcastTransaction\",\n    options: args.options,\n    params: [_objectSpread(_objectSpread({}, args.transaction), {}, {\n      signedTransaction: args.signedTransaction\n    })]\n  });\n  return {\n    transactionHash: res.transactionHash\n  };\n}\nasync function sendBundlerRequest(args) {\n  var _options$bundlerUrl;\n  const {\n    options,\n    operation,\n    params\n  } = args;\n  const bundlerUrl = (_options$bundlerUrl = options.bundlerUrl) !== null && _options$bundlerUrl !== void 0 ? _options$bundlerUrl : getDefaultBundlerUrl(options.chain);\n  const fetchWithHeaders = getClientFetch(options.client);\n  const response = await fetchWithHeaders(bundlerUrl, {\n    useAuthToken: true,\n    body: stringify({\n      id: 1,\n      jsonrpc: \"2.0\",\n      method: operation,\n      params\n    }),\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    method: \"POST\"\n  });\n  const res = await response.json();\n  if (!response.ok || res.error) {\n    let error = res.error || response.statusText;\n    if (typeof error === \"object\") {\n      error = stringify(error);\n    }\n    const code = res.code || \"UNKNOWN\";\n    throw new Error(\"\".concat(operation, \" error: \").concat(error, \"\\nStatus: \").concat(response.status, \"\\nCode: \").concat(code));\n  }\n  return res.result;\n}","map":{"version":3,"names":["decodeErrorResult","getContract","parseEventLogs","userOperationRevertReasonEvent","postOpRevertReasonEvent","isContractDeployed","hexToBigInt","getClientFetch","stringify","toEther","getEntrypointFromFactory","formatUserOperationReceipt","predictSmartAccountAddress","ENTRYPOINT_ADDRESS_v0_6","getDefaultBundlerUrl","MANAGED_ACCOUNT_GAS_BUFFER","prepareUserOp","hexlifyUserOp","bundleUserOp","args","_args$options$entrypo","sendBundlerRequest","_objectSpread","operation","params","userOp","options","entrypointAddress","estimateUserOpGas","stateOverrides","_args$options$entrypo2","res","callGasLimit","paymasterPostOpGasLimit","undefined","paymasterVerificationGasLimit","preVerificationGas","verificationGas","verificationGasLimit","estimateUserOpGasCost","_args$smartWalletOpti","_userOp$maxFeePerGas","smartWalletOptions","factoryAddress","overrides","client","chain","adminAccount","isDeployedOverride","address","adminAddress","transactions","waitForDeployment","gasLimit","_userOp$paymasterVeri","_userOp$paymasterPost","_userOp$verificationG","_userOp$preVerificati","_userOp$callGasLimit","BigInt","_userOp$verificationG2","_userOp$preVerificati2","_userOp$callGasLimit2","gasCost","maxFeePerGas","ether","wei","getUserOpGasFees","maxPriorityFeePerGas","getUserOpReceipt","getUserOpReceiptRaw","success","_logs$","logs","events","revertReason","Error","concat","receipt","transactionHash","revertMsg","data","join","userOpHash","getZkPaymasterData","transaction","paymaster","paymasterInput","executeWithSignature","eoaAddress","wrappedCalls","signature","authorization","queueId","transactionId","getQueuedTransactionHash","broadcastZkTransaction","signedTransaction","_options$bundlerUrl","bundlerUrl","fetchWithHeaders","response","useAuthToken","body","id","jsonrpc","method","headers","json","ok","error","statusText","code","status","result"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/wallets/smart/lib/bundler.ts"],"sourcesContent":["import { decodeErrorResult } from \"viem\";\nimport type { ThirdwebClient } from \"../../../client/client.js\";\nimport { getContract } from \"../../../contract/contract.js\";\nimport { parseEventLogs } from \"../../../event/actions/parse-logs.js\";\nimport { userOperationRevertReasonEvent } from \"../../../extensions/erc4337/__generated__/IEntryPoint/events/UserOperationRevertReason.js\";\nimport { postOpRevertReasonEvent } from \"../../../extensions/erc4337/__generated__/IEntryPoint_v07/events/PostOpRevertReason.js\";\nimport type { ExecuteWithSigParams } from \"../../../extensions/erc7702/__generated__/MinimalAccount/write/executeWithSig.js\";\nimport type { SignedAuthorization } from \"../../../transaction/actions/eip7702/authorization.js\";\nimport type { PreparedTransaction } from \"../../../transaction/prepare-transaction.js\";\nimport type { SerializableTransaction } from \"../../../transaction/serialize-transaction.js\";\nimport type { TransactionReceipt } from \"../../../transaction/types.js\";\nimport { isContractDeployed } from \"../../../utils/bytecode/is-contract-deployed.js\";\nimport { type Hex, hexToBigInt } from \"../../../utils/encoding/hex.js\";\nimport { getClientFetch } from \"../../../utils/fetch.js\";\nimport { stringify } from \"../../../utils/json.js\";\nimport { toEther } from \"../../../utils/units.js\";\nimport type { Account } from \"../../interfaces/wallet.js\";\nimport { getEntrypointFromFactory } from \"../index.js\";\nimport {\n  type BundlerOptions,\n  type EstimationResult,\n  formatUserOperationReceipt,\n  type GasPriceResult,\n  type PmTransactionData,\n  type SmartWalletOptions,\n  type UserOperationReceipt,\n  type UserOperationV06,\n  type UserOperationV07,\n} from \"../types.js\";\nimport { predictSmartAccountAddress } from \"./calls.js\";\nimport {\n  ENTRYPOINT_ADDRESS_v0_6,\n  getDefaultBundlerUrl,\n  MANAGED_ACCOUNT_GAS_BUFFER,\n} from \"./constants.js\";\nimport { prepareUserOp } from \"./userop.js\";\nimport { hexlifyUserOp } from \"./utils.js\";\n\n/**\n * Bundle a user operation.\n * @param args - The options for bundling a user operation.\n * @returns The bundle hash of the user operation.\n * @example\n * ```ts\n * import { bundleUserOp } from \"thirdweb/wallets/smart\";\n *\n * const userOpHash = await bundleUserOp({\n *  userOp,\n *  options,\n * });\n * ```\n * @walletUtils\n */\nexport async function bundleUserOp(args: {\n  userOp: UserOperationV06 | UserOperationV07;\n  options: BundlerOptions;\n}): Promise<Hex> {\n  return sendBundlerRequest({\n    ...args,\n    operation: \"eth_sendUserOperation\",\n    params: [\n      hexlifyUserOp(args.userOp),\n      args.options.entrypointAddress ?? ENTRYPOINT_ADDRESS_v0_6,\n    ],\n  });\n}\n\n/**\n * Estimate the gas cost of a user operation.\n * @param args - The options for estimating the gas cost of a user operation.\n * @returns The estimated gas cost of the user operation.\n * @example\n * ```ts\n * import { estimateUserOpGas } from \"thirdweb/wallets/smart\";\n *\n * const gasCost = await estimateUserOpGas({\n *  userOp,\n *  options,\n * });\n * ```\n * @walletUtils\n */\nexport async function estimateUserOpGas(\n  args: {\n    userOp: UserOperationV06 | UserOperationV07;\n    options: BundlerOptions;\n  },\n  stateOverrides?: {\n    [x: string]: {\n      stateDiff: {\n        [x: string]: `0x${string}`;\n      };\n    };\n  },\n): Promise<EstimationResult> {\n  const res = await sendBundlerRequest({\n    ...args,\n    operation: \"eth_estimateUserOperationGas\",\n    params: [\n      hexlifyUserOp(args.userOp),\n      args.options.entrypointAddress ?? ENTRYPOINT_ADDRESS_v0_6,\n      stateOverrides ?? {},\n    ],\n  });\n\n  // add gas buffer for managed account factory delegate calls\n  return {\n    callGasLimit: hexToBigInt(res.callGasLimit) + MANAGED_ACCOUNT_GAS_BUFFER,\n    paymasterPostOpGasLimit:\n      res.paymasterPostOpGasLimit !== undefined\n        ? hexToBigInt(res.paymasterPostOpGasLimit)\n        : undefined,\n    paymasterVerificationGasLimit:\n      res.paymasterVerificationGasLimit !== undefined\n        ? hexToBigInt(res.paymasterVerificationGasLimit)\n        : undefined,\n    preVerificationGas: hexToBigInt(res.preVerificationGas),\n    verificationGas:\n      res.verificationGas !== undefined\n        ? hexToBigInt(res.verificationGas)\n        : undefined,\n    verificationGasLimit: hexToBigInt(res.verificationGasLimit),\n  };\n}\n\n/**\n * Estimate the gas cost of a user operation.\n * @param args - The options for estimating the gas cost of a user operation.\n * @returns The estimated gas cost of the user operation.\n * @example\n * ```ts\n * import { estimateUserOpGasCost } from \"thirdweb/wallets/smart\";\n *\n * const gasCost = await estimateUserOpGasCost({\n *  transactions,\n *  adminAccount,\n *  client,\n *  smartWalletOptions,\n * });\n * ```\n * @walletUtils\n */\nexport async function estimateUserOpGasCost(args: {\n  transactions: PreparedTransaction[];\n  adminAccount: Account;\n  client: ThirdwebClient;\n  smartWalletOptions: SmartWalletOptions;\n}) {\n  // if factory is passed, but no entrypoint, try to resolve entrypoint from factory\n  if (\n    args.smartWalletOptions.factoryAddress &&\n    !args.smartWalletOptions.overrides?.entrypointAddress\n  ) {\n    const entrypointAddress = await getEntrypointFromFactory(\n      args.smartWalletOptions.factoryAddress,\n      args.client,\n      args.smartWalletOptions.chain,\n    );\n    if (entrypointAddress) {\n      args.smartWalletOptions.overrides = {\n        ...args.smartWalletOptions.overrides,\n        entrypointAddress,\n      };\n    }\n  }\n\n  const userOp = await prepareUserOp({\n    adminAccount: args.adminAccount,\n    client: args.client,\n    isDeployedOverride: await isContractDeployed(\n      getContract({\n        address: await predictSmartAccountAddress({\n          adminAddress: args.adminAccount.address,\n          chain: args.smartWalletOptions.chain,\n          client: args.client,\n          factoryAddress: args.smartWalletOptions.factoryAddress,\n        }),\n        chain: args.smartWalletOptions.chain,\n        client: args.client,\n      }),\n    ),\n    smartWalletOptions: args.smartWalletOptions,\n    transactions: args.transactions,\n    waitForDeployment: false,\n  });\n\n  let gasLimit = 0n;\n  if (\"paymasterVerificationGasLimit\" in userOp) {\n    // v0.7\n    gasLimit =\n      BigInt(userOp.paymasterVerificationGasLimit ?? 0) +\n      BigInt(userOp.paymasterPostOpGasLimit ?? 0) +\n      BigInt(userOp.verificationGasLimit ?? 0) +\n      BigInt(userOp.preVerificationGas ?? 0) +\n      BigInt(userOp.callGasLimit ?? 0);\n  } else {\n    // v0.6\n    gasLimit =\n      BigInt(userOp.verificationGasLimit ?? 0) +\n      BigInt(userOp.preVerificationGas ?? 0) +\n      BigInt(userOp.callGasLimit ?? 0);\n  }\n\n  const gasCost = gasLimit * (userOp.maxFeePerGas ?? 0n);\n\n  return {\n    ether: toEther(gasCost),\n    wei: gasCost,\n  };\n}\n\n/**\n * Get the gas fees of a user operation.\n * @param args - The options for getting the gas price of a user operation.\n * @returns The gas price of the user operation.\n * @example\n * ```ts\n * import { getUserOpGasPrice } from \"thirdweb/wallets/smart\";\n *\n * const fees = await getUserOpGasPrice({\n *  options,\n * });\n * ```\n * @walletUtils\n */\nexport async function getUserOpGasFees(args: {\n  options: BundlerOptions;\n}): Promise<GasPriceResult> {\n  const res = await sendBundlerRequest({\n    ...args,\n    operation: \"thirdweb_getUserOperationGasPrice\",\n    params: [],\n  });\n\n  return {\n    maxFeePerGas: hexToBigInt(res.maxFeePerGas),\n    maxPriorityFeePerGas: hexToBigInt(res.maxPriorityFeePerGas),\n  };\n}\n\n/**\n * Get the receipt of a user operation.\n * @param args - The options for getting the receipt of a user operation.\n * @returns The receipt of the user operation.\n * @example\n * ```ts\n * import { getUserOpReceipt } from \"thirdweb/wallets/smart\";\n *\n * const receipt = await getUserOpReceipt({\n *  client,\n *  chain,\n *  userOpHash,\n * });\n * ```\n * @walletUtils\n */\nexport async function getUserOpReceipt(\n  args: BundlerOptions & {\n    userOpHash: Hex;\n  },\n): Promise<TransactionReceipt | undefined> {\n  const res = await getUserOpReceiptRaw(args);\n\n  if (!res) {\n    return undefined;\n  }\n\n  if (res.success === false) {\n    // parse revert reason\n    const logs = parseEventLogs({\n      events: [userOperationRevertReasonEvent(), postOpRevertReasonEvent()],\n      logs: res.logs,\n    });\n    const revertReason = logs[0]?.args?.revertReason;\n    if (!revertReason) {\n      throw new Error(\n        `UserOp failed at txHash: ${res.receipt.transactionHash}`,\n      );\n    }\n    const revertMsg = decodeErrorResult({\n      data: revertReason,\n    });\n    throw new Error(\n      `UserOp failed with reason: '${revertMsg.args.join(\",\")}' at txHash: ${\n        res.receipt.transactionHash\n      }`,\n    );\n  }\n  return res.receipt;\n}\n\n/**\n * Get the receipt of a user operation.\n * @param args - The options for getting the receipt of a user operation.\n * @returns The raw receipt of the user operation.\n * @example\n * ```ts\n * import { getUserOpReceiptRaw } from \"thirdweb/wallets/smart\";\n *\n * const receipt = await getUserOpReceiptRaw({\n *  client,\n *  chain,\n *  userOpHash,\n * });\n * ```\n * @walletUtils\n */\nexport async function getUserOpReceiptRaw(\n  args: BundlerOptions & {\n    userOpHash: Hex;\n  },\n): Promise<UserOperationReceipt | undefined> {\n  const res = await sendBundlerRequest({\n    operation: \"eth_getUserOperationReceipt\",\n    options: args,\n    params: [args.userOpHash],\n  });\n  if (!res) {\n    return undefined;\n  }\n  return formatUserOperationReceipt(res as UserOperationReceipt);\n}\n\n/**\n * @internal\n */\nexport async function getZkPaymasterData(args: {\n  options: BundlerOptions;\n  transaction: SerializableTransaction;\n}): Promise<PmTransactionData> {\n  const res = await sendBundlerRequest({\n    operation: \"zk_paymasterData\",\n    options: args.options,\n    params: [args.transaction],\n  });\n\n  return {\n    paymaster: res.paymaster,\n    paymasterInput: res.paymasterInput,\n  };\n}\n\n/**\n * @internal\n */\nexport async function executeWithSignature(args: {\n  eoaAddress: `0x${string}`;\n  wrappedCalls: ExecuteWithSigParams[\"wrappedCalls\"];\n  signature: `0x${string}`;\n  authorization: SignedAuthorization | undefined;\n  options: BundlerOptions;\n}): Promise<{ transactionId: string }> {\n  const res = await sendBundlerRequest({\n    ...args,\n    operation: \"tw_execute\",\n    params: [\n      args.eoaAddress,\n      args.wrappedCalls,\n      args.signature,\n      args.authorization,\n    ],\n  });\n\n  if (!res.queueId) {\n    throw new Error(`Error executing 7702 transaction: ${stringify(res)}`);\n  }\n\n  return {\n    transactionId: res.queueId,\n  };\n}\n\n/**\n * @internal\n */\nexport async function getQueuedTransactionHash(args: {\n  transactionId: string;\n  options: BundlerOptions;\n}): Promise<{ transactionHash: Hex }> {\n  const res = await sendBundlerRequest({\n    ...args,\n    operation: \"tw_getTransactionHash\",\n    params: [args.transactionId],\n  });\n  return {\n    transactionHash: res.transactionHash,\n  };\n}\n\nexport async function broadcastZkTransaction(args: {\n  options: BundlerOptions;\n  transaction: SerializableTransaction;\n  signedTransaction: Hex;\n}): Promise<{ transactionHash: Hex }> {\n  const res = await sendBundlerRequest({\n    operation: \"zk_broadcastTransaction\",\n    options: args.options,\n    params: [\n      {\n        ...args.transaction,\n        signedTransaction: args.signedTransaction,\n      },\n    ],\n  });\n\n  return {\n    transactionHash: res.transactionHash,\n  };\n}\n\nasync function sendBundlerRequest(args: {\n  options: BundlerOptions;\n  operation:\n    | \"eth_estimateUserOperationGas\"\n    | \"eth_sendUserOperation\"\n    | \"eth_getUserOperationReceipt\"\n    | \"thirdweb_getUserOperationGasPrice\"\n    | \"zk_paymasterData\"\n    | \"zk_broadcastTransaction\"\n    | \"tw_execute\"\n    | \"tw_getTransactionHash\";\n  // biome-ignore lint/suspicious/noExplicitAny: TODO: fix any\n  params: any[];\n}) {\n  const { options, operation, params } = args;\n\n  const bundlerUrl = options.bundlerUrl ?? getDefaultBundlerUrl(options.chain);\n  const fetchWithHeaders = getClientFetch(options.client);\n  const response = await fetchWithHeaders(bundlerUrl, {\n    useAuthToken: true,\n    body: stringify({\n      id: 1,\n      jsonrpc: \"2.0\",\n      method: operation,\n      params,\n    }),\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    method: \"POST\",\n  });\n  const res = await response.json();\n  if (!response.ok || res.error) {\n    let error = res.error || response.statusText;\n    if (typeof error === \"object\") {\n      error = stringify(error);\n    }\n    const code = res.code || \"UNKNOWN\";\n\n    throw new Error(\n      `${operation} error: ${error}\nStatus: ${response.status}\nCode: ${code}`,\n    );\n  }\n\n  return res.result;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}