{"ast":null,"code":"import { useQuery } from \"@tanstack/react-query\";\nimport { useEffect, useState } from \"react\";\nimport { getChainMetadata } from \"../../../../../../../chains/utils.js\";\nimport { NATIVE_TOKEN_ADDRESS } from \"../../../../../../../constants/addresses.js\";\nimport { getContract } from \"../../../../../../../contract/contract.js\";\nimport { getCurrencyMetadata } from \"../../../../../../../extensions/erc20/read/getCurrencyMetadata.js\";\nimport { encode } from \"../../../../../../../transaction/actions/encode.js\";\nimport { getTransactionGasCost } from \"../../../../../../../transaction/utils.js\";\nimport { resolvePromisedValue } from \"../../../../../../../utils/promise/resolve-promised-value.js\";\nimport { getWalletBalance } from \"../../../../../../../wallets/utils/getWalletBalance.js\";\nexport function useTransactionCostAndData(args) {\n  const {\n    transaction,\n    account,\n    supportedDestinations\n  } = args;\n  // Compute query key of the transaction first\n  const [txQueryKey, setTxQueryKey] = useState();\n  useEffect(() => {\n    Promise.all([resolvePromisedValue(transaction.value), resolvePromisedValue(transaction.erc20Value), resolvePromisedValue(transaction.to), encode(transaction)]).then(_ref => {\n      var _erc20Value$amountWei;\n      let [value, erc20Value, to, data] = _ref;\n      setTxQueryKey({\n        data,\n        erc20Currency: erc20Value === null || erc20Value === void 0 ? void 0 : erc20Value.tokenAddress,\n        erc20Value: erc20Value === null || erc20Value === void 0 || (_erc20Value$amountWei = erc20Value.amountWei) === null || _erc20Value$amountWei === void 0 ? void 0 : _erc20Value$amountWei.toString(),\n        to,\n        value: value === null || value === void 0 ? void 0 : value.toString()\n      });\n    });\n  }, [transaction]);\n  return useQuery({\n    enabled: !!transaction && !!txQueryKey,\n    queryFn: async () => {\n      var _chainMetadata$icon;\n      if (!account) {\n        throw new Error(\"No payer account found\");\n      }\n      const erc20Value = await resolvePromisedValue(transaction.erc20Value);\n      if (erc20Value) {\n        var _supportedDestination;\n        const [tokenBalance, tokenMeta, gasCostWei, chainMetadata] = await Promise.all([getWalletBalance({\n          address: account.address,\n          chain: transaction.chain,\n          client: transaction.client,\n          tokenAddress: erc20Value.tokenAddress\n        }), getCurrencyMetadata({\n          contract: getContract({\n            address: erc20Value.tokenAddress,\n            chain: transaction.chain,\n            client: transaction.client\n          })\n        }), getTransactionGasCost(transaction, account === null || account === void 0 ? void 0 : account.address), getChainMetadata(transaction.chain)]);\n        const transactionValueWei = erc20Value.amountWei;\n        const walletBalance = tokenBalance;\n        const currency = {\n          address: erc20Value.tokenAddress,\n          icon: (_supportedDestination = supportedDestinations.find(c => c.chain.id === transaction.chain.id)) === null || _supportedDestination === void 0 || (_supportedDestination = _supportedDestination.tokens.find(t => t.address.toLowerCase() === erc20Value.tokenAddress.toLowerCase())) === null || _supportedDestination === void 0 ? void 0 : _supportedDestination.icon,\n          name: tokenMeta.name,\n          symbol: tokenMeta.symbol\n        };\n        return {\n          chainMetadata,\n          decimals: tokenMeta.decimals,\n          gasCostWei,\n          token: currency,\n          transactionValueWei,\n          walletBalance\n        };\n      }\n      const [nativeWalletBalance, chainMetadata, gasCostWei] = await Promise.all([getWalletBalance({\n        address: account.address,\n        chain: transaction.chain,\n        client: transaction.client\n      }), getChainMetadata(transaction.chain), getTransactionGasCost(transaction, account === null || account === void 0 ? void 0 : account.address)]);\n      const walletBalance = nativeWalletBalance;\n      const transactionValueWei = (await resolvePromisedValue(transaction.value)) || 0n;\n      return {\n        chainMetadata,\n        decimals: 18,\n        gasCostWei,\n        token: {\n          address: NATIVE_TOKEN_ADDRESS,\n          icon: (_chainMetadata$icon = chainMetadata.icon) === null || _chainMetadata$icon === void 0 ? void 0 : _chainMetadata$icon.url,\n          name: chainMetadata.nativeCurrency.name,\n          symbol: chainMetadata.nativeCurrency.symbol\n        },\n        transactionValueWei,\n        walletBalance\n      };\n    },\n    queryKey: [\"transaction-cost\", transaction.chain.id, account === null || account === void 0 ? void 0 : account.address, txQueryKey],\n    refetchInterval: args.refetchIntervalMs || 30000\n  });\n}","map":{"version":3,"names":["useQuery","useEffect","useState","getChainMetadata","NATIVE_TOKEN_ADDRESS","getContract","getCurrencyMetadata","encode","getTransactionGasCost","resolvePromisedValue","getWalletBalance","useTransactionCostAndData","args","transaction","account","supportedDestinations","txQueryKey","setTxQueryKey","Promise","all","value","erc20Value","to","then","_ref","_erc20Value$amountWei","data","erc20Currency","tokenAddress","amountWei","toString","enabled","queryFn","_chainMetadata$icon","Error","_supportedDestination","tokenBalance","tokenMeta","gasCostWei","chainMetadata","address","chain","client","contract","transactionValueWei","walletBalance","currency","icon","find","c","id","tokens","t","toLowerCase","name","symbol","decimals","token","nativeWalletBalance","url","nativeCurrency","queryKey","refetchInterval","refetchIntervalMs"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/react/web/ui/ConnectWallet/screens/Buy/main/useBuyTxStates.ts"],"sourcesContent":["import { useQuery } from \"@tanstack/react-query\";\nimport { useEffect, useState } from \"react\";\nimport { getChainMetadata } from \"../../../../../../../chains/utils.js\";\nimport { NATIVE_TOKEN_ADDRESS } from \"../../../../../../../constants/addresses.js\";\nimport { getContract } from \"../../../../../../../contract/contract.js\";\nimport { getCurrencyMetadata } from \"../../../../../../../extensions/erc20/read/getCurrencyMetadata.js\";\nimport { encode } from \"../../../../../../../transaction/actions/encode.js\";\nimport type { PreparedTransaction } from \"../../../../../../../transaction/prepare-transaction.js\";\nimport { getTransactionGasCost } from \"../../../../../../../transaction/utils.js\";\nimport type { Hex } from \"../../../../../../../utils/encoding/hex.js\";\nimport { resolvePromisedValue } from \"../../../../../../../utils/promise/resolve-promised-value.js\";\nimport type { Account } from \"../../../../../../../wallets/interfaces/wallet.js\";\nimport { getWalletBalance } from \"../../../../../../../wallets/utils/getWalletBalance.js\";\nimport type { SupportedChainAndTokens } from \"../swap/useSwapSupportedChains.js\";\nimport type { TransactionCostAndData } from \"./types.js\";\n\nexport function useTransactionCostAndData(args: {\n  transaction: PreparedTransaction;\n  account: Account | undefined;\n  supportedDestinations: SupportedChainAndTokens;\n  refetchIntervalMs?: number;\n}) {\n  const { transaction, account, supportedDestinations } = args;\n  // Compute query key of the transaction first\n  const [txQueryKey, setTxQueryKey] = useState<\n    | {\n        value: string | undefined;\n        erc20Value: string | undefined;\n        erc20Currency: string | undefined;\n        to: string | undefined;\n        data: Hex | undefined;\n      }\n    | undefined\n  >();\n  useEffect(() => {\n    Promise.all([\n      resolvePromisedValue(transaction.value),\n      resolvePromisedValue(transaction.erc20Value),\n      resolvePromisedValue(transaction.to),\n      encode(transaction),\n    ]).then(([value, erc20Value, to, data]) => {\n      setTxQueryKey({\n        data,\n        erc20Currency: erc20Value?.tokenAddress,\n        erc20Value: erc20Value?.amountWei?.toString(),\n        to,\n        value: value?.toString(),\n      });\n    });\n  }, [transaction]);\n\n  return useQuery({\n    enabled: !!transaction && !!txQueryKey,\n    queryFn: async () => {\n      if (!account) {\n        throw new Error(\"No payer account found\");\n      }\n\n      const erc20Value = await resolvePromisedValue(transaction.erc20Value);\n      if (erc20Value) {\n        const [tokenBalance, tokenMeta, gasCostWei, chainMetadata] =\n          await Promise.all([\n            getWalletBalance({\n              address: account.address,\n              chain: transaction.chain,\n              client: transaction.client,\n              tokenAddress: erc20Value.tokenAddress,\n            }),\n            getCurrencyMetadata({\n              contract: getContract({\n                address: erc20Value.tokenAddress,\n                chain: transaction.chain,\n                client: transaction.client,\n              }),\n            }),\n            getTransactionGasCost(transaction, account?.address),\n            getChainMetadata(transaction.chain),\n          ]);\n        const transactionValueWei = erc20Value.amountWei;\n        const walletBalance = tokenBalance;\n        const currency = {\n          address: erc20Value.tokenAddress,\n          icon: supportedDestinations\n            .find((c) => c.chain.id === transaction.chain.id)\n            ?.tokens.find(\n              (t) =>\n                t.address.toLowerCase() ===\n                erc20Value.tokenAddress.toLowerCase(),\n            )?.icon,\n          name: tokenMeta.name,\n          symbol: tokenMeta.symbol,\n        };\n        return {\n          chainMetadata,\n          decimals: tokenMeta.decimals,\n          gasCostWei,\n          token: currency,\n          transactionValueWei,\n          walletBalance,\n        } satisfies TransactionCostAndData;\n      }\n\n      const [nativeWalletBalance, chainMetadata, gasCostWei] =\n        await Promise.all([\n          getWalletBalance({\n            address: account.address,\n            chain: transaction.chain,\n            client: transaction.client,\n          }),\n          getChainMetadata(transaction.chain),\n          getTransactionGasCost(transaction, account?.address),\n        ]);\n      const walletBalance = nativeWalletBalance;\n      const transactionValueWei =\n        (await resolvePromisedValue(transaction.value)) || 0n;\n      return {\n        chainMetadata,\n        decimals: 18,\n        gasCostWei,\n        token: {\n          address: NATIVE_TOKEN_ADDRESS,\n          icon: chainMetadata.icon?.url,\n          name: chainMetadata.nativeCurrency.name,\n          symbol: chainMetadata.nativeCurrency.symbol,\n        },\n        transactionValueWei,\n        walletBalance,\n      } satisfies TransactionCostAndData;\n    },\n    queryKey: [\n      \"transaction-cost\",\n      transaction.chain.id,\n      account?.address,\n      txQueryKey,\n    ],\n    refetchInterval: args.refetchIntervalMs || 30_000,\n  });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}