{"ast":null,"code":"import { signLoginPayload } from \"../../../../auth/core/sign-login-payload.js\";\nimport { getCachedChain } from \"../../../../chains/utils.js\";\nimport { getClientFetch } from \"../../../../utils/fetch.js\";\nimport { stringify } from \"../../../../utils/json.js\";\nimport { getLoginCallbackUrl, getLoginUrl } from \"./getLoginPath.js\";\n/**\n * @internal\n */\nexport async function siweAuthenticate(args) {\n  const {\n    wallet,\n    client,\n    ecosystem\n  } = args;\n  const siweChain = getCachedChain(1); // always use mainnet for SIWE for wide wallet compatibility\n  // only connect if the wallet doesn't already have an account\n  const account = wallet.getAccount() || (await wallet.connect({\n    chain: siweChain,\n    client\n  }));\n  const clientFetch = getClientFetch(client, ecosystem);\n  const payload = await (async () => {\n    const path = getLoginUrl({\n      authOption: \"wallet\",\n      client: args.client,\n      ecosystem: args.ecosystem\n    });\n    const res = await clientFetch(\"\".concat(path, \"&address=\").concat(account.address, \"&chainId=\").concat(siweChain.id));\n    if (!res.ok) throw new Error(\"Failed to generate SIWE login payload\");\n    return await res.json();\n  })();\n  const {\n    signature\n  } = await signLoginPayload({\n    account,\n    payload\n  });\n  const authResult = await (async () => {\n    const path = getLoginCallbackUrl({\n      authOption: \"wallet\",\n      client: args.client,\n      ecosystem: args.ecosystem\n    });\n    const res = await clientFetch(\"\".concat(path, \"&signature=\").concat(signature, \"&payload=\").concat(encodeURIComponent(payload)), {\n      body: stringify({\n        payload,\n        signature\n      }),\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      method: \"POST\"\n    });\n    if (!res.ok) throw new Error(\"Failed to verify SIWE signature\");\n    return await res.json();\n  })();\n  return authResult;\n}","map":{"version":3,"names":["signLoginPayload","getCachedChain","getClientFetch","stringify","getLoginCallbackUrl","getLoginUrl","siweAuthenticate","args","wallet","client","ecosystem","siweChain","account","getAccount","connect","chain","clientFetch","payload","path","authOption","res","concat","address","id","ok","Error","json","signature","authResult","encodeURIComponent","body","headers","method"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/wallets/in-app/core/authentication/siwe.ts"],"sourcesContent":["import { signLoginPayload } from \"../../../../auth/core/sign-login-payload.js\";\nimport type { LoginPayload } from \"../../../../auth/core/types.js\";\nimport { getCachedChain } from \"../../../../chains/utils.js\";\nimport type { ThirdwebClient } from \"../../../../client/client.js\";\nimport { getClientFetch } from \"../../../../utils/fetch.js\";\nimport { stringify } from \"../../../../utils/json.js\";\nimport type { Wallet } from \"../../../interfaces/wallet.js\";\nimport type { Ecosystem } from \"../wallet/types.js\";\nimport { getLoginCallbackUrl, getLoginUrl } from \"./getLoginPath.js\";\nimport type { AuthStoredTokenWithCookieReturnType } from \"./types.js\";\n\n/**\n * @internal\n */\nexport async function siweAuthenticate(args: {\n  wallet: Wallet;\n  client: ThirdwebClient;\n  ecosystem?: Ecosystem;\n}): Promise<AuthStoredTokenWithCookieReturnType> {\n  const { wallet, client, ecosystem } = args;\n  const siweChain = getCachedChain(1); // always use mainnet for SIWE for wide wallet compatibility\n  // only connect if the wallet doesn't already have an account\n  const account =\n    wallet.getAccount() || (await wallet.connect({ chain: siweChain, client }));\n  const clientFetch = getClientFetch(client, ecosystem);\n\n  const payload = await (async () => {\n    const path = getLoginUrl({\n      authOption: \"wallet\",\n      client: args.client,\n      ecosystem: args.ecosystem,\n    });\n    const res = await clientFetch(\n      `${path}&address=${account.address}&chainId=${siweChain.id}`,\n    );\n\n    if (!res.ok) throw new Error(\"Failed to generate SIWE login payload\");\n\n    return (await res.json()) satisfies LoginPayload;\n  })();\n  const { signature } = await signLoginPayload({ account, payload });\n\n  const authResult = await (async () => {\n    const path = getLoginCallbackUrl({\n      authOption: \"wallet\",\n      client: args.client,\n      ecosystem: args.ecosystem,\n    });\n    const res = await clientFetch(\n      `${path}&signature=${signature}&payload=${encodeURIComponent(payload)}`,\n      {\n        body: stringify({\n          payload,\n          signature,\n        }),\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        method: \"POST\",\n      },\n    );\n\n    if (!res.ok) throw new Error(\"Failed to verify SIWE signature\");\n\n    return (await res.json()) satisfies AuthStoredTokenWithCookieReturnType;\n  })();\n  return authResult;\n}\n"],"mappings":"AAAA,SAASA,gBAAgB,QAAQ,6CAA6C;AAE9E,SAASC,cAAc,QAAQ,6BAA6B;AAE5D,SAASC,cAAc,QAAQ,4BAA4B;AAC3D,SAASC,SAAS,QAAQ,2BAA2B;AAGrD,SAASC,mBAAmB,EAAEC,WAAW,QAAQ,mBAAmB;AAGpE;;;AAGA,OAAO,eAAeC,gBAAgBA,CAACC,IAItC;EACC,MAAM;IAAEC,MAAM;IAAEC,MAAM;IAAEC;EAAS,CAAE,GAAGH,IAAI;EAC1C,MAAMI,SAAS,GAAGV,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;EACrC;EACA,MAAMW,OAAO,GACXJ,MAAM,CAACK,UAAU,EAAE,KAAK,MAAML,MAAM,CAACM,OAAO,CAAC;IAAEC,KAAK,EAAEJ,SAAS;IAAEF;EAAM,CAAE,CAAC,CAAC;EAC7E,MAAMO,WAAW,GAAGd,cAAc,CAACO,MAAM,EAAEC,SAAS,CAAC;EAErD,MAAMO,OAAO,GAAG,MAAM,CAAC,YAAW;IAChC,MAAMC,IAAI,GAAGb,WAAW,CAAC;MACvBc,UAAU,EAAE,QAAQ;MACpBV,MAAM,EAAEF,IAAI,CAACE,MAAM;MACnBC,SAAS,EAAEH,IAAI,CAACG;KACjB,CAAC;IACF,MAAMU,GAAG,GAAG,MAAMJ,WAAW,IAAAK,MAAA,CACxBH,IAAI,eAAAG,MAAA,CAAYT,OAAO,CAACU,OAAO,eAAAD,MAAA,CAAYV,SAAS,CAACY,EAAE,CAAE,CAC7D;IAED,IAAI,CAACH,GAAG,CAACI,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,uCAAuC,CAAC;IAErE,OAAQ,MAAML,GAAG,CAACM,IAAI,EAAE;EAC1B,CAAC,EAAC,CAAE;EACJ,MAAM;IAAEC;EAAS,CAAE,GAAG,MAAM3B,gBAAgB,CAAC;IAAEY,OAAO;IAAEK;EAAO,CAAE,CAAC;EAElE,MAAMW,UAAU,GAAG,MAAM,CAAC,YAAW;IACnC,MAAMV,IAAI,GAAGd,mBAAmB,CAAC;MAC/Be,UAAU,EAAE,QAAQ;MACpBV,MAAM,EAAEF,IAAI,CAACE,MAAM;MACnBC,SAAS,EAAEH,IAAI,CAACG;KACjB,CAAC;IACF,MAAMU,GAAG,GAAG,MAAMJ,WAAW,IAAAK,MAAA,CACxBH,IAAI,iBAAAG,MAAA,CAAcM,SAAS,eAAAN,MAAA,CAAYQ,kBAAkB,CAACZ,OAAO,CAAC,GACrE;MACEa,IAAI,EAAE3B,SAAS,CAAC;QACdc,OAAO;QACPU;OACD,CAAC;MACFI,OAAO,EAAE;QACP,cAAc,EAAE;OACjB;MACDC,MAAM,EAAE;KACT,CACF;IAED,IAAI,CAACZ,GAAG,CAACI,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,iCAAiC,CAAC;IAE/D,OAAQ,MAAML,GAAG,CAACM,IAAI,EAAE;EAC1B,CAAC,EAAC,CAAE;EACJ,OAAOE,UAAU;AACnB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}