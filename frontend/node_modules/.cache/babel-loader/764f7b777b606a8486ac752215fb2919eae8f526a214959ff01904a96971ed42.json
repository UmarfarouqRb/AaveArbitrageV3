{"ast":null,"code":"\"use client\";\n\nimport _objectSpread from \"/home/user/Arbitrage/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useCallback } from \"react\";\nimport { getContract } from \"../../../../../../contract/contract.js\";\nimport { getListing } from \"../../../../../../extensions/marketplace/direct-listings/read/getListing.js\";\nimport { useReadContract } from \"../../../../../core/hooks/contract/useReadContract.js\";\nimport { useActiveAccount } from \"../../../../../core/hooks/wallets/useActiveAccount.js\";\nimport { useSendAndConfirmTransaction } from \"../../../../hooks/transaction/useSendAndConfirmTransaction.js\";\nimport { TransactionButton } from \"../../../TransactionButton/index.js\";\n/**\n * This button is used with thirdweb Marketplace v3 contract, for buying NFT(s) from a listing.\n *\n * Under the hood, it prepares a transaction using the [`buyFromListing` extension](https://portal.thirdweb.com/references/typescript/v5/marketplace/buyFromListing)\n * and then pass it to a <TransactionButton />\n *\n * Since it uses the TransactionButton, it can take in any props that can be passed\n * to the [`TransactionButton`](https://portal.thirdweb.com/references/typescript/v5/TransactionButton)\n *\n * @param props props of type [BuyDirectListingButtonProps](https://portal.thirdweb.com/references/typescript/v5/BuyDirectListingButtonProps)\n * @example\n * ```tsx\n * import { BuyDirectListingButton } from \"thirdweb/react\";\n *\n * <BuyDirectListingButton\n *   contractAddress=\"0x...\" // contract address of the marketplace v3\n *   chain={...} // the chain which the marketplace contract is deployed on\n *   client={...} // thirdweb client\n *   listingId={100n} // the listingId or the item you want to buy\n *   quantity={1n} // optional - see the docs to learn more\n * >\n *   Buy NFT\n * </BuyDirectListingButton>\n * ```\n *\n * For error handling & callbacks on transaction-sent and transaction-confirmed,\n * please refer to the TransactionButton docs.\n * @component\n * @transaction\n */\nexport function BuyDirectListingButton(props) {\n  const {\n    contractAddress,\n    listingId,\n    children,\n    chain,\n    client,\n    quantity,\n    payModal\n  } = props;\n  const defaultPayModalMetadata = payModal ? payModal.metadata : undefined;\n  const account = useActiveAccount();\n  const contract = getContract({\n    address: contractAddress,\n    chain,\n    client\n  });\n  const {\n    data: payMetadata\n  } = useReadContract(getPayMetadata, {\n    contract,\n    listingId,\n    queryOptions: {\n      enabled: !defaultPayModalMetadata\n    }\n  });\n  const {\n    mutateAsync\n  } = useSendAndConfirmTransaction({\n    payModal: typeof payModal === \"object\" ? _objectSpread(_objectSpread({}, payModal), {}, {\n      metadata: payModal.metadata || payMetadata\n    }) : payModal\n  });\n  const prepareBuyTransaction = useCallback(async () => {\n    if (!account) {\n      throw new Error(\"No account detected\");\n    }\n    const [listing, {\n      getApprovalForTransaction\n    }, {\n      buyFromListing\n    }] = await Promise.all([getListing({\n      contract,\n      listingId\n    }), import(\"../../../../../../extensions/erc20/write/getApprovalForTransaction.js\"), import(\"../../../../../../extensions/marketplace/direct-listings/write/buyFromListing.js\")]);\n    if (!listing) {\n      throw new Error(\"Could not retrieve listing with ID: \".concat(listingId));\n    }\n    let _quantity = 1n;\n    // For ERC721 the quantity should always be 1n. We throw an error if user passes a different props\n    if (listing.asset.type === \"ERC721\") {\n      if (typeof quantity === \"bigint\" && (quantity !== 1n || quantity < 0n)) {\n        throw new Error(\"Invalid quantity. This is an ERC721 listing & quantity is always `1n`\");\n      }\n    } else if (listing.asset.type === \"ERC1155\") {\n      if (typeof quantity === \"bigint\") {\n        if (quantity > listing.quantity) {\n          throw new Error(\"quantity exceeds available amount. Available: \".concat(listing.quantity.toString()));\n        }\n        if (quantity < 0n) {\n          throw new Error(\"Invalid quantity. Should be at least 1n\");\n        }\n        _quantity = quantity;\n      }\n      _quantity = listing.quantity;\n    }\n    const buyTx = buyFromListing({\n      contract,\n      listingId,\n      quantity: _quantity,\n      recipient: (account === null || account === void 0 ? void 0 : account.address) || \"\"\n    });\n    const approveTx = await getApprovalForTransaction({\n      account,\n      transaction: buyTx\n    });\n    if (approveTx) {\n      await mutateAsync(approveTx);\n    }\n    return buyTx;\n  }, [account, contract, quantity, listingId, mutateAsync]);\n  return _jsx(TransactionButton, _objectSpread(_objectSpread({\n    payModal: _objectSpread({\n      metadata: defaultPayModalMetadata || payMetadata\n    }, payModal),\n    transaction: () => prepareBuyTransaction()\n  }, props), {}, {\n    children: children\n  }));\n}\n/**\n * @internal\n */\nasync function getPayMetadata(options) {\n  var _listing$asset, _listing$asset2;\n  const listing = await getListing(options);\n  if (!listing) {\n    return {\n      image: undefined,\n      name: undefined\n    };\n  }\n  return {\n    image: (_listing$asset = listing.asset) === null || _listing$asset === void 0 || (_listing$asset = _listing$asset.metadata) === null || _listing$asset === void 0 ? void 0 : _listing$asset.image,\n    name: (_listing$asset2 = listing.asset) === null || _listing$asset2 === void 0 || (_listing$asset2 = _listing$asset2.metadata) === null || _listing$asset2 === void 0 ? void 0 : _listing$asset2.name\n  };\n}","map":{"version":3,"names":["_objectSpread","useCallback","getContract","getListing","useReadContract","useActiveAccount","useSendAndConfirmTransaction","TransactionButton","BuyDirectListingButton","props","contractAddress","listingId","children","chain","client","quantity","payModal","defaultPayModalMetadata","metadata","undefined","account","contract","address","data","payMetadata","getPayMetadata","queryOptions","enabled","mutateAsync","prepareBuyTransaction","Error","listing","getApprovalForTransaction","buyFromListing","Promise","all","concat","_quantity","asset","type","toString","buyTx","recipient","approveTx","transaction","_jsx","options","_listing$asset","_listing$asset2","image","name"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/react/web/ui/prebuilt/thirdweb/BuyDirectListingButton/index.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback } from \"react\";\nimport type { Chain } from \"../../../../../../chains/types.js\";\nimport type { ThirdwebClient } from \"../../../../../../client/client.js\";\nimport { getContract } from \"../../../../../../contract/contract.js\";\nimport { getListing } from \"../../../../../../extensions/marketplace/direct-listings/read/getListing.js\";\nimport type { BaseTransactionOptions } from \"../../../../../../transaction/types.js\";\nimport { useReadContract } from \"../../../../../core/hooks/contract/useReadContract.js\";\nimport type { TransactionButtonProps } from \"../../../../../core/hooks/transaction/transaction-button-utils.js\";\nimport { useActiveAccount } from \"../../../../../core/hooks/wallets/useActiveAccount.js\";\nimport { useSendAndConfirmTransaction } from \"../../../../hooks/transaction/useSendAndConfirmTransaction.js\";\nimport { TransactionButton } from \"../../../TransactionButton/index.js\";\n\nexport type BuyDirectListingButtonProps = Omit<\n  TransactionButtonProps,\n  \"transaction\"\n> & {\n  /**\n   * The contract address of the Marketplace v3 contract.\n   */\n  contractAddress: string;\n\n  /**\n   * The chain which the Drop contract is deployed on\n   */\n  chain: Chain;\n\n  /**\n   * thirdweb Client\n   */\n  client: ThirdwebClient;\n\n  /**\n   * ID of the marketplace's DirectListing\n   */\n  listingId: bigint;\n\n  /**\n   * Qty to buy (optional)\n   *\n   * - For ERC721 listing: the `quantity` is always hard-coded to 1n - passing this props doesn't do anything\n   *\n   * - For ERC1155 listing: the `quantity` defaults to the quantity of the listing if not specified.\n   *\n   * The component will also throw an error if  you pass a `quantity` and it's greater than the listing's quantity\n   */\n  quantity?: bigint;\n};\n\n/**\n * This button is used with thirdweb Marketplace v3 contract, for buying NFT(s) from a listing.\n *\n * Under the hood, it prepares a transaction using the [`buyFromListing` extension](https://portal.thirdweb.com/references/typescript/v5/marketplace/buyFromListing)\n * and then pass it to a <TransactionButton />\n *\n * Since it uses the TransactionButton, it can take in any props that can be passed\n * to the [`TransactionButton`](https://portal.thirdweb.com/references/typescript/v5/TransactionButton)\n *\n * @param props props of type [BuyDirectListingButtonProps](https://portal.thirdweb.com/references/typescript/v5/BuyDirectListingButtonProps)\n * @example\n * ```tsx\n * import { BuyDirectListingButton } from \"thirdweb/react\";\n *\n * <BuyDirectListingButton\n *   contractAddress=\"0x...\" // contract address of the marketplace v3\n *   chain={...} // the chain which the marketplace contract is deployed on\n *   client={...} // thirdweb client\n *   listingId={100n} // the listingId or the item you want to buy\n *   quantity={1n} // optional - see the docs to learn more\n * >\n *   Buy NFT\n * </BuyDirectListingButton>\n * ```\n *\n * For error handling & callbacks on transaction-sent and transaction-confirmed,\n * please refer to the TransactionButton docs.\n * @component\n * @transaction\n */\nexport function BuyDirectListingButton(props: BuyDirectListingButtonProps) {\n  const {\n    contractAddress,\n    listingId,\n    children,\n    chain,\n    client,\n    quantity,\n    payModal,\n  } = props;\n  const defaultPayModalMetadata = payModal ? payModal.metadata : undefined;\n  const account = useActiveAccount();\n  const contract = getContract({\n    address: contractAddress,\n    chain,\n    client,\n  });\n\n  const { data: payMetadata } = useReadContract(getPayMetadata, {\n    contract,\n    listingId,\n    queryOptions: {\n      enabled: !defaultPayModalMetadata,\n    },\n  });\n\n  const { mutateAsync } = useSendAndConfirmTransaction({\n    payModal:\n      typeof payModal === \"object\"\n        ? {\n            ...payModal,\n            metadata: payModal.metadata || payMetadata,\n          }\n        : payModal,\n  });\n\n  const prepareBuyTransaction = useCallback(async () => {\n    if (!account) {\n      throw new Error(\"No account detected\");\n    }\n    const [listing, { getApprovalForTransaction }, { buyFromListing }] =\n      await Promise.all([\n        getListing({\n          contract,\n          listingId,\n        }),\n        import(\n          \"../../../../../../extensions/erc20/write/getApprovalForTransaction.js\"\n        ),\n        import(\n          \"../../../../../../extensions/marketplace/direct-listings/write/buyFromListing.js\"\n        ),\n      ]);\n    if (!listing) {\n      throw new Error(`Could not retrieve listing with ID: ${listingId}`);\n    }\n\n    let _quantity = 1n;\n    // For ERC721 the quantity should always be 1n. We throw an error if user passes a different props\n    if (listing.asset.type === \"ERC721\") {\n      if (typeof quantity === \"bigint\" && (quantity !== 1n || quantity < 0n)) {\n        throw new Error(\n          \"Invalid quantity. This is an ERC721 listing & quantity is always `1n`\",\n        );\n      }\n    } else if (listing.asset.type === \"ERC1155\") {\n      if (typeof quantity === \"bigint\") {\n        if (quantity > listing.quantity) {\n          throw new Error(\n            `quantity exceeds available amount. Available: ${listing.quantity.toString()}`,\n          );\n        }\n        if (quantity < 0n) {\n          throw new Error(\"Invalid quantity. Should be at least 1n\");\n        }\n        _quantity = quantity;\n      }\n      _quantity = listing.quantity;\n    }\n\n    const buyTx = buyFromListing({\n      contract,\n      listingId,\n      quantity: _quantity,\n      recipient: account?.address || \"\",\n    });\n\n    const approveTx = await getApprovalForTransaction({\n      account,\n      transaction: buyTx,\n    });\n\n    if (approveTx) {\n      await mutateAsync(approveTx);\n    }\n\n    return buyTx;\n  }, [account, contract, quantity, listingId, mutateAsync]);\n\n  return (\n    <TransactionButton\n      payModal={{\n        metadata: defaultPayModalMetadata || payMetadata,\n        ...payModal,\n      }}\n      transaction={() => prepareBuyTransaction()}\n      {...props}\n    >\n      {children}\n    </TransactionButton>\n  );\n}\n\n/**\n * @internal\n */\nasync function getPayMetadata(\n  options: BaseTransactionOptions<{ listingId: bigint }>,\n): Promise<{ name?: string; image?: string }> {\n  const listing = await getListing(options);\n  if (!listing) {\n    return { image: undefined, name: undefined };\n  }\n  return {\n    image: listing.asset?.metadata?.image,\n    name: listing.asset?.metadata?.name,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}