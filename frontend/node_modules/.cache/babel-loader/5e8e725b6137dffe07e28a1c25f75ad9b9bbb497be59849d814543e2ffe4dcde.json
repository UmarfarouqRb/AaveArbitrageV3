{"ast":null,"code":"import { ethereum } from \"../../../../chains/chain-definitions/ethereum.js\";\nimport { socialAuthOptions } from \"../../../../wallets/types.js\";\nimport { create7702MinimalAccount } from \"../eip7702/minimal-account.js\";\n/**\n * Checks if the provided wallet is an in-app wallet.\n *\n * @param wallet - The wallet to check.\n * @returns True if the wallet is an in-app wallet, false otherwise.\n */\nexport function isInAppWallet(wallet) {\n  return wallet.id === \"inApp\" || wallet.id === \"embedded\";\n}\n/**\n * @internal\n */\nexport async function connectInAppWallet(options, createOptions, connector) {\n  var _createOptions$auth, _createOptions$auth2;\n  if (\n  // if auth mode is not specified, the default is popup\n  (createOptions === null || createOptions === void 0 || (_createOptions$auth = createOptions.auth) === null || _createOptions$auth === void 0 ? void 0 : _createOptions$auth.mode) !== \"popup\" && (createOptions === null || createOptions === void 0 || (_createOptions$auth2 = createOptions.auth) === null || _createOptions$auth2 === void 0 ? void 0 : _createOptions$auth2.mode) !== undefined && connector.authenticateWithRedirect) {\n    const strategy = options.strategy;\n    if (socialAuthOptions.includes(strategy)) {\n      var _createOptions$auth3, _createOptions$auth4;\n      await connector.authenticateWithRedirect(strategy, createOptions === null || createOptions === void 0 || (_createOptions$auth3 = createOptions.auth) === null || _createOptions$auth3 === void 0 ? void 0 : _createOptions$auth3.mode, createOptions === null || createOptions === void 0 || (_createOptions$auth4 = createOptions.auth) === null || _createOptions$auth4 === void 0 ? void 0 : _createOptions$auth4.redirectUrl);\n    }\n  }\n  // If we don't have authenticateWithRedirect then it's likely react native, so the default is to redirect and we can carry on\n  // IF WE EVER ADD MORE CONNECTOR TYPES, this could cause redirect to be ignored despite being specified\n  // TODO: In V6, make everything redirect auth\n  const authResult = await connector.connect(options);\n  const authAccount = authResult.user.account;\n  return createInAppAccount({\n    authAccount,\n    client: options.client,\n    createOptions,\n    desiredChain: options.chain\n  });\n}\n/**\n * @internal\n */\nexport async function autoConnectInAppWallet(options, createOptions, connector) {\n  if (options.authResult && connector.loginWithAuthToken) {\n    await connector.loginWithAuthToken(options.authResult);\n  }\n  const user = await getAuthenticatedUser(connector);\n  if (!user) {\n    throw new Error(\"Failed to authenticate user.\");\n  }\n  const authAccount = user.account;\n  return createInAppAccount({\n    authAccount,\n    client: options.client,\n    createOptions,\n    desiredChain: options.chain\n  });\n}\nasync function convertToSmartAccount(options) {\n  const {\n    connectSmartAccount\n  } = await import(\"../../../smart/index.js\");\n  return connectSmartAccount({\n    chain: options.chain,\n    client: options.client,\n    personalAccount: options.authAccount\n  }, options.smartAccountOptions);\n}\nasync function getAuthenticatedUser(connector) {\n  const user = await connector.getUser();\n  switch (user.status) {\n    case \"Logged In, Wallet Initialized\":\n      {\n        return user;\n      }\n  }\n  return undefined;\n}\nasync function createInAppAccount(options) {\n  const {\n    createOptions,\n    authAccount,\n    desiredChain,\n    client\n  } = options;\n  let smartAccountOptions;\n  let eip7702;\n  const executionMode = createOptions && \"executionMode\" in createOptions ? createOptions.executionMode : undefined;\n  if (executionMode) {\n    if (executionMode.mode === \"EIP4337\") {\n      smartAccountOptions = executionMode.smartAccount;\n    } else if (executionMode.mode === \"EIP7702\") {\n      eip7702 = executionMode;\n    }\n  }\n  // backwards compatibility\n  if (createOptions && \"smartAccount\" in createOptions && createOptions !== null && createOptions !== void 0 && createOptions.smartAccount) {\n    smartAccountOptions = createOptions.smartAccount;\n  }\n  if (smartAccountOptions) {\n    const [account, chain] = await convertToSmartAccount({\n      authAccount,\n      chain: desiredChain,\n      client,\n      smartAccountOptions\n    });\n    return {\n      account,\n      adminAccount: authAccount,\n      chain\n    };\n  }\n  if (eip7702) {\n    const chain = desiredChain;\n    if (!chain) {\n      throw new Error(\"Chain is required for EIP-7702 execution, pass a chain when connecting the inAppWallet.\");\n    }\n    const account = create7702MinimalAccount({\n      adminAccount: authAccount,\n      client,\n      sponsorGas: eip7702.sponsorGas\n    });\n    return {\n      account,\n      adminAccount: authAccount,\n      chain\n    };\n  }\n  return {\n    account: authAccount,\n    chain: desiredChain || ethereum\n  };\n}","map":{"version":3,"names":["ethereum","socialAuthOptions","create7702MinimalAccount","isInAppWallet","wallet","id","connectInAppWallet","options","createOptions","connector","_createOptions$auth","_createOptions$auth2","auth","mode","undefined","authenticateWithRedirect","strategy","includes","_createOptions$auth3","_createOptions$auth4","redirectUrl","authResult","connect","authAccount","user","account","createInAppAccount","client","desiredChain","chain","autoConnectInAppWallet","loginWithAuthToken","getAuthenticatedUser","Error","convertToSmartAccount","connectSmartAccount","personalAccount","smartAccountOptions","getUser","status","eip7702","executionMode","smartAccount","adminAccount","sponsorGas"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/wallets/in-app/core/wallet/index.ts"],"sourcesContent":["import { ethereum } from \"../../../../chains/chain-definitions/ethereum.js\";\nimport type { Chain } from \"../../../../chains/types.js\";\nimport type { ThirdwebClient } from \"../../../../client/client.js\";\nimport {\n  type SocialAuthOption,\n  socialAuthOptions,\n} from \"../../../../wallets/types.js\";\nimport type {\n  EcosystemWalletConnectionOptions,\n  EcosystemWalletCreationOptions,\n} from \"../../../ecosystem/types.js\";\nimport type { Account, Wallet } from \"../../../interfaces/wallet.js\";\nimport type { SmartWalletOptions } from \"../../../smart/types.js\";\nimport type {\n  CreateWalletArgs,\n  EcosystemWalletId,\n  WalletAutoConnectionOption,\n  WalletId,\n} from \"../../../wallet-types.js\";\nimport { create7702MinimalAccount } from \"../eip7702/minimal-account.js\";\nimport type { InAppConnector } from \"../interfaces/connector.js\";\nimport type {\n  ExecutionModeOptions,\n  InAppWalletConnectionOptions,\n  InAppWalletCreationOptions,\n} from \"./types.js\";\n\n/**\n * Checks if the provided wallet is an in-app wallet.\n *\n * @param wallet - The wallet to check.\n * @returns True if the wallet is an in-app wallet, false otherwise.\n */\nexport function isInAppWallet(\n  wallet: Wallet<WalletId>,\n): wallet is Wallet<\"inApp\" | \"embedded\"> {\n  return wallet.id === \"inApp\" || wallet.id === \"embedded\";\n}\n\n/**\n * @internal\n */\nexport async function connectInAppWallet(\n  options: InAppWalletConnectionOptions | EcosystemWalletConnectionOptions,\n  createOptions: InAppWalletCreationOptions | EcosystemWalletCreationOptions,\n  connector: InAppConnector,\n): Promise<{ account: Account; chain: Chain; adminAccount?: Account }> {\n  if (\n    // if auth mode is not specified, the default is popup\n    createOptions?.auth?.mode !== \"popup\" &&\n    createOptions?.auth?.mode !== undefined &&\n    connector.authenticateWithRedirect\n  ) {\n    const strategy = options.strategy;\n    if (socialAuthOptions.includes(strategy as SocialAuthOption)) {\n      await connector.authenticateWithRedirect(\n        strategy as SocialAuthOption,\n        createOptions?.auth?.mode,\n        createOptions?.auth?.redirectUrl,\n      );\n    }\n  }\n  // If we don't have authenticateWithRedirect then it's likely react native, so the default is to redirect and we can carry on\n  // IF WE EVER ADD MORE CONNECTOR TYPES, this could cause redirect to be ignored despite being specified\n  // TODO: In V6, make everything redirect auth\n\n  const authResult = await connector.connect(options);\n  const authAccount = authResult.user.account;\n\n  return createInAppAccount({\n    authAccount,\n    client: options.client,\n    createOptions,\n    desiredChain: options.chain,\n  });\n}\n\n/**\n * @internal\n */\nexport async function autoConnectInAppWallet(\n  options:\n    | WalletAutoConnectionOption<\"inApp\">\n    | WalletAutoConnectionOption<EcosystemWalletId>,\n  createOptions:\n    | CreateWalletArgs<\"inApp\">[1]\n    | CreateWalletArgs<EcosystemWalletId>[1],\n  connector: InAppConnector,\n): Promise<{ account: Account; chain: Chain; adminAccount?: Account }> {\n  if (options.authResult && connector.loginWithAuthToken) {\n    await connector.loginWithAuthToken(options.authResult);\n  }\n\n  const user = await getAuthenticatedUser(connector);\n  if (!user) {\n    throw new Error(\"Failed to authenticate user.\");\n  }\n\n  const authAccount = user.account;\n\n  return createInAppAccount({\n    authAccount,\n    client: options.client,\n    createOptions,\n    desiredChain: options.chain,\n  });\n}\n\nasync function convertToSmartAccount(options: {\n  client: ThirdwebClient;\n  authAccount: Account;\n  smartAccountOptions: CreateWalletArgs<\"smart\">[1];\n  chain?: Chain;\n}) {\n  const { connectSmartAccount } = await import(\"../../../smart/index.js\");\n\n  return connectSmartAccount(\n    {\n      chain: options.chain,\n      client: options.client,\n      personalAccount: options.authAccount,\n    },\n    options.smartAccountOptions,\n  );\n}\n\nasync function getAuthenticatedUser(connector: InAppConnector) {\n  const user = await connector.getUser();\n  switch (user.status) {\n    case \"Logged In, Wallet Initialized\": {\n      return user;\n    }\n  }\n  return undefined;\n}\n\nasync function createInAppAccount(options: {\n  client: ThirdwebClient;\n  authAccount: Account;\n  createOptions: InAppWalletCreationOptions | EcosystemWalletCreationOptions;\n  desiredChain?: Chain;\n}) {\n  const { createOptions, authAccount, desiredChain, client } = options;\n  let smartAccountOptions: SmartWalletOptions | undefined;\n  let eip7702: Extract<ExecutionModeOptions, { mode: \"EIP7702\" }> | undefined;\n  const executionMode =\n    createOptions && \"executionMode\" in createOptions\n      ? createOptions.executionMode\n      : undefined;\n\n  if (executionMode) {\n    if (executionMode.mode === \"EIP4337\") {\n      smartAccountOptions = executionMode.smartAccount;\n    } else if (executionMode.mode === \"EIP7702\") {\n      eip7702 = executionMode;\n    }\n  }\n\n  // backwards compatibility\n  if (\n    createOptions &&\n    \"smartAccount\" in createOptions &&\n    createOptions?.smartAccount\n  ) {\n    smartAccountOptions = createOptions.smartAccount;\n  }\n\n  if (smartAccountOptions) {\n    const [account, chain] = await convertToSmartAccount({\n      authAccount,\n      chain: desiredChain,\n      client,\n      smartAccountOptions,\n    });\n    return { account, adminAccount: authAccount, chain };\n  }\n\n  if (eip7702) {\n    const chain = desiredChain;\n    if (!chain) {\n      throw new Error(\n        \"Chain is required for EIP-7702 execution, pass a chain when connecting the inAppWallet.\",\n      );\n    }\n    const account = create7702MinimalAccount({\n      adminAccount: authAccount,\n      client,\n      sponsorGas: eip7702.sponsorGas,\n    });\n    return {\n      account,\n      adminAccount: authAccount,\n      chain,\n    };\n  }\n\n  return { account: authAccount, chain: desiredChain || ethereum } as const;\n}\n"],"mappings":"AAAA,SAASA,QAAQ,QAAQ,kDAAkD;AAG3E,SAEEC,iBAAiB,QACZ,8BAA8B;AAarC,SAASC,wBAAwB,QAAQ,+BAA+B;AAQxE;;;;;;AAMA,OAAM,SAAUC,aAAaA,CAC3BC,MAAwB;EAExB,OAAOA,MAAM,CAACC,EAAE,KAAK,OAAO,IAAID,MAAM,CAACC,EAAE,KAAK,UAAU;AAC1D;AAEA;;;AAGA,OAAO,eAAeC,kBAAkBA,CACtCC,OAAwE,EACxEC,aAA0E,EAC1EC,SAAyB;EAAA,IAAAC,mBAAA,EAAAC,oBAAA;EAEzB;EACE;EACA,CAAAH,aAAa,aAAbA,aAAa,gBAAAE,mBAAA,GAAbF,aAAa,CAAEI,IAAI,cAAAF,mBAAA,uBAAnBA,mBAAA,CAAqBG,IAAI,MAAK,OAAO,IACrC,CAAAL,aAAa,aAAbA,aAAa,gBAAAG,oBAAA,GAAbH,aAAa,CAAEI,IAAI,cAAAD,oBAAA,uBAAnBA,oBAAA,CAAqBE,IAAI,MAAKC,SAAS,IACvCL,SAAS,CAACM,wBAAwB,EAClC;IACA,MAAMC,QAAQ,GAAGT,OAAO,CAACS,QAAQ;IACjC,IAAIf,iBAAiB,CAACgB,QAAQ,CAACD,QAA4B,CAAC,EAAE;MAAA,IAAAE,oBAAA,EAAAC,oBAAA;MAC5D,MAAMV,SAAS,CAACM,wBAAwB,CACtCC,QAA4B,EAC5BR,aAAa,aAAbA,aAAa,gBAAAU,oBAAA,GAAbV,aAAa,CAAEI,IAAI,cAAAM,oBAAA,uBAAnBA,oBAAA,CAAqBL,IAAI,EACzBL,aAAa,aAAbA,aAAa,gBAAAW,oBAAA,GAAbX,aAAa,CAAEI,IAAI,cAAAO,oBAAA,uBAAnBA,oBAAA,CAAqBC,WAAW,CACjC;IACH;EACF;EACA;EACA;EACA;EAEA,MAAMC,UAAU,GAAG,MAAMZ,SAAS,CAACa,OAAO,CAACf,OAAO,CAAC;EACnD,MAAMgB,WAAW,GAAGF,UAAU,CAACG,IAAI,CAACC,OAAO;EAE3C,OAAOC,kBAAkB,CAAC;IACxBH,WAAW;IACXI,MAAM,EAAEpB,OAAO,CAACoB,MAAM;IACtBnB,aAAa;IACboB,YAAY,EAAErB,OAAO,CAACsB;GACvB,CAAC;AACJ;AAEA;;;AAGA,OAAO,eAAeC,sBAAsBA,CAC1CvB,OAEiD,EACjDC,aAE0C,EAC1CC,SAAyB;EAEzB,IAAIF,OAAO,CAACc,UAAU,IAAIZ,SAAS,CAACsB,kBAAkB,EAAE;IACtD,MAAMtB,SAAS,CAACsB,kBAAkB,CAACxB,OAAO,CAACc,UAAU,CAAC;EACxD;EAEA,MAAMG,IAAI,GAAG,MAAMQ,oBAAoB,CAACvB,SAAS,CAAC;EAClD,IAAI,CAACe,IAAI,EAAE;IACT,MAAM,IAAIS,KAAK,CAAC,8BAA8B,CAAC;EACjD;EAEA,MAAMV,WAAW,GAAGC,IAAI,CAACC,OAAO;EAEhC,OAAOC,kBAAkB,CAAC;IACxBH,WAAW;IACXI,MAAM,EAAEpB,OAAO,CAACoB,MAAM;IACtBnB,aAAa;IACboB,YAAY,EAAErB,OAAO,CAACsB;GACvB,CAAC;AACJ;AAEA,eAAeK,qBAAqBA,CAAC3B,OAKpC;EACC,MAAM;IAAE4B;EAAmB,CAAE,GAAG,MAAM,MAAM,CAAC,yBAAyB,CAAC;EAEvE,OAAOA,mBAAmB,CACxB;IACEN,KAAK,EAAEtB,OAAO,CAACsB,KAAK;IACpBF,MAAM,EAAEpB,OAAO,CAACoB,MAAM;IACtBS,eAAe,EAAE7B,OAAO,CAACgB;GAC1B,EACDhB,OAAO,CAAC8B,mBAAmB,CAC5B;AACH;AAEA,eAAeL,oBAAoBA,CAACvB,SAAyB;EAC3D,MAAMe,IAAI,GAAG,MAAMf,SAAS,CAAC6B,OAAO,EAAE;EACtC,QAAQd,IAAI,CAACe,MAAM;IACjB,KAAK,+BAA+B;MAAE;QACpC,OAAOf,IAAI;MACb;EACF;EACA,OAAOV,SAAS;AAClB;AAEA,eAAeY,kBAAkBA,CAACnB,OAKjC;EACC,MAAM;IAAEC,aAAa;IAAEe,WAAW;IAAEK,YAAY;IAAED;EAAM,CAAE,GAAGpB,OAAO;EACpE,IAAI8B,mBAAmD;EACvD,IAAIG,OAAuE;EAC3E,MAAMC,aAAa,GACjBjC,aAAa,IAAI,eAAe,IAAIA,aAAa,GAC7CA,aAAa,CAACiC,aAAa,GAC3B3B,SAAS;EAEf,IAAI2B,aAAa,EAAE;IACjB,IAAIA,aAAa,CAAC5B,IAAI,KAAK,SAAS,EAAE;MACpCwB,mBAAmB,GAAGI,aAAa,CAACC,YAAY;IAClD,CAAC,MAAM,IAAID,aAAa,CAAC5B,IAAI,KAAK,SAAS,EAAE;MAC3C2B,OAAO,GAAGC,aAAa;IACzB;EACF;EAEA;EACA,IACEjC,aAAa,IACb,cAAc,IAAIA,aAAa,IAC/BA,aAAa,aAAbA,aAAa,eAAbA,aAAa,CAAEkC,YAAY,EAC3B;IACAL,mBAAmB,GAAG7B,aAAa,CAACkC,YAAY;EAClD;EAEA,IAAIL,mBAAmB,EAAE;IACvB,MAAM,CAACZ,OAAO,EAAEI,KAAK,CAAC,GAAG,MAAMK,qBAAqB,CAAC;MACnDX,WAAW;MACXM,KAAK,EAAED,YAAY;MACnBD,MAAM;MACNU;KACD,CAAC;IACF,OAAO;MAAEZ,OAAO;MAAEkB,YAAY,EAAEpB,WAAW;MAAEM;IAAK,CAAE;EACtD;EAEA,IAAIW,OAAO,EAAE;IACX,MAAMX,KAAK,GAAGD,YAAY;IAC1B,IAAI,CAACC,KAAK,EAAE;MACV,MAAM,IAAII,KAAK,CACb,yFAAyF,CAC1F;IACH;IACA,MAAMR,OAAO,GAAGvB,wBAAwB,CAAC;MACvCyC,YAAY,EAAEpB,WAAW;MACzBI,MAAM;MACNiB,UAAU,EAAEJ,OAAO,CAACI;KACrB,CAAC;IACF,OAAO;MACLnB,OAAO;MACPkB,YAAY,EAAEpB,WAAW;MACzBM;KACD;EACH;EAEA,OAAO;IAAEJ,OAAO,EAAEF,WAAW;IAAEM,KAAK,EAAED,YAAY,IAAI5B;EAAQ,CAAW;AAC3E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}