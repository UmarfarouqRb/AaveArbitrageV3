{"ast":null,"code":"import { encodeAbiParameters } from \"viem\";\nimport { ZERO_ADDRESS } from \"../../../../constants/addresses.js\";\nimport { getContract } from \"../../../../contract/contract.js\";\nimport { getAddress } from \"../../../../utils/address.js\";\nimport { isHex } from \"../../../../utils/encoding/helpers/is-hex.js\";\nimport { keccak256 } from \"../../../../utils/hashing/keccak256.js\";\nimport { stringify } from \"../../../../utils/json.js\";\nimport { readContract } from \"../../../read-contract.js\";\n// we do not send multiple batches so this stays consistent\nconst BATCH_ID = 0n;\n/**\n * @internal - only exported for testing\n */\nexport async function prepareBiconomyTransaction(_ref) {\n  var _gasless$deadlineSeco;\n  let {\n    account,\n    serializableTransaction,\n    transaction,\n    gasless\n  } = _ref;\n  const forwarderContract = getContract({\n    address: gasless.relayerForwarderAddress,\n    chain: transaction.chain,\n    client: transaction.client\n  });\n  // get the nonce\n  const nonce = await readContract({\n    contract: forwarderContract,\n    method: \"function getNonce(address,uint256) view returns (uint256)\",\n    params: [account.address, BATCH_ID]\n  });\n  const deadline = Math.floor(Date.now() / 1000) + ((_gasless$deadlineSeco = gasless.deadlineSeconds) !== null && _gasless$deadlineSeco !== void 0 ? _gasless$deadlineSeco : 3600);\n  const request = {\n    batchId: BATCH_ID,\n    batchNonce: nonce,\n    data: serializableTransaction.data,\n    deadline: deadline,\n    from: account.address,\n    to: serializableTransaction.to,\n    token: ZERO_ADDRESS,\n    tokenGasPrice: 0n,\n    txGas: serializableTransaction.gas\n  };\n  if (!request.to) {\n    throw new Error(\"Cannot send a transaction without a `to` address\");\n  }\n  if (!request.txGas) {\n    throw new Error(\"Cannot send a transaction without a `gas` value\");\n  }\n  if (!request.data) {\n    throw new Error(\"Cannot send a transaction without a `data` value\");\n  }\n  // create the hash\n  const message = encodeAbiParameters([{\n    type: \"address\"\n  }, {\n    type: \"address\"\n  }, {\n    type: \"address\"\n  }, {\n    type: \"uint256\"\n  }, {\n    type: \"uint256\"\n  }, {\n    type: \"uint256\"\n  }, {\n    type: \"uint256\"\n  }, {\n    type: \"bytes32\"\n  }], [getAddress(request.from), getAddress(request.to), getAddress(request.token), request.txGas, request.tokenGasPrice, request.batchId, request.batchNonce, keccak256(request.data)]);\n  const signature = await account.signMessage({\n    message\n  });\n  return [request, signature];\n}\n/**\n * @internal\n */\nexport async function relayBiconomyTransaction(options) {\n  const [request, signature] = await prepareBiconomyTransaction(options);\n  // send the transaction to the biconomy api\n  const response = await fetch(\"https://api.biconomy.io/api/v2/meta-tx/native\", {\n    body: stringify({\n      apiId: options.gasless.apiId,\n      from: request.from,\n      gasLimit: request.txGas,\n      params: [request, signature],\n      to: request.to\n    }),\n    headers: {\n      \"Content-Type\": \"application/json;charset=utf-8\",\n      \"x-api-key\": options.gasless.apiKey\n    },\n    method: \"POST\"\n  });\n  if (!response.ok) {\n    throw new Error(\"Failed to send transaction: \".concat(await response.text()));\n  }\n  const json = await response.json();\n  const transactionHash = json.txHash;\n  if (isHex(transactionHash)) {\n    return {\n      chain: options.transaction.chain,\n      client: options.transaction.client,\n      transactionHash: transactionHash\n    };\n  }\n  throw new Error(\"Failed to send transaction: \".concat(stringify(json)));\n}","map":{"version":3,"names":["encodeAbiParameters","ZERO_ADDRESS","getContract","getAddress","isHex","keccak256","stringify","readContract","BATCH_ID","prepareBiconomyTransaction","_ref","_gasless$deadlineSeco","account","serializableTransaction","transaction","gasless","forwarderContract","address","relayerForwarderAddress","chain","client","nonce","contract","method","params","deadline","Math","floor","Date","now","deadlineSeconds","request","batchId","batchNonce","data","from","to","token","tokenGasPrice","txGas","gas","Error","message","type","signature","signMessage","relayBiconomyTransaction","options","response","fetch","body","apiId","gasLimit","headers","apiKey","ok","concat","text","json","transactionHash","txHash"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/transaction/actions/gasless/providers/biconomy.ts"],"sourcesContent":["import type { Address } from \"abitype\";\nimport { encodeAbiParameters } from \"viem\";\nimport { ZERO_ADDRESS } from \"../../../../constants/addresses.js\";\nimport { getContract } from \"../../../../contract/contract.js\";\nimport { getAddress } from \"../../../../utils/address.js\";\nimport { isHex } from \"../../../../utils/encoding/helpers/is-hex.js\";\nimport { keccak256 } from \"../../../../utils/hashing/keccak256.js\";\nimport { stringify } from \"../../../../utils/json.js\";\nimport type { Account } from \"../../../../wallets/interfaces/wallet.js\";\nimport type { PreparedTransaction } from \"../../../prepare-transaction.js\";\nimport { readContract } from \"../../../read-contract.js\";\nimport type { SerializableTransaction } from \"../../../serialize-transaction.js\";\nimport type { WaitForReceiptOptions } from \"../../wait-for-tx-receipt.js\";\n\n/**\n * @transaction\n */\nexport type BiconomyOptions = {\n  provider: \"biconomy\";\n  // you can find the correct forwarder for your network here: https://docs-gasless.biconomy.io/misc/contract-addresses\n  relayerForwarderAddress: Address;\n  apiId: string;\n  apiKey: string;\n  deadlineSeconds?: number; // default: 3600\n};\n\ntype SendBiconomyTransactionOptions = {\n  account: Account;\n  // TODO: update this to `Transaction<\"prepared\">` once the type is available to ensure only prepared transactions are accepted\n  // biome-ignore lint/suspicious/noExplicitAny: library function that accepts any prepared transaction type\n  transaction: PreparedTransaction<any>;\n  serializableTransaction: SerializableTransaction;\n  gasless: BiconomyOptions;\n};\n\n// we do not send multiple batches so this stays consistent\nconst BATCH_ID = 0n;\n\n/**\n * @internal - only exported for testing\n */\nexport async function prepareBiconomyTransaction({\n  account,\n  serializableTransaction,\n  transaction,\n  gasless,\n}: SendBiconomyTransactionOptions) {\n  const forwarderContract = getContract({\n    address: gasless.relayerForwarderAddress,\n    chain: transaction.chain,\n    client: transaction.client,\n  });\n\n  // get the nonce\n  const nonce = await readContract({\n    contract: forwarderContract,\n    method: \"function getNonce(address,uint256) view returns (uint256)\",\n    params: [account.address, BATCH_ID],\n  });\n\n  const deadline =\n    Math.floor(Date.now() / 1000) + (gasless.deadlineSeconds ?? 3600);\n\n  const request = {\n    batchId: BATCH_ID,\n    batchNonce: nonce,\n    data: serializableTransaction.data,\n    deadline: deadline,\n    from: account.address,\n    to: serializableTransaction.to,\n    token: ZERO_ADDRESS,\n    tokenGasPrice: 0n,\n    txGas: serializableTransaction.gas,\n  };\n\n  if (!request.to) {\n    throw new Error(\"Cannot send a transaction without a `to` address\");\n  }\n  if (!request.txGas) {\n    throw new Error(\"Cannot send a transaction without a `gas` value\");\n  }\n  if (!request.data) {\n    throw new Error(\"Cannot send a transaction without a `data` value\");\n  }\n\n  // create the hash\n  const message = encodeAbiParameters(\n    [\n      { type: \"address\" },\n      { type: \"address\" },\n      { type: \"address\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"bytes32\" },\n    ],\n    [\n      getAddress(request.from),\n      getAddress(request.to),\n      getAddress(request.token),\n      request.txGas,\n      request.tokenGasPrice,\n      request.batchId,\n      request.batchNonce,\n      keccak256(request.data),\n    ],\n  );\n\n  const signature = await account.signMessage({ message });\n\n  return [request, signature] as const;\n}\n\n/**\n * @internal\n */\nexport async function relayBiconomyTransaction(\n  options: SendBiconomyTransactionOptions,\n): Promise<WaitForReceiptOptions> {\n  const [request, signature] = await prepareBiconomyTransaction(options);\n\n  // send the transaction to the biconomy api\n  const response = await fetch(\n    \"https://api.biconomy.io/api/v2/meta-tx/native\",\n    {\n      body: stringify({\n        apiId: options.gasless.apiId,\n        from: request.from,\n        gasLimit: request.txGas,\n        params: [request, signature],\n        to: request.to,\n      }),\n      headers: {\n        \"Content-Type\": \"application/json;charset=utf-8\",\n        \"x-api-key\": options.gasless.apiKey,\n      },\n      method: \"POST\",\n    },\n  );\n  if (!response.ok) {\n    throw new Error(`Failed to send transaction: ${await response.text()}`);\n  }\n  const json = await response.json();\n  const transactionHash = json.txHash;\n  if (isHex(transactionHash)) {\n    return {\n      chain: options.transaction.chain,\n      client: options.transaction.client,\n      transactionHash: transactionHash,\n    };\n  }\n  throw new Error(`Failed to send transaction: ${stringify(json)}`);\n}\n"],"mappings":"AACA,SAASA,mBAAmB,QAAQ,MAAM;AAC1C,SAASC,YAAY,QAAQ,oCAAoC;AACjE,SAASC,WAAW,QAAQ,kCAAkC;AAC9D,SAASC,UAAU,QAAQ,8BAA8B;AACzD,SAASC,KAAK,QAAQ,8CAA8C;AACpE,SAASC,SAAS,QAAQ,wCAAwC;AAClE,SAASC,SAAS,QAAQ,2BAA2B;AAGrD,SAASC,YAAY,QAAQ,2BAA2B;AAyBxD;AACA,MAAMC,QAAQ,GAAG,EAAE;AAEnB;;;AAGA,OAAO,eAAeC,0BAA0BA,CAAAC,IAAA,EAKf;EAAA,IAAAC,qBAAA;EAAA,IALgB;IAC/CC,OAAO;IACPC,uBAAuB;IACvBC,WAAW;IACXC;EAAO,CACwB,GAAAL,IAAA;EAC/B,MAAMM,iBAAiB,GAAGd,WAAW,CAAC;IACpCe,OAAO,EAAEF,OAAO,CAACG,uBAAuB;IACxCC,KAAK,EAAEL,WAAW,CAACK,KAAK;IACxBC,MAAM,EAAEN,WAAW,CAACM;GACrB,CAAC;EAEF;EACA,MAAMC,KAAK,GAAG,MAAMd,YAAY,CAAC;IAC/Be,QAAQ,EAAEN,iBAAiB;IAC3BO,MAAM,EAAE,2DAA2D;IACnEC,MAAM,EAAE,CAACZ,OAAO,CAACK,OAAO,EAAET,QAAQ;GACnC,CAAC;EAEF,MAAMiB,QAAQ,GACZC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACC,GAAG,EAAE,GAAG,IAAI,CAAC,KAAAlB,qBAAA,GAAII,OAAO,CAACe,eAAe,cAAAnB,qBAAA,cAAAA,qBAAA,GAAI,IAAI,CAAC;EAEnE,MAAMoB,OAAO,GAAG;IACdC,OAAO,EAAExB,QAAQ;IACjByB,UAAU,EAAEZ,KAAK;IACjBa,IAAI,EAAErB,uBAAuB,CAACqB,IAAI;IAClCT,QAAQ,EAAEA,QAAQ;IAClBU,IAAI,EAAEvB,OAAO,CAACK,OAAO;IACrBmB,EAAE,EAAEvB,uBAAuB,CAACuB,EAAE;IAC9BC,KAAK,EAAEpC,YAAY;IACnBqC,aAAa,EAAE,EAAE;IACjBC,KAAK,EAAE1B,uBAAuB,CAAC2B;GAChC;EAED,IAAI,CAACT,OAAO,CAACK,EAAE,EAAE;IACf,MAAM,IAAIK,KAAK,CAAC,kDAAkD,CAAC;EACrE;EACA,IAAI,CAACV,OAAO,CAACQ,KAAK,EAAE;IAClB,MAAM,IAAIE,KAAK,CAAC,iDAAiD,CAAC;EACpE;EACA,IAAI,CAACV,OAAO,CAACG,IAAI,EAAE;IACjB,MAAM,IAAIO,KAAK,CAAC,kDAAkD,CAAC;EACrE;EAEA;EACA,MAAMC,OAAO,GAAG1C,mBAAmB,CACjC,CACE;IAAE2C,IAAI,EAAE;EAAS,CAAE,EACnB;IAAEA,IAAI,EAAE;EAAS,CAAE,EACnB;IAAEA,IAAI,EAAE;EAAS,CAAE,EACnB;IAAEA,IAAI,EAAE;EAAS,CAAE,EACnB;IAAEA,IAAI,EAAE;EAAS,CAAE,EACnB;IAAEA,IAAI,EAAE;EAAS,CAAE,EACnB;IAAEA,IAAI,EAAE;EAAS,CAAE,EACnB;IAAEA,IAAI,EAAE;EAAS,CAAE,CACpB,EACD,CACExC,UAAU,CAAC4B,OAAO,CAACI,IAAI,CAAC,EACxBhC,UAAU,CAAC4B,OAAO,CAACK,EAAE,CAAC,EACtBjC,UAAU,CAAC4B,OAAO,CAACM,KAAK,CAAC,EACzBN,OAAO,CAACQ,KAAK,EACbR,OAAO,CAACO,aAAa,EACrBP,OAAO,CAACC,OAAO,EACfD,OAAO,CAACE,UAAU,EAClB5B,SAAS,CAAC0B,OAAO,CAACG,IAAI,CAAC,CACxB,CACF;EAED,MAAMU,SAAS,GAAG,MAAMhC,OAAO,CAACiC,WAAW,CAAC;IAAEH;EAAO,CAAE,CAAC;EAExD,OAAO,CAACX,OAAO,EAAEa,SAAS,CAAU;AACtC;AAEA;;;AAGA,OAAO,eAAeE,wBAAwBA,CAC5CC,OAAuC;EAEvC,MAAM,CAAChB,OAAO,EAAEa,SAAS,CAAC,GAAG,MAAMnC,0BAA0B,CAACsC,OAAO,CAAC;EAEtE;EACA,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAC1B,+CAA+C,EAC/C;IACEC,IAAI,EAAE5C,SAAS,CAAC;MACd6C,KAAK,EAAEJ,OAAO,CAAChC,OAAO,CAACoC,KAAK;MAC5BhB,IAAI,EAAEJ,OAAO,CAACI,IAAI;MAClBiB,QAAQ,EAAErB,OAAO,CAACQ,KAAK;MACvBf,MAAM,EAAE,CAACO,OAAO,EAAEa,SAAS,CAAC;MAC5BR,EAAE,EAAEL,OAAO,CAACK;KACb,CAAC;IACFiB,OAAO,EAAE;MACP,cAAc,EAAE,gCAAgC;MAChD,WAAW,EAAEN,OAAO,CAAChC,OAAO,CAACuC;KAC9B;IACD/B,MAAM,EAAE;GACT,CACF;EACD,IAAI,CAACyB,QAAQ,CAACO,EAAE,EAAE;IAChB,MAAM,IAAId,KAAK,gCAAAe,MAAA,CAAgC,MAAMR,QAAQ,CAACS,IAAI,EAAE,CAAE,CAAC;EACzE;EACA,MAAMC,IAAI,GAAG,MAAMV,QAAQ,CAACU,IAAI,EAAE;EAClC,MAAMC,eAAe,GAAGD,IAAI,CAACE,MAAM;EACnC,IAAIxD,KAAK,CAACuD,eAAe,CAAC,EAAE;IAC1B,OAAO;MACLxC,KAAK,EAAE4B,OAAO,CAACjC,WAAW,CAACK,KAAK;MAChCC,MAAM,EAAE2B,OAAO,CAACjC,WAAW,CAACM,MAAM;MAClCuC,eAAe,EAAEA;KAClB;EACH;EACA,MAAM,IAAIlB,KAAK,gCAAAe,MAAA,CAAgClD,SAAS,CAACoD,IAAI,CAAC,CAAE,CAAC;AACnE","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}