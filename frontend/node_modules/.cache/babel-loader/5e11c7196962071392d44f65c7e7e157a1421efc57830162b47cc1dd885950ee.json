{"ast":null,"code":"import { client, parsers } from \"@passwordless-id/webauthn\";\nimport { webLocalStorage } from \"../../../../../utils/storage/webStorage.js\";\nimport { base64ToString, base64UrlToBase64 } from \"../../../../../utils/uint8-array.js\";\nimport { ClientScopedStorage } from \"../../../core/authentication/client-scoped-storage.js\";\nexport class PasskeyWebClient {\n  isAvailable() {\n    return client.isAvailable();\n  }\n  async register(args) {\n    const {\n      name,\n      challenge,\n      rp\n    } = args;\n    const registration = await client.register({\n      attestation: true,\n      challenge,\n      domain: rp.id,\n      user: name,\n      userVerification: \"required\"\n    });\n    const clientDataB64 = base64UrlToBase64(registration.response.clientDataJSON);\n    const clientDataParsed = JSON.parse(base64ToString(clientDataB64));\n    return {\n      authenticatorData: registration.response.authenticatorData,\n      clientData: registration.response.clientDataJSON,\n      credential: {\n        algorithm: parsers.getAlgoName(registration.response.publicKeyAlgorithm),\n        publicKey: registration.response.publicKey\n      },\n      credentialId: registration.id,\n      origin: clientDataParsed.origin\n    };\n  }\n  async authenticate(args) {\n    const {\n      credentialId,\n      challenge,\n      rp\n    } = args;\n    const result = await client.authenticate({\n      allowCredentials: credentialId ? [credentialId] : [],\n      challenge,\n      domain: rp.id,\n      userVerification: \"required\"\n    });\n    const clientDataB64 = base64UrlToBase64(result.response.clientDataJSON);\n    const clientDataParsed = JSON.parse(base64ToString(clientDataB64));\n    return {\n      authenticatorData: result.response.authenticatorData,\n      clientData: result.response.clientDataJSON,\n      credentialId: result.id,\n      origin: clientDataParsed.origin,\n      signature: result.response.signature\n    };\n  }\n}\n/**\n * Returns whether this device has a stored passkey ready to be used for sign-in\n * @param client - the thirdweb client\n * @returns whether the device has a stored passkey\n * @walletUtils\n */\nexport async function hasStoredPasskey(client, ecosystemId, storage) {\n  const clientStorage = new ClientScopedStorage({\n    clientId: client.clientId,\n    // TODO (passkey) react native variant of this fn\n    ecosystem: ecosystemId ? {\n      id: ecosystemId\n    } : undefined,\n    storage: storage !== null && storage !== void 0 ? storage : webLocalStorage\n  });\n  const credId = await clientStorage.getPasskeyCredentialId();\n  return !!credId;\n}","map":{"version":3,"names":["client","parsers","webLocalStorage","base64ToString","base64UrlToBase64","ClientScopedStorage","PasskeyWebClient","isAvailable","register","args","name","challenge","rp","registration","attestation","domain","id","user","userVerification","clientDataB64","response","clientDataJSON","clientDataParsed","JSON","parse","authenticatorData","clientData","credential","algorithm","getAlgoName","publicKeyAlgorithm","publicKey","credentialId","origin","authenticate","result","allowCredentials","signature","hasStoredPasskey","ecosystemId","storage","clientStorage","clientId","ecosystem","undefined","credId","getPasskeyCredentialId"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/wallets/in-app/web/lib/auth/passkeys.ts"],"sourcesContent":["import { client, parsers } from \"@passwordless-id/webauthn\";\nimport type { ThirdwebClient } from \"../../../../../client/client.js\";\nimport type { AsyncStorage } from \"../../../../../utils/storage/AsyncStorage.js\";\nimport { webLocalStorage } from \"../../../../../utils/storage/webStorage.js\";\nimport {\n  base64ToString,\n  base64UrlToBase64,\n} from \"../../../../../utils/uint8-array.js\";\nimport type { EcosystemWalletId } from \"../../../../wallet-types.js\";\nimport { ClientScopedStorage } from \"../../../core/authentication/client-scoped-storage.js\";\nimport type {\n  AuthenticateResult,\n  PasskeyClient,\n  RegisterResult,\n  RpInfo,\n} from \"../../../core/authentication/passkeys.js\";\n\nexport class PasskeyWebClient implements PasskeyClient {\n  isAvailable(): boolean {\n    return client.isAvailable();\n  }\n\n  async register(args: {\n    name: string;\n    challenge: string;\n    rp: RpInfo;\n  }): Promise<RegisterResult> {\n    const { name, challenge, rp } = args;\n    const registration = await client.register({\n      attestation: true,\n      challenge,\n      domain: rp.id,\n      user: name,\n      userVerification: \"required\",\n    });\n    const clientDataB64 = base64UrlToBase64(\n      registration.response.clientDataJSON,\n    );\n    const clientDataParsed = JSON.parse(base64ToString(clientDataB64));\n    return {\n      authenticatorData: registration.response.authenticatorData,\n      clientData: registration.response.clientDataJSON,\n      credential: {\n        algorithm: parsers.getAlgoName(\n          registration.response.publicKeyAlgorithm,\n        ),\n        publicKey: registration.response.publicKey,\n      },\n      credentialId: registration.id,\n      origin: clientDataParsed.origin,\n    };\n  }\n\n  async authenticate(args: {\n    credentialId: string | undefined;\n    challenge: string;\n    rp: RpInfo;\n  }): Promise<AuthenticateResult> {\n    const { credentialId, challenge, rp } = args;\n    const result = await client.authenticate({\n      allowCredentials: credentialId ? [credentialId] : [],\n      challenge,\n      domain: rp.id,\n      userVerification: \"required\",\n    });\n    const clientDataB64 = base64UrlToBase64(result.response.clientDataJSON);\n    const clientDataParsed = JSON.parse(base64ToString(clientDataB64));\n    return {\n      authenticatorData: result.response.authenticatorData,\n      clientData: result.response.clientDataJSON,\n      credentialId: result.id,\n      origin: clientDataParsed.origin,\n      signature: result.response.signature,\n    };\n  }\n}\n\n/**\n * Returns whether this device has a stored passkey ready to be used for sign-in\n * @param client - the thirdweb client\n * @returns whether the device has a stored passkey\n * @walletUtils\n */\nexport async function hasStoredPasskey(\n  client: ThirdwebClient,\n  ecosystemId?: EcosystemWalletId,\n  storage?: AsyncStorage,\n) {\n  const clientStorage = new ClientScopedStorage({\n    clientId: client.clientId, // TODO (passkey) react native variant of this fn\n    ecosystem: ecosystemId ? { id: ecosystemId } : undefined,\n    storage: storage ?? webLocalStorage,\n  });\n  const credId = await clientStorage.getPasskeyCredentialId();\n  return !!credId;\n}\n"],"mappings":"AAAA,SAASA,MAAM,EAAEC,OAAO,QAAQ,2BAA2B;AAG3D,SAASC,eAAe,QAAQ,4CAA4C;AAC5E,SACEC,cAAc,EACdC,iBAAiB,QACZ,qCAAqC;AAE5C,SAASC,mBAAmB,QAAQ,uDAAuD;AAQ3F,OAAM,MAAOC,gBAAgB;EAC3BC,WAAWA,CAAA;IACT,OAAOP,MAAM,CAACO,WAAW,EAAE;EAC7B;EAEA,MAAMC,QAAQA,CAACC,IAId;IACC,MAAM;MAAEC,IAAI;MAAEC,SAAS;MAAEC;IAAE,CAAE,GAAGH,IAAI;IACpC,MAAMI,YAAY,GAAG,MAAMb,MAAM,CAACQ,QAAQ,CAAC;MACzCM,WAAW,EAAE,IAAI;MACjBH,SAAS;MACTI,MAAM,EAAEH,EAAE,CAACI,EAAE;MACbC,IAAI,EAAEP,IAAI;MACVQ,gBAAgB,EAAE;KACnB,CAAC;IACF,MAAMC,aAAa,GAAGf,iBAAiB,CACrCS,YAAY,CAACO,QAAQ,CAACC,cAAc,CACrC;IACD,MAAMC,gBAAgB,GAAGC,IAAI,CAACC,KAAK,CAACrB,cAAc,CAACgB,aAAa,CAAC,CAAC;IAClE,OAAO;MACLM,iBAAiB,EAAEZ,YAAY,CAACO,QAAQ,CAACK,iBAAiB;MAC1DC,UAAU,EAAEb,YAAY,CAACO,QAAQ,CAACC,cAAc;MAChDM,UAAU,EAAE;QACVC,SAAS,EAAE3B,OAAO,CAAC4B,WAAW,CAC5BhB,YAAY,CAACO,QAAQ,CAACU,kBAAkB,CACzC;QACDC,SAAS,EAAElB,YAAY,CAACO,QAAQ,CAACW;OAClC;MACDC,YAAY,EAAEnB,YAAY,CAACG,EAAE;MAC7BiB,MAAM,EAAEX,gBAAgB,CAACW;KAC1B;EACH;EAEA,MAAMC,YAAYA,CAACzB,IAIlB;IACC,MAAM;MAAEuB,YAAY;MAAErB,SAAS;MAAEC;IAAE,CAAE,GAAGH,IAAI;IAC5C,MAAM0B,MAAM,GAAG,MAAMnC,MAAM,CAACkC,YAAY,CAAC;MACvCE,gBAAgB,EAAEJ,YAAY,GAAG,CAACA,YAAY,CAAC,GAAG,EAAE;MACpDrB,SAAS;MACTI,MAAM,EAAEH,EAAE,CAACI,EAAE;MACbE,gBAAgB,EAAE;KACnB,CAAC;IACF,MAAMC,aAAa,GAAGf,iBAAiB,CAAC+B,MAAM,CAACf,QAAQ,CAACC,cAAc,CAAC;IACvE,MAAMC,gBAAgB,GAAGC,IAAI,CAACC,KAAK,CAACrB,cAAc,CAACgB,aAAa,CAAC,CAAC;IAClE,OAAO;MACLM,iBAAiB,EAAEU,MAAM,CAACf,QAAQ,CAACK,iBAAiB;MACpDC,UAAU,EAAES,MAAM,CAACf,QAAQ,CAACC,cAAc;MAC1CW,YAAY,EAAEG,MAAM,CAACnB,EAAE;MACvBiB,MAAM,EAAEX,gBAAgB,CAACW,MAAM;MAC/BI,SAAS,EAAEF,MAAM,CAACf,QAAQ,CAACiB;KAC5B;EACH;;AAGF;;;;;;AAMA,OAAO,eAAeC,gBAAgBA,CACpCtC,MAAsB,EACtBuC,WAA+B,EAC/BC,OAAsB;EAEtB,MAAMC,aAAa,GAAG,IAAIpC,mBAAmB,CAAC;IAC5CqC,QAAQ,EAAE1C,MAAM,CAAC0C,QAAQ;IAAE;IAC3BC,SAAS,EAAEJ,WAAW,GAAG;MAAEvB,EAAE,EAAEuB;IAAW,CAAE,GAAGK,SAAS;IACxDJ,OAAO,EAAEA,OAAO,aAAPA,OAAO,cAAPA,OAAO,GAAItC;GACrB,CAAC;EACF,MAAM2C,MAAM,GAAG,MAAMJ,aAAa,CAACK,sBAAsB,EAAE;EAC3D,OAAO,CAAC,CAACD,MAAM;AACjB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}