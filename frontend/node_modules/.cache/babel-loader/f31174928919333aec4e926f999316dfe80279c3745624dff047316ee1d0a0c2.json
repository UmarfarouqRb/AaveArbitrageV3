{"ast":null,"code":"import { disconnectWalletConnectSession } from \"./index.js\";\nimport { getSessions, saveSession } from \"./session-store.js\";\n/**\n * @internal\n */\nexport async function onSessionProposal(options) {\n  var _event$verifyContext;\n  const {\n    wallet,\n    walletConnectClient,\n    event,\n    chains,\n    onConnect\n  } = options;\n  const account = wallet.getAccount();\n  if (!account) {\n    throw new Error(\"No account connected to provided wallet\");\n  }\n  const origin = (_event$verifyContext = event.verifyContext) === null || _event$verifyContext === void 0 || (_event$verifyContext = _event$verifyContext.verified) === null || _event$verifyContext === void 0 ? void 0 : _event$verifyContext.origin;\n  if (origin) {\n    await disconnectExistingSessions({\n      origin,\n      walletConnectClient\n    });\n  }\n  const session = await acceptSessionProposal({\n    account,\n    chains,\n    sessionProposal: event,\n    walletConnectClient\n  });\n  await saveSession(session);\n  wallet.subscribe(\"disconnect\", () => {\n    disconnectWalletConnectSession({\n      session,\n      walletConnectClient\n    });\n  });\n  onConnect === null || onConnect === void 0 || onConnect(session);\n}\n/**\n * @internal\n */\nexport async function disconnectExistingSessions(_ref) {\n  let {\n    walletConnectClient,\n    origin\n  } = _ref;\n  const sessions = await getSessions();\n  for (const session of sessions) {\n    if (session.origin === origin) {\n      await disconnectWalletConnectSession({\n        session,\n        walletConnectClient\n      });\n    }\n  }\n}\n/**\n * @internal\n */\nexport async function acceptSessionProposal(_ref2) {\n  var _sessionProposal$para, _sessionProposal$para2, _sessionProposal$para3, _sessionProposal$para4, _sessionProposal$para5, _sessionProposal$para6, _chains$map, _sessionProposal$para7, _sessionProposal$para8, _sessionProposal$para9, _sessionProposal$para0, _sessionProposal$para1, _sessionProposal$para10, _sessionProposal$para11, _sessionProposal$para12, _sessionProposal$veri;\n  let {\n    account,\n    walletConnectClient,\n    sessionProposal,\n    chains\n  } = _ref2;\n  if (!((_sessionProposal$para = sessionProposal.params.requiredNamespaces) !== null && _sessionProposal$para !== void 0 && _sessionProposal$para.eip155) && !((_sessionProposal$para2 = sessionProposal.params.optionalNamespaces) !== null && _sessionProposal$para2 !== void 0 && _sessionProposal$para2.eip155)) {\n    throw new Error(\"No EIP155 namespace found in Wallet Connect session proposal\");\n  }\n  const namespaces = {\n    chains: [...Array.from(new Set([...((_sessionProposal$para3 = (_sessionProposal$para4 = sessionProposal.params.requiredNamespaces) === null || _sessionProposal$para4 === void 0 || (_sessionProposal$para4 = _sessionProposal$para4.eip155) === null || _sessionProposal$para4 === void 0 || (_sessionProposal$para4 = _sessionProposal$para4.chains) === null || _sessionProposal$para4 === void 0 ? void 0 : _sessionProposal$para4.map(chain => \"\".concat(chain, \":\").concat(account.address))) !== null && _sessionProposal$para3 !== void 0 ? _sessionProposal$para3 : []), ...((_sessionProposal$para5 = (_sessionProposal$para6 = sessionProposal.params.optionalNamespaces) === null || _sessionProposal$para6 === void 0 || (_sessionProposal$para6 = _sessionProposal$para6.eip155) === null || _sessionProposal$para6 === void 0 || (_sessionProposal$para6 = _sessionProposal$para6.chains) === null || _sessionProposal$para6 === void 0 ? void 0 : _sessionProposal$para6.map(chain => \"\".concat(chain, \":\").concat(account.address))) !== null && _sessionProposal$para5 !== void 0 ? _sessionProposal$para5 : []), ...((_chains$map = chains === null || chains === void 0 ? void 0 : chains.map(chain => \"eip155:\".concat(chain.id, \":\").concat(account.address))) !== null && _chains$map !== void 0 ? _chains$map : [])]))],\n    events: [...((_sessionProposal$para7 = (_sessionProposal$para8 = sessionProposal.params.requiredNamespaces) === null || _sessionProposal$para8 === void 0 || (_sessionProposal$para8 = _sessionProposal$para8.eip155) === null || _sessionProposal$para8 === void 0 ? void 0 : _sessionProposal$para8.events) !== null && _sessionProposal$para7 !== void 0 ? _sessionProposal$para7 : []), ...((_sessionProposal$para9 = (_sessionProposal$para0 = sessionProposal.params.optionalNamespaces) === null || _sessionProposal$para0 === void 0 || (_sessionProposal$para0 = _sessionProposal$para0.eip155) === null || _sessionProposal$para0 === void 0 ? void 0 : _sessionProposal$para0.events) !== null && _sessionProposal$para9 !== void 0 ? _sessionProposal$para9 : [])],\n    methods: [...((_sessionProposal$para1 = (_sessionProposal$para10 = sessionProposal.params.requiredNamespaces) === null || _sessionProposal$para10 === void 0 || (_sessionProposal$para10 = _sessionProposal$para10.eip155) === null || _sessionProposal$para10 === void 0 ? void 0 : _sessionProposal$para10.methods) !== null && _sessionProposal$para1 !== void 0 ? _sessionProposal$para1 : []), ...((_sessionProposal$para11 = (_sessionProposal$para12 = sessionProposal.params.optionalNamespaces) === null || _sessionProposal$para12 === void 0 || (_sessionProposal$para12 = _sessionProposal$para12.eip155) === null || _sessionProposal$para12 === void 0 ? void 0 : _sessionProposal$para12.methods) !== null && _sessionProposal$para11 !== void 0 ? _sessionProposal$para11 : [])]\n  };\n  const approval = await walletConnectClient.approve({\n    id: sessionProposal.id,\n    namespaces: {\n      eip155: {\n        accounts: namespaces.chains,\n        events: namespaces.events,\n        methods: namespaces.methods\n      }\n    }\n  });\n  const session = await approval.acknowledged();\n  return {\n    origin: ((_sessionProposal$veri = sessionProposal.verifyContext) === null || _sessionProposal$veri === void 0 || (_sessionProposal$veri = _sessionProposal$veri.verified) === null || _sessionProposal$veri === void 0 ? void 0 : _sessionProposal$veri.origin) || \"Unknown origin\",\n    topic: session.topic\n  };\n}","map":{"version":3,"names":["disconnectWalletConnectSession","getSessions","saveSession","onSessionProposal","options","_event$verifyContext","wallet","walletConnectClient","event","chains","onConnect","account","getAccount","Error","origin","verifyContext","verified","disconnectExistingSessions","session","acceptSessionProposal","sessionProposal","subscribe","_ref","sessions","_ref2","_sessionProposal$para","_sessionProposal$para2","_sessionProposal$para3","_sessionProposal$para4","_sessionProposal$para5","_sessionProposal$para6","_chains$map","_sessionProposal$para7","_sessionProposal$para8","_sessionProposal$para9","_sessionProposal$para0","_sessionProposal$para1","_sessionProposal$para10","_sessionProposal$para11","_sessionProposal$para12","_sessionProposal$veri","params","requiredNamespaces","eip155","optionalNamespaces","namespaces","Array","from","Set","map","chain","concat","address","id","events","methods","approval","approve","accounts","acknowledged","topic"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/wallets/wallet-connect/receiver/session-proposal.ts"],"sourcesContent":["import type { Chain } from \"../../../chains/types.js\";\nimport type { Account, Wallet } from \"../../interfaces/wallet.js\";\nimport { disconnectWalletConnectSession } from \"./index.js\";\nimport { getSessions, saveSession } from \"./session-store.js\";\nimport type {\n  WalletConnectClient,\n  WalletConnectSession,\n  WalletConnectSessionProposalEvent,\n} from \"./types.js\";\n\n/**\n * @internal\n */\nexport async function onSessionProposal(options: {\n  wallet: Wallet;\n  walletConnectClient: WalletConnectClient;\n  event: WalletConnectSessionProposalEvent;\n  chains?: Chain[];\n  onConnect?: (session: WalletConnectSession) => void;\n}) {\n  const { wallet, walletConnectClient, event, chains, onConnect } = options;\n\n  const account = wallet.getAccount();\n  if (!account) {\n    throw new Error(\"No account connected to provided wallet\");\n  }\n\n  const origin = event.verifyContext?.verified?.origin;\n  if (origin) {\n    await disconnectExistingSessions({ origin, walletConnectClient });\n  }\n  const session = await acceptSessionProposal({\n    account,\n    chains,\n    sessionProposal: event,\n    walletConnectClient,\n  });\n\n  await saveSession(session);\n\n  wallet.subscribe(\"disconnect\", () => {\n    disconnectWalletConnectSession({ session, walletConnectClient });\n  });\n\n  onConnect?.(session);\n}\n\n/**\n * @internal\n */\nexport async function disconnectExistingSessions({\n  walletConnectClient,\n  origin,\n}: {\n  walletConnectClient: WalletConnectClient;\n  origin: string;\n}) {\n  const sessions = await getSessions();\n  for (const session of sessions) {\n    if (session.origin === origin) {\n      await disconnectWalletConnectSession({ session, walletConnectClient });\n    }\n  }\n}\n\n/**\n * @internal\n */\nexport async function acceptSessionProposal({\n  account,\n  walletConnectClient,\n  sessionProposal,\n  chains,\n}: {\n  account: Account;\n  walletConnectClient: WalletConnectClient;\n  sessionProposal: WalletConnectSessionProposalEvent;\n  chains?: Chain[];\n}): Promise<WalletConnectSession> {\n  if (\n    !sessionProposal.params.requiredNamespaces?.eip155 &&\n    !sessionProposal.params.optionalNamespaces?.eip155\n  ) {\n    throw new Error(\n      \"No EIP155 namespace found in Wallet Connect session proposal\",\n    );\n  }\n\n  const namespaces = {\n    chains: [\n      ...Array.from(\n        new Set([\n          ...(sessionProposal.params.requiredNamespaces?.eip155?.chains?.map(\n            (chain: string) => `${chain}:${account.address}`,\n          ) ?? []),\n          ...(sessionProposal.params.optionalNamespaces?.eip155?.chains?.map(\n            (chain: string) => `${chain}:${account.address}`,\n          ) ?? []),\n          ...(chains?.map((chain) => `eip155:${chain.id}:${account.address}`) ??\n            []),\n        ]),\n      ),\n    ],\n    events: [\n      ...(sessionProposal.params.requiredNamespaces?.eip155?.events ?? []),\n      ...(sessionProposal.params.optionalNamespaces?.eip155?.events ?? []),\n    ],\n    methods: [\n      ...(sessionProposal.params.requiredNamespaces?.eip155?.methods ?? []),\n      ...(sessionProposal.params.optionalNamespaces?.eip155?.methods ?? []),\n    ],\n  };\n  const approval = await walletConnectClient.approve({\n    id: sessionProposal.id,\n    namespaces: {\n      eip155: {\n        accounts: namespaces.chains,\n        events: namespaces.events,\n        methods: namespaces.methods,\n      },\n    },\n  });\n\n  const session = await approval.acknowledged();\n  return {\n    origin: sessionProposal.verifyContext?.verified?.origin || \"Unknown origin\",\n    topic: session.topic,\n  };\n}\n"],"mappings":"AAEA,SAASA,8BAA8B,QAAQ,YAAY;AAC3D,SAASC,WAAW,EAAEC,WAAW,QAAQ,oBAAoB;AAO7D;;;AAGA,OAAO,eAAeC,iBAAiBA,CAACC,OAMvC;EAAA,IAAAC,oBAAA;EACC,MAAM;IAAEC,MAAM;IAAEC,mBAAmB;IAAEC,KAAK;IAAEC,MAAM;IAAEC;EAAS,CAAE,GAAGN,OAAO;EAEzE,MAAMO,OAAO,GAAGL,MAAM,CAACM,UAAU,EAAE;EACnC,IAAI,CAACD,OAAO,EAAE;IACZ,MAAM,IAAIE,KAAK,CAAC,yCAAyC,CAAC;EAC5D;EAEA,MAAMC,MAAM,IAAAT,oBAAA,GAAGG,KAAK,CAACO,aAAa,cAAAV,oBAAA,gBAAAA,oBAAA,GAAnBA,oBAAA,CAAqBW,QAAQ,cAAAX,oBAAA,uBAA7BA,oBAAA,CAA+BS,MAAM;EACpD,IAAIA,MAAM,EAAE;IACV,MAAMG,0BAA0B,CAAC;MAAEH,MAAM;MAAEP;IAAmB,CAAE,CAAC;EACnE;EACA,MAAMW,OAAO,GAAG,MAAMC,qBAAqB,CAAC;IAC1CR,OAAO;IACPF,MAAM;IACNW,eAAe,EAAEZ,KAAK;IACtBD;GACD,CAAC;EAEF,MAAML,WAAW,CAACgB,OAAO,CAAC;EAE1BZ,MAAM,CAACe,SAAS,CAAC,YAAY,EAAE,MAAK;IAClCrB,8BAA8B,CAAC;MAAEkB,OAAO;MAAEX;IAAmB,CAAE,CAAC;EAClE,CAAC,CAAC;EAEFG,SAAS,aAATA,SAAS,eAATA,SAAS,CAAGQ,OAAO,CAAC;AACtB;AAEA;;;AAGA,OAAO,eAAeD,0BAA0BA,CAAAK,IAAA,EAM/C;EAAA,IANgD;IAC/Cf,mBAAmB;IACnBO;EAAM,CAIP,GAAAQ,IAAA;EACC,MAAMC,QAAQ,GAAG,MAAMtB,WAAW,EAAE;EACpC,KAAK,MAAMiB,OAAO,IAAIK,QAAQ,EAAE;IAC9B,IAAIL,OAAO,CAACJ,MAAM,KAAKA,MAAM,EAAE;MAC7B,MAAMd,8BAA8B,CAAC;QAAEkB,OAAO;QAAEX;MAAmB,CAAE,CAAC;IACxE;EACF;AACF;AAEA;;;AAGA,OAAO,eAAeY,qBAAqBA,CAAAK,KAAA,EAU1C;EAAA,IAAAC,qBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,WAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,uBAAA,EAAAC,uBAAA,EAAAC,uBAAA,EAAAC,qBAAA;EAAA,IAV2C;IAC1C7B,OAAO;IACPJ,mBAAmB;IACnBa,eAAe;IACfX;EAAM,CAMP,GAAAe,KAAA;EACC,IACE,GAAAC,qBAAA,GAACL,eAAe,CAACqB,MAAM,CAACC,kBAAkB,cAAAjB,qBAAA,eAAzCA,qBAAA,CAA2CkB,MAAM,KAClD,GAAAjB,sBAAA,GAACN,eAAe,CAACqB,MAAM,CAACG,kBAAkB,cAAAlB,sBAAA,eAAzCA,sBAAA,CAA2CiB,MAAM,GAClD;IACA,MAAM,IAAI9B,KAAK,CACb,8DAA8D,CAC/D;EACH;EAEA,MAAMgC,UAAU,GAAG;IACjBpC,MAAM,EAAE,CACN,GAAGqC,KAAK,CAACC,IAAI,CACX,IAAIC,GAAG,CAAC,CACN,KAAArB,sBAAA,IAAAC,sBAAA,GAAIR,eAAe,CAACqB,MAAM,CAACC,kBAAkB,cAAAd,sBAAA,gBAAAA,sBAAA,GAAzCA,sBAAA,CAA2Ce,MAAM,cAAAf,sBAAA,gBAAAA,sBAAA,GAAjDA,sBAAA,CAAmDnB,MAAM,cAAAmB,sBAAA,uBAAzDA,sBAAA,CAA2DqB,GAAG,CAC/DC,KAAa,OAAAC,MAAA,CAAQD,KAAK,OAAAC,MAAA,CAAIxC,OAAO,CAACyC,OAAO,CAAE,CACjD,cAAAzB,sBAAA,cAAAA,sBAAA,GAAI,EAAE,CAAC,EACR,KAAAE,sBAAA,IAAAC,sBAAA,GAAIV,eAAe,CAACqB,MAAM,CAACG,kBAAkB,cAAAd,sBAAA,gBAAAA,sBAAA,GAAzCA,sBAAA,CAA2Ca,MAAM,cAAAb,sBAAA,gBAAAA,sBAAA,GAAjDA,sBAAA,CAAmDrB,MAAM,cAAAqB,sBAAA,uBAAzDA,sBAAA,CAA2DmB,GAAG,CAC/DC,KAAa,OAAAC,MAAA,CAAQD,KAAK,OAAAC,MAAA,CAAIxC,OAAO,CAACyC,OAAO,CAAE,CACjD,cAAAvB,sBAAA,cAAAA,sBAAA,GAAI,EAAE,CAAC,EACR,KAAAE,WAAA,GAAItB,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEwC,GAAG,CAAEC,KAAK,cAAAC,MAAA,CAAeD,KAAK,CAACG,EAAE,OAAAF,MAAA,CAAIxC,OAAO,CAACyC,OAAO,CAAE,CAAC,cAAArB,WAAA,cAAAA,WAAA,GACjE,EAAE,CAAC,CACN,CAAC,CACH,CACF;IACDuB,MAAM,EAAE,CACN,KAAAtB,sBAAA,IAAAC,sBAAA,GAAIb,eAAe,CAACqB,MAAM,CAACC,kBAAkB,cAAAT,sBAAA,gBAAAA,sBAAA,GAAzCA,sBAAA,CAA2CU,MAAM,cAAAV,sBAAA,uBAAjDA,sBAAA,CAAmDqB,MAAM,cAAAtB,sBAAA,cAAAA,sBAAA,GAAI,EAAE,CAAC,EACpE,KAAAE,sBAAA,IAAAC,sBAAA,GAAIf,eAAe,CAACqB,MAAM,CAACG,kBAAkB,cAAAT,sBAAA,gBAAAA,sBAAA,GAAzCA,sBAAA,CAA2CQ,MAAM,cAAAR,sBAAA,uBAAjDA,sBAAA,CAAmDmB,MAAM,cAAApB,sBAAA,cAAAA,sBAAA,GAAI,EAAE,CAAC,CACrE;IACDqB,OAAO,EAAE,CACP,KAAAnB,sBAAA,IAAAC,uBAAA,GAAIjB,eAAe,CAACqB,MAAM,CAACC,kBAAkB,cAAAL,uBAAA,gBAAAA,uBAAA,GAAzCA,uBAAA,CAA2CM,MAAM,cAAAN,uBAAA,uBAAjDA,uBAAA,CAAmDkB,OAAO,cAAAnB,sBAAA,cAAAA,sBAAA,GAAI,EAAE,CAAC,EACrE,KAAAE,uBAAA,IAAAC,uBAAA,GAAInB,eAAe,CAACqB,MAAM,CAACG,kBAAkB,cAAAL,uBAAA,gBAAAA,uBAAA,GAAzCA,uBAAA,CAA2CI,MAAM,cAAAJ,uBAAA,uBAAjDA,uBAAA,CAAmDgB,OAAO,cAAAjB,uBAAA,cAAAA,uBAAA,GAAI,EAAE,CAAC;GAExE;EACD,MAAMkB,QAAQ,GAAG,MAAMjD,mBAAmB,CAACkD,OAAO,CAAC;IACjDJ,EAAE,EAAEjC,eAAe,CAACiC,EAAE;IACtBR,UAAU,EAAE;MACVF,MAAM,EAAE;QACNe,QAAQ,EAAEb,UAAU,CAACpC,MAAM;QAC3B6C,MAAM,EAAET,UAAU,CAACS,MAAM;QACzBC,OAAO,EAAEV,UAAU,CAACU;;;GAGzB,CAAC;EAEF,MAAMrC,OAAO,GAAG,MAAMsC,QAAQ,CAACG,YAAY,EAAE;EAC7C,OAAO;IACL7C,MAAM,EAAE,EAAA0B,qBAAA,GAAApB,eAAe,CAACL,aAAa,cAAAyB,qBAAA,gBAAAA,qBAAA,GAA7BA,qBAAA,CAA+BxB,QAAQ,cAAAwB,qBAAA,uBAAvCA,qBAAA,CAAyC1B,MAAM,KAAI,gBAAgB;IAC3E8C,KAAK,EAAE1C,OAAO,CAAC0C;GAChB;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}