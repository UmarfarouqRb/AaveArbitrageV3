{"ast":null,"code":"import { hexToBigInt } from \"../../../utils/encoding/hex.js\";\nimport { getClientFetch } from \"../../../utils/fetch.js\";\nimport { stringify } from \"../../../utils/json.js\";\nimport { ENTRYPOINT_ADDRESS_v0_6, getDefaultBundlerUrl } from \"./constants.js\";\nimport { hexlifyUserOp } from \"./utils.js\";\n/**\n * Get paymaster and data details for a user operation.\n * @param args - The userOp and options\n * @returns - The paymaster and data details for the user operation.\n * @example\n * ```ts\n * import { getPaymasterAndData } from \"thirdweb/wallets/smart\";\n *\n * const userOp = createUnsignedUserOp(...);\n *\n * const paymasterAndData = await getPaymasterAndData({\n *  userOp,\n *  client,\n *  chain,\n * });\n * ```\n * @walletUtils\n */\nexport async function getPaymasterAndData(args) {\n  var _res$error;\n  const {\n    userOp,\n    paymasterOverride,\n    client,\n    chain,\n    entrypointAddress\n  } = args;\n  if (paymasterOverride) {\n    return paymasterOverride(userOp);\n  }\n  const headers = {\n    \"Content-Type\": \"application/json\"\n  };\n  const entrypoint = entrypointAddress !== null && entrypointAddress !== void 0 ? entrypointAddress : ENTRYPOINT_ADDRESS_v0_6;\n  const paymasterUrl = getDefaultBundlerUrl(chain);\n  const body = {\n    id: 1,\n    jsonrpc: \"2.0\",\n    method: \"pm_sponsorUserOperation\",\n    params: [hexlifyUserOp(userOp), entrypoint]\n  };\n  // Ask the paymaster to sign the transaction and return a valid paymasterAndData value.\n  const fetchWithHeaders = getClientFetch(client);\n  const response = await fetchWithHeaders(paymasterUrl, {\n    body: stringify(body),\n    headers,\n    method: \"POST\"\n  });\n  if (!response.ok) {\n    const error = (await response.text()) || response.statusText;\n    throw new Error(\"Paymaster error: \".concat(response.status, \" - \").concat(error));\n  }\n  const res = await response.json();\n  if (res.result) {\n    // some paymasters return a string, some return an object with more data\n    if (typeof res.result === \"string\") {\n      return {\n        paymasterAndData: res.result\n      };\n    }\n    // check for policy errors\n    if (res.result.reason) {\n      console.warn(\"Paymaster policy rejected this transaction with reason: \".concat(res.result.reason, \" \").concat(res.result.policyId ? \"(policyId: \".concat(res.result.policyId, \")\") : \"\"));\n    }\n    return {\n      callGasLimit: res.result.callGasLimit ? hexToBigInt(res.result.callGasLimit) : undefined,\n      paymaster: res.result.paymaster,\n      paymasterAndData: res.result.paymasterAndData,\n      paymasterData: res.result.paymasterData,\n      paymasterPostOpGasLimit: res.result.paymasterPostOpGasLimit ? hexToBigInt(res.result.paymasterPostOpGasLimit) : undefined,\n      paymasterVerificationGasLimit: res.result.paymasterVerificationGasLimit ? hexToBigInt(res.result.paymasterVerificationGasLimit) : undefined,\n      preVerificationGas: res.result.preVerificationGas ? hexToBigInt(res.result.preVerificationGas) : undefined,\n      verificationGasLimit: res.result.verificationGasLimit ? hexToBigInt(res.result.verificationGasLimit) : undefined\n    };\n  }\n  const error = ((_res$error = res.error) === null || _res$error === void 0 ? void 0 : _res$error.message) || res.error || response.statusText || \"unknown error\";\n  throw new Error(\"Paymaster error from \".concat(paymasterUrl, \": \").concat(error));\n}","map":{"version":3,"names":["hexToBigInt","getClientFetch","stringify","ENTRYPOINT_ADDRESS_v0_6","getDefaultBundlerUrl","hexlifyUserOp","getPaymasterAndData","args","_res$error","userOp","paymasterOverride","client","chain","entrypointAddress","headers","entrypoint","paymasterUrl","body","id","jsonrpc","method","params","fetchWithHeaders","response","ok","error","text","statusText","Error","concat","status","res","json","result","paymasterAndData","reason","console","warn","policyId","callGasLimit","undefined","paymaster","paymasterData","paymasterPostOpGasLimit","paymasterVerificationGasLimit","preVerificationGas","verificationGasLimit","message"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/wallets/smart/lib/paymaster.ts"],"sourcesContent":["import type { Chain } from \"../../../chains/types.js\";\nimport type { ThirdwebClient } from \"../../../client/client.js\";\nimport { hexToBigInt } from \"../../../utils/encoding/hex.js\";\nimport { getClientFetch } from \"../../../utils/fetch.js\";\nimport { stringify } from \"../../../utils/json.js\";\nimport type {\n  PaymasterResult,\n  UserOperationV06,\n  UserOperationV07,\n} from \"../types.js\";\nimport { ENTRYPOINT_ADDRESS_v0_6, getDefaultBundlerUrl } from \"./constants.js\";\nimport { hexlifyUserOp } from \"./utils.js\";\n\n/**\n * Get paymaster and data details for a user operation.\n * @param args - The userOp and options\n * @returns - The paymaster and data details for the user operation.\n * @example\n * ```ts\n * import { getPaymasterAndData } from \"thirdweb/wallets/smart\";\n *\n * const userOp = createUnsignedUserOp(...);\n *\n * const paymasterAndData = await getPaymasterAndData({\n *  userOp,\n *  client,\n *  chain,\n * });\n * ```\n * @walletUtils\n */\nexport async function getPaymasterAndData(args: {\n  userOp: UserOperationV06 | UserOperationV07;\n  client: ThirdwebClient;\n  chain: Chain;\n  entrypointAddress?: string;\n  paymasterOverride?: (\n    userOp: UserOperationV06 | UserOperationV07,\n  ) => Promise<PaymasterResult>;\n}): Promise<PaymasterResult> {\n  const { userOp, paymasterOverride, client, chain, entrypointAddress } = args;\n\n  if (paymasterOverride) {\n    return paymasterOverride(userOp);\n  }\n\n  const headers: Record<string, string> = {\n    \"Content-Type\": \"application/json\",\n  };\n\n  const entrypoint = entrypointAddress ?? ENTRYPOINT_ADDRESS_v0_6;\n  const paymasterUrl = getDefaultBundlerUrl(chain);\n\n  const body = {\n    id: 1,\n    jsonrpc: \"2.0\",\n    method: \"pm_sponsorUserOperation\",\n    params: [hexlifyUserOp(userOp), entrypoint],\n  };\n\n  // Ask the paymaster to sign the transaction and return a valid paymasterAndData value.\n  const fetchWithHeaders = getClientFetch(client);\n  const response = await fetchWithHeaders(paymasterUrl, {\n    body: stringify(body),\n    headers,\n    method: \"POST\",\n  });\n\n  if (!response.ok) {\n    const error = (await response.text()) || response.statusText;\n\n    throw new Error(`Paymaster error: ${response.status} - ${error}`);\n  }\n\n  const res = await response.json();\n\n  if (res.result) {\n    // some paymasters return a string, some return an object with more data\n    if (typeof res.result === \"string\") {\n      return {\n        paymasterAndData: res.result,\n      };\n    }\n    // check for policy errors\n    if (res.result.reason) {\n      console.warn(\n        `Paymaster policy rejected this transaction with reason: ${res.result.reason} ${res.result.policyId ? `(policyId: ${res.result.policyId})` : \"\"}`,\n      );\n    }\n\n    return {\n      callGasLimit: res.result.callGasLimit\n        ? hexToBigInt(res.result.callGasLimit)\n        : undefined,\n      paymaster: res.result.paymaster,\n      paymasterAndData: res.result.paymasterAndData,\n      paymasterData: res.result.paymasterData,\n      paymasterPostOpGasLimit: res.result.paymasterPostOpGasLimit\n        ? hexToBigInt(res.result.paymasterPostOpGasLimit)\n        : undefined,\n      paymasterVerificationGasLimit: res.result.paymasterVerificationGasLimit\n        ? hexToBigInt(res.result.paymasterVerificationGasLimit)\n        : undefined,\n      preVerificationGas: res.result.preVerificationGas\n        ? hexToBigInt(res.result.preVerificationGas)\n        : undefined,\n      verificationGasLimit: res.result.verificationGasLimit\n        ? hexToBigInt(res.result.verificationGasLimit)\n        : undefined,\n    };\n  }\n  const error =\n    res.error?.message || res.error || response.statusText || \"unknown error\";\n  throw new Error(`Paymaster error from ${paymasterUrl}: ${error}`);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}