{"ast":null,"code":"import _objectSpread from \"/home/user/Arbitrage/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { isNativeTokenAddress, NATIVE_TOKEN_ADDRESS } from \"../../../../constants/addresses.js\";\nimport { getContract } from \"../../../../contract/contract.js\";\nimport { eth_getBlockByNumber } from \"../../../../rpc/actions/eth_getBlockByNumber.js\";\nimport { getRpcClient } from \"../../../../rpc/rpc.js\";\nimport { toUnits } from \"../../../../utils/units.js\";\nimport { isERC721 } from \"../../../erc721/read/isERC721.js\";\nimport { isERC1155 } from \"../../../erc1155/read/isERC1155.js\";\nimport * as CreateListing from \"../../__generated__/IDirectListings/write/createListing.js\";\n/**\n * Creates a direct listing.\n * @param options The options for creating the direct listing.\n * @returns The result of creating the direct listing.\n * @extension MARKETPLACE\n * @example\n * ```typescript\n * import { createListing } from \"thirdweb/extensions/marketplace\";\n * import { sendTransaction } from \"thirdweb\";\n *\n * const transaction = createListing({\n *   assetContractAddress: \"0x...\", // the NFT contract address that you want to sell\n *   tokenId={0n}, // the token id you want to sell\n *   pricePerToken=\"0.1\" // sell for 0.1 <native token>\n * });\n *\n * await sendTransaction({ transaction, account });\n * ```\n */\nexport function createListing(options) {\n  return CreateListing.createListing({\n    asyncParams: async () => {\n      var _options$startTimesta, _options$endTimestamp, _options$currencyCont, _options$currencyCont2, _options$isReservedLi;\n      const assetContract = getContract(_objectSpread(_objectSpread({}, options.contract), {}, {\n        address: options.assetContractAddress\n      }));\n      const rpcClient = getRpcClient(options.contract);\n      const [assetIsERC721, assetIsERC1155, lastestBlock] = await Promise.all([isERC721({\n        contract: assetContract\n      }), isERC1155({\n        contract: assetContract\n      }), eth_getBlockByNumber(rpcClient, {\n        blockTag: \"latest\"\n      })]);\n      // validate valid asset\n      if (!assetIsERC721 && !assetIsERC1155) {\n        throw new Error(\"AssetContract must implement ERC 1155 or ERC 721.\");\n      }\n      // validate the timestamps\n      let startTimestamp = BigInt(Math.floor(((_options$startTimesta = options.startTimestamp) !== null && _options$startTimesta !== void 0 ? _options$startTimesta : new Date()).getTime() / 1000));\n      const endTimestamp = BigInt(Math.floor(((_options$endTimestamp = options.endTimestamp) !== null && _options$endTimestamp !== void 0 ? _options$endTimestamp : new Date(Date.now() + 10 * 365 * 24 * 60 * 60 * 1000)).getTime() / 1000));\n      if (startTimestamp <= lastestBlock.timestamp) {\n        // set the start time to the next block if it is in the past\n        startTimestamp = lastestBlock.timestamp + 1n;\n      }\n      if (startTimestamp >= endTimestamp) {\n        throw new Error(\"Start time must be before end time.\");\n      }\n      // valdiate quantity\n      let quantity;\n      if (assetIsERC721) {\n        // force quantity to 1 for ERC721s\n        quantity = 1n;\n      } else {\n        var _options$quantity;\n        // otherwise use the provided quantity or default to 1\n        quantity = (_options$quantity = options.quantity) !== null && _options$quantity !== void 0 ? _options$quantity : 1n;\n      }\n      // validate price\n      const currencyAddress = (_options$currencyCont = options.currencyContractAddress) !== null && _options$currencyCont !== void 0 ? _options$currencyCont : NATIVE_TOKEN_ADDRESS;\n      let pricePerToken;\n      if (\"pricePerToken\" in options) {\n        // for native token, we know decimals are 18\n        if (isNativeTokenAddress(currencyAddress)) {\n          pricePerToken = toUnits(options.pricePerToken, 18);\n        } else {\n          // otherwise get the decimals of the currency\n          const currencyContract = getContract(_objectSpread(_objectSpread({}, options.contract), {}, {\n            address: currencyAddress\n          }));\n          const {\n            decimals\n          } = await import(\"../../../erc20/read/decimals.js\");\n          const currencyDecimals = await decimals({\n            contract: currencyContract\n          });\n          pricePerToken = toUnits(options.pricePerToken, currencyDecimals);\n        }\n      } else {\n        pricePerToken = BigInt(options.pricePerTokenWei);\n      }\n      return {\n        overrides: {\n          extraGas: 50000n // add extra gas to account for router call\n        },\n        params: {\n          assetContract: options.assetContractAddress,\n          currency: (_options$currencyCont2 = options.currencyContractAddress) !== null && _options$currencyCont2 !== void 0 ? _options$currencyCont2 : NATIVE_TOKEN_ADDRESS,\n          endTimestamp,\n          pricePerToken,\n          quantity,\n          reserved: (_options$isReservedLi = options.isReservedListing) !== null && _options$isReservedLi !== void 0 ? _options$isReservedLi : false,\n          startTimestamp,\n          tokenId: options.tokenId\n        }\n      };\n    },\n    contract: options.contract\n  });\n}\n/**\n * Checks if the `createListing` method is supported by the given contract.\n * @param availableSelectors An array of 4byte function selectors of the contract. You can get this in various ways, such as using \"whatsabi\" or if you have the ABI of the contract available you can use it to generate the selectors.\n * @returns A boolean indicating if the `createListing` method is supported.\n * @extension MARKETPLACE\n * @example\n * ```ts\n * import { isCreateAuctionSupported } from \"thirdweb/extensions/marketplace\";\n *\n * const supported = isCreateAuctionSupported([\"0x...\"]);\n * ```\n */\nexport function isCreateListingSupported(availableSelectors) {\n  return CreateListing.isCreateListingSupported(availableSelectors);\n}","map":{"version":3,"names":["isNativeTokenAddress","NATIVE_TOKEN_ADDRESS","getContract","eth_getBlockByNumber","getRpcClient","toUnits","isERC721","isERC1155","CreateListing","createListing","options","asyncParams","_options$startTimesta","_options$endTimestamp","_options$currencyCont","_options$currencyCont2","_options$isReservedLi","assetContract","_objectSpread","contract","address","assetContractAddress","rpcClient","assetIsERC721","assetIsERC1155","lastestBlock","Promise","all","blockTag","Error","startTimestamp","BigInt","Math","floor","Date","getTime","endTimestamp","now","timestamp","quantity","_options$quantity","currencyAddress","currencyContractAddress","pricePerToken","currencyContract","decimals","currencyDecimals","pricePerTokenWei","overrides","extraGas","params","currency","reserved","isReservedListing","tokenId","isCreateListingSupported","availableSelectors"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/extensions/marketplace/direct-listings/write/createListing.ts"],"sourcesContent":["import type { Address } from \"abitype\";\nimport {\n  isNativeTokenAddress,\n  NATIVE_TOKEN_ADDRESS,\n} from \"../../../../constants/addresses.js\";\nimport { getContract } from \"../../../../contract/contract.js\";\nimport { eth_getBlockByNumber } from \"../../../../rpc/actions/eth_getBlockByNumber.js\";\nimport { getRpcClient } from \"../../../../rpc/rpc.js\";\nimport type { BaseTransactionOptions } from \"../../../../transaction/types.js\";\nimport { toUnits } from \"../../../../utils/units.js\";\nimport { isERC721 } from \"../../../erc721/read/isERC721.js\";\nimport { isERC1155 } from \"../../../erc1155/read/isERC1155.js\";\nimport * as CreateListing from \"../../__generated__/IDirectListings/write/createListing.js\";\n\n/**\n * @extension MARKETPLACE\n */\nexport type CreateListingParams = {\n  /**\n   * The contract address of the asset being listed\n   */\n  assetContractAddress: Address;\n  /**\n   * The ID of the token being listed\n   */\n  tokenId: bigint;\n  /**\n   * The quantity of tokens to list\n   *\n   * For ERC721s, this value can be omitted.\n   * @default 1\n   */\n  quantity?: bigint;\n  /**\n   * The contract address of the currency to accept for the listing\n   * @default NATIVE_TOKEN_ADDRESS\n   */\n  currencyContractAddress?: Address;\n  /**\n   * The start time of the listing\n   * @default new Date()\n   */\n  startTimestamp?: Date;\n  /**\n   * The end time of the listing\n   * @default new Date() + 10 years\n   */\n  endTimestamp?: Date;\n  /**\n   * Whether the listing is reserved to be bought from a specific set of buyers\n   * @default false\n   */\n  isReservedListing?: boolean;\n} & (\n  | {\n      /**\n       * The price per token (in Ether)\n       */\n      pricePerToken: string;\n    }\n  | {\n      /**\n       * The price per token (in wei)\n       */\n      pricePerTokenWei: string;\n    }\n);\n\n/**\n * Creates a direct listing.\n * @param options The options for creating the direct listing.\n * @returns The result of creating the direct listing.\n * @extension MARKETPLACE\n * @example\n * ```typescript\n * import { createListing } from \"thirdweb/extensions/marketplace\";\n * import { sendTransaction } from \"thirdweb\";\n *\n * const transaction = createListing({\n *   assetContractAddress: \"0x...\", // the NFT contract address that you want to sell\n *   tokenId={0n}, // the token id you want to sell\n *   pricePerToken=\"0.1\" // sell for 0.1 <native token>\n * });\n *\n * await sendTransaction({ transaction, account });\n * ```\n */\nexport function createListing(\n  options: BaseTransactionOptions<CreateListingParams>,\n) {\n  return CreateListing.createListing({\n    asyncParams: async () => {\n      const assetContract = getContract({\n        ...options.contract,\n        address: options.assetContractAddress,\n      });\n\n      const rpcClient = getRpcClient(options.contract);\n\n      const [assetIsERC721, assetIsERC1155, lastestBlock] = await Promise.all([\n        isERC721({ contract: assetContract }),\n        isERC1155({ contract: assetContract }),\n        eth_getBlockByNumber(rpcClient, { blockTag: \"latest\" }),\n      ]);\n\n      // validate valid asset\n      if (!assetIsERC721 && !assetIsERC1155) {\n        throw new Error(\"AssetContract must implement ERC 1155 or ERC 721.\");\n      }\n\n      // validate the timestamps\n      let startTimestamp = BigInt(\n        Math.floor((options.startTimestamp ?? new Date()).getTime() / 1000),\n      );\n      const endTimestamp = BigInt(\n        Math.floor(\n          (\n            options.endTimestamp ??\n            new Date(Date.now() + 10 * 365 * 24 * 60 * 60 * 1000)\n          ).getTime() / 1000,\n        ),\n      );\n\n      if (startTimestamp <= lastestBlock.timestamp) {\n        // set the start time to the next block if it is in the past\n        startTimestamp = lastestBlock.timestamp + 1n;\n      }\n      if (startTimestamp >= endTimestamp) {\n        throw new Error(\"Start time must be before end time.\");\n      }\n\n      // valdiate quantity\n      let quantity: bigint;\n      if (assetIsERC721) {\n        // force quantity to 1 for ERC721s\n        quantity = 1n;\n      } else {\n        // otherwise use the provided quantity or default to 1\n        quantity = options.quantity ?? 1n;\n      }\n\n      // validate price\n      const currencyAddress =\n        options.currencyContractAddress ?? NATIVE_TOKEN_ADDRESS;\n      let pricePerToken: bigint;\n      if (\"pricePerToken\" in options) {\n        // for native token, we know decimals are 18\n        if (isNativeTokenAddress(currencyAddress)) {\n          pricePerToken = toUnits(options.pricePerToken, 18);\n        } else {\n          // otherwise get the decimals of the currency\n          const currencyContract = getContract({\n            ...options.contract,\n            address: currencyAddress,\n          });\n          const { decimals } = await import(\"../../../erc20/read/decimals.js\");\n          const currencyDecimals = await decimals({\n            contract: currencyContract,\n          });\n          pricePerToken = toUnits(options.pricePerToken, currencyDecimals);\n        }\n      } else {\n        pricePerToken = BigInt(options.pricePerTokenWei);\n      }\n\n      return {\n        overrides: {\n          extraGas: 50_000n, // add extra gas to account for router call\n        },\n        params: {\n          assetContract: options.assetContractAddress,\n          currency: options.currencyContractAddress ?? NATIVE_TOKEN_ADDRESS,\n          endTimestamp,\n          pricePerToken,\n          quantity,\n          reserved: options.isReservedListing ?? false,\n          startTimestamp,\n          tokenId: options.tokenId,\n        },\n      } as const;\n    },\n    contract: options.contract,\n  });\n}\n\n/**\n * Checks if the `createListing` method is supported by the given contract.\n * @param availableSelectors An array of 4byte function selectors of the contract. You can get this in various ways, such as using \"whatsabi\" or if you have the ABI of the contract available you can use it to generate the selectors.\n * @returns A boolean indicating if the `createListing` method is supported.\n * @extension MARKETPLACE\n * @example\n * ```ts\n * import { isCreateAuctionSupported } from \"thirdweb/extensions/marketplace\";\n *\n * const supported = isCreateAuctionSupported([\"0x...\"]);\n * ```\n */\nexport function isCreateListingSupported(availableSelectors: string[]) {\n  return CreateListing.isCreateListingSupported(availableSelectors);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}