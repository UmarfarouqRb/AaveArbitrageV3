{"ast":null,"code":"\"use client\";\n\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport { trackPayEvent } from \"../../../../analytics/track/pay.js\";\nimport { toUnits } from \"../../../../utils/units.js\";\nimport { useBridgePrepare } from \"../../../core/hooks/useBridgePrepare.js\";\nimport { Container } from \"../components/basic.js\";\nimport { Spacer } from \"../components/Spacer.js\";\nimport { Spinner } from \"../components/Spinner.js\";\nimport { Text } from \"../components/text.js\";\nexport function QuoteLoader(_ref) {\n  let {\n    destinationToken,\n    paymentMethod,\n    amount,\n    sender,\n    receiver,\n    client,\n    onQuoteReceived,\n    onError,\n    purchaseData,\n    paymentLinkId,\n    feePayer,\n    mode\n  } = _ref;\n  const request = getBridgeParams({\n    amount,\n    client,\n    destinationToken,\n    feePayer,\n    paymentLinkId,\n    paymentMethod,\n    purchaseData,\n    receiver,\n    sender\n  });\n  const prepareQuery = useBridgePrepare(request);\n  useQuery({\n    queryFn: () => {\n      trackPayEvent({\n        chainId: paymentMethod.type === \"wallet\" ? paymentMethod.originToken.chainId : undefined,\n        client,\n        event: \"ub:ui:loading_quote:\".concat(mode),\n        fromToken: paymentMethod.type === \"wallet\" ? paymentMethod.originToken.address : undefined,\n        toChainId: destinationToken.chainId,\n        toToken: destinationToken.address\n      });\n      return true;\n    },\n    queryKey: [\"loading_quote\", paymentMethod.type]\n  });\n  // Handle successful quote\n  useEffect(() => {\n    if (prepareQuery.data) {\n      onQuoteReceived(prepareQuery.data, request);\n    }\n  }, [prepareQuery.data, onQuoteReceived, request]);\n  // Handle errors\n  useEffect(() => {\n    if (prepareQuery.error) {\n      onError(prepareQuery.error);\n    }\n  }, [prepareQuery.error, onError]);\n  return _jsxs(Container, {\n    center: \"both\",\n    flex: \"column\",\n    fullHeight: true,\n    p: \"lg\",\n    style: {\n      minHeight: \"350px\"\n    },\n    children: [_jsx(Spinner, {\n      color: \"secondaryText\",\n      size: \"xl\"\n    }), _jsx(Spacer, {\n      y: \"md\"\n    }), _jsx(Text, {\n      center: true,\n      color: \"primaryText\",\n      size: \"lg\",\n      style: {\n        fontWeight: 600\n      },\n      children: \"Finding the best route\"\n    }), _jsx(Spacer, {\n      y: \"sm\"\n    }), _jsx(Text, {\n      center: true,\n      color: \"secondaryText\",\n      size: \"sm\",\n      children: \"We're searching for the most efficient path for this payment.\"\n    })]\n  });\n}\nfunction getBridgeParams(args) {\n  var _paymentMethod$payerW2;\n  const {\n    paymentMethod,\n    amount,\n    destinationToken,\n    receiver,\n    client,\n    sender\n  } = args;\n  switch (paymentMethod.type) {\n    case \"fiat\":\n      return {\n        amount: toUnits(amount, destinationToken.decimals),\n        chainId: destinationToken.chainId,\n        client,\n        currency: paymentMethod.currency,\n        enabled: !!(destinationToken && amount && client),\n        onramp: paymentMethod.onramp || \"coinbase\",\n        paymentLinkId: args.paymentLinkId,\n        purchaseData: args.purchaseData,\n        receiver,\n        sender,\n        // always onramp to native token\n        tokenAddress: destinationToken.address,\n        type: \"onramp\"\n      };\n    case \"wallet\":\n      // if the origin token is the same as the destination token, use transfer type\n      if (paymentMethod.originToken.chainId === destinationToken.chainId && paymentMethod.originToken.address.toLowerCase() === destinationToken.address.toLowerCase()) {\n        var _paymentMethod$payerW;\n        return {\n          amount: toUnits(amount, destinationToken.decimals),\n          chainId: destinationToken.chainId,\n          client,\n          enabled: !!(destinationToken && amount && client),\n          feePayer: args.feePayer || \"sender\",\n          paymentLinkId: args.paymentLinkId,\n          purchaseData: args.purchaseData,\n          receiver,\n          sender: sender || ((_paymentMethod$payerW = paymentMethod.payerWallet.getAccount()) === null || _paymentMethod$payerW === void 0 ? void 0 : _paymentMethod$payerW.address) || receiver,\n          tokenAddress: destinationToken.address,\n          type: \"transfer\"\n        };\n      }\n      return {\n        amount: paymentMethod.action === \"buy\" ? toUnits(amount, destinationToken.decimals) : toUnits(amount, paymentMethod.originToken.decimals),\n        client,\n        destinationChainId: destinationToken.chainId,\n        destinationTokenAddress: destinationToken.address,\n        enabled: !!(destinationToken && amount && client),\n        originChainId: paymentMethod.originToken.chainId,\n        originTokenAddress: paymentMethod.originToken.address,\n        paymentLinkId: args.paymentLinkId,\n        purchaseData: args.purchaseData,\n        receiver,\n        sender: sender || ((_paymentMethod$payerW2 = paymentMethod.payerWallet.getAccount()) === null || _paymentMethod$payerW2 === void 0 ? void 0 : _paymentMethod$payerW2.address) || receiver,\n        type: paymentMethod.action\n      };\n  }\n}","map":{"version":3,"names":["useQuery","useEffect","trackPayEvent","toUnits","useBridgePrepare","Container","Spacer","Spinner","Text","QuoteLoader","_ref","destinationToken","paymentMethod","amount","sender","receiver","client","onQuoteReceived","onError","purchaseData","paymentLinkId","feePayer","mode","request","getBridgeParams","prepareQuery","queryFn","chainId","type","originToken","undefined","event","concat","fromToken","address","toChainId","toToken","queryKey","data","error","_jsxs","center","flex","fullHeight","p","style","minHeight","children","_jsx","color","size","y","fontWeight","args","_paymentMethod$payerW2","decimals","currency","enabled","onramp","tokenAddress","toLowerCase","_paymentMethod$payerW","payerWallet","getAccount","action","destinationChainId","destinationTokenAddress","originChainId","originTokenAddress"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/react/web/ui/Bridge/QuoteLoader.tsx"],"sourcesContent":["\"use client\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport { trackPayEvent } from \"../../../../analytics/track/pay.js\";\nimport type { Token } from \"../../../../bridge/types/Token.js\";\nimport type { ThirdwebClient } from \"../../../../client/client.js\";\nimport type { PurchaseData } from \"../../../../pay/types.js\";\nimport { toUnits } from \"../../../../utils/units.js\";\nimport {\n  type BridgePrepareRequest,\n  type BridgePrepareResult,\n  type UseBridgePrepareParams,\n  useBridgePrepare,\n} from \"../../../core/hooks/useBridgePrepare.js\";\nimport { Container } from \"../components/basic.js\";\nimport { Spacer } from \"../components/Spacer.js\";\nimport { Spinner } from \"../components/Spinner.js\";\nimport { Text } from \"../components/text.js\";\nimport type { PaymentMethod } from \"./types.js\";\n\ninterface QuoteLoaderProps {\n  /**\n   * The destination token to bridge to\n   */\n  destinationToken: Token;\n\n  /**\n   * The payment method to use\n   */\n  paymentMethod: PaymentMethod;\n\n  /**\n   * The amount to bridge (as string)\n   */\n  amount: string;\n\n  /**\n   * The sender address\n   */\n  sender: string | undefined;\n\n  /**\n   * The receiver address\n   */\n  receiver: string;\n\n  /**\n   * ThirdwebClient for API calls\n   */\n  client: ThirdwebClient;\n\n  /**\n   * Called when a quote is successfully received\n   */\n  onQuoteReceived: (\n    preparedQuote: BridgePrepareResult,\n    request: BridgePrepareRequest,\n  ) => void;\n\n  /**\n   * Called when an error occurs\n   */\n  onError: (error: Error) => void;\n  /**\n   * Called when user wants to go back\n   */\n  onBack: (() => void) | undefined;\n\n  /**\n   * Optional purchase data for the payment\n   */\n  purchaseData: PurchaseData | undefined;\n\n  /**\n   * Optional payment link ID for the payment\n   */\n  paymentLinkId: string | undefined;\n\n  feePayer: \"sender\" | \"receiver\" | undefined;\n  mode: \"direct_payment\" | \"fund_wallet\" | \"transaction\";\n}\n\nexport function QuoteLoader({\n  destinationToken,\n  paymentMethod,\n  amount,\n  sender,\n  receiver,\n  client,\n  onQuoteReceived,\n  onError,\n  purchaseData,\n  paymentLinkId,\n  feePayer,\n  mode,\n}: QuoteLoaderProps) {\n  const request: BridgePrepareRequest = getBridgeParams({\n    amount,\n    client,\n    destinationToken,\n    feePayer,\n    paymentLinkId,\n    paymentMethod,\n    purchaseData,\n    receiver,\n    sender,\n  });\n  const prepareQuery = useBridgePrepare(request);\n\n  useQuery({\n    queryFn: () => {\n      trackPayEvent({\n        chainId:\n          paymentMethod.type === \"wallet\"\n            ? paymentMethod.originToken.chainId\n            : undefined,\n        client,\n        event: `ub:ui:loading_quote:${mode}`,\n        fromToken:\n          paymentMethod.type === \"wallet\"\n            ? paymentMethod.originToken.address\n            : undefined,\n        toChainId: destinationToken.chainId,\n        toToken: destinationToken.address,\n      });\n      return true;\n    },\n    queryKey: [\"loading_quote\", paymentMethod.type],\n  });\n\n  // Handle successful quote\n  useEffect(() => {\n    if (prepareQuery.data) {\n      onQuoteReceived(prepareQuery.data, request);\n    }\n  }, [prepareQuery.data, onQuoteReceived, request]);\n\n  // Handle errors\n  useEffect(() => {\n    if (prepareQuery.error) {\n      onError(prepareQuery.error as Error);\n    }\n  }, [prepareQuery.error, onError]);\n\n  return (\n    <Container\n      center=\"both\"\n      flex=\"column\"\n      fullHeight\n      p=\"lg\"\n      style={{ minHeight: \"350px\" }}\n    >\n      <Spinner color=\"secondaryText\" size=\"xl\" />\n      <Spacer y=\"md\" />\n      <Text center color=\"primaryText\" size=\"lg\" style={{ fontWeight: 600 }}>\n        Finding the best route\n      </Text>\n      <Spacer y=\"sm\" />\n      <Text center color=\"secondaryText\" size=\"sm\">\n        We're searching for the most efficient path for this payment.\n      </Text>\n    </Container>\n  );\n}\n\nfunction getBridgeParams(args: {\n  paymentMethod: PaymentMethod;\n  amount: string;\n  destinationToken: Token;\n  receiver: string;\n  client: ThirdwebClient;\n  sender?: string;\n  feePayer?: \"sender\" | \"receiver\";\n  purchaseData?: PurchaseData;\n  paymentLinkId?: string;\n}): UseBridgePrepareParams {\n  const { paymentMethod, amount, destinationToken, receiver, client, sender } =\n    args;\n\n  switch (paymentMethod.type) {\n    case \"fiat\":\n      return {\n        amount: toUnits(amount, destinationToken.decimals),\n        chainId: destinationToken.chainId,\n        client,\n        currency: paymentMethod.currency,\n        enabled: !!(destinationToken && amount && client),\n        onramp: paymentMethod.onramp || \"coinbase\",\n        paymentLinkId: args.paymentLinkId,\n        purchaseData: args.purchaseData,\n        receiver,\n        sender, // always onramp to native token\n        tokenAddress: destinationToken.address,\n        type: \"onramp\",\n      };\n    case \"wallet\":\n      // if the origin token is the same as the destination token, use transfer type\n      if (\n        paymentMethod.originToken.chainId === destinationToken.chainId &&\n        paymentMethod.originToken.address.toLowerCase() ===\n          destinationToken.address.toLowerCase()\n      ) {\n        return {\n          amount: toUnits(amount, destinationToken.decimals),\n          chainId: destinationToken.chainId,\n          client,\n          enabled: !!(destinationToken && amount && client),\n          feePayer: args.feePayer || \"sender\",\n          paymentLinkId: args.paymentLinkId,\n          purchaseData: args.purchaseData,\n          receiver,\n          sender:\n            sender ||\n            paymentMethod.payerWallet.getAccount()?.address ||\n            receiver,\n          tokenAddress: destinationToken.address,\n          type: \"transfer\",\n        };\n      }\n\n      return {\n        amount:\n          paymentMethod.action === \"buy\"\n            ? toUnits(amount, destinationToken.decimals)\n            : toUnits(amount, paymentMethod.originToken.decimals),\n        client,\n        destinationChainId: destinationToken.chainId,\n        destinationTokenAddress: destinationToken.address,\n        enabled: !!(destinationToken && amount && client),\n        originChainId: paymentMethod.originToken.chainId,\n        originTokenAddress: paymentMethod.originToken.address,\n        paymentLinkId: args.paymentLinkId,\n        purchaseData: args.purchaseData,\n        receiver,\n        sender:\n          sender || paymentMethod.payerWallet.getAccount()?.address || receiver,\n        type: paymentMethod.action,\n      };\n  }\n}\n"],"mappings":"AAAA,YAAY;;;AACZ,SAASA,QAAQ,QAAQ,uBAAuB;AAChD,SAASC,SAAS,QAAQ,OAAO;AACjC,SAASC,aAAa,QAAQ,oCAAoC;AAIlE,SAASC,OAAO,QAAQ,4BAA4B;AACpD,SAIEC,gBAAgB,QACX,yCAAyC;AAChD,SAASC,SAAS,QAAQ,wBAAwB;AAClD,SAASC,MAAM,QAAQ,yBAAyB;AAChD,SAASC,OAAO,QAAQ,0BAA0B;AAClD,SAASC,IAAI,QAAQ,uBAAuB;AAiE5C,OAAM,SAAUC,WAAWA,CAAAC,IAAA,EAaR;EAAA,IAbS;IAC1BC,gBAAgB;IAChBC,aAAa;IACbC,MAAM;IACNC,MAAM;IACNC,QAAQ;IACRC,MAAM;IACNC,eAAe;IACfC,OAAO;IACPC,YAAY;IACZC,aAAa;IACbC,QAAQ;IACRC;EAAI,CACa,GAAAZ,IAAA;EACjB,MAAMa,OAAO,GAAyBC,eAAe,CAAC;IACpDX,MAAM;IACNG,MAAM;IACNL,gBAAgB;IAChBU,QAAQ;IACRD,aAAa;IACbR,aAAa;IACbO,YAAY;IACZJ,QAAQ;IACRD;GACD,CAAC;EACF,MAAMW,YAAY,GAAGrB,gBAAgB,CAACmB,OAAO,CAAC;EAE9CvB,QAAQ,CAAC;IACP0B,OAAO,EAAEA,CAAA,KAAK;MACZxB,aAAa,CAAC;QACZyB,OAAO,EACLf,aAAa,CAACgB,IAAI,KAAK,QAAQ,GAC3BhB,aAAa,CAACiB,WAAW,CAACF,OAAO,GACjCG,SAAS;QACfd,MAAM;QACNe,KAAK,yBAAAC,MAAA,CAAyBV,IAAI,CAAE;QACpCW,SAAS,EACPrB,aAAa,CAACgB,IAAI,KAAK,QAAQ,GAC3BhB,aAAa,CAACiB,WAAW,CAACK,OAAO,GACjCJ,SAAS;QACfK,SAAS,EAAExB,gBAAgB,CAACgB,OAAO;QACnCS,OAAO,EAAEzB,gBAAgB,CAACuB;OAC3B,CAAC;MACF,OAAO,IAAI;IACb,CAAC;IACDG,QAAQ,EAAE,CAAC,eAAe,EAAEzB,aAAa,CAACgB,IAAI;GAC/C,CAAC;EAEF;EACA3B,SAAS,CAAC,MAAK;IACb,IAAIwB,YAAY,CAACa,IAAI,EAAE;MACrBrB,eAAe,CAACQ,YAAY,CAACa,IAAI,EAAEf,OAAO,CAAC;IAC7C;EACF,CAAC,EAAE,CAACE,YAAY,CAACa,IAAI,EAAErB,eAAe,EAAEM,OAAO,CAAC,CAAC;EAEjD;EACAtB,SAAS,CAAC,MAAK;IACb,IAAIwB,YAAY,CAACc,KAAK,EAAE;MACtBrB,OAAO,CAACO,YAAY,CAACc,KAAc,CAAC;IACtC;EACF,CAAC,EAAE,CAACd,YAAY,CAACc,KAAK,EAAErB,OAAO,CAAC,CAAC;EAEjC,OACEsB,KAAA,CAACnC,SAAS;IACRoC,MAAM,EAAC,MAAM;IACbC,IAAI,EAAC,QAAQ;IACbC,UAAU;IACVC,CAAC,EAAC,IAAI;IACNC,KAAK,EAAE;MAAEC,SAAS,EAAE;IAAO,CAAE;IAAAC,QAAA,GAE7BC,IAAA,CAACzC,OAAO;MAAC0C,KAAK,EAAC,eAAe;MAACC,IAAI,EAAC;IAAI,EAAG,EAC3CF,IAAA,CAAC1C,MAAM;MAAC6C,CAAC,EAAC;IAAI,EAAG,EACjBH,IAAA,CAACxC,IAAI;MAACiC,MAAM;MAACQ,KAAK,EAAC,aAAa;MAACC,IAAI,EAAC,IAAI;MAACL,KAAK,EAAE;QAAEO,UAAU,EAAE;MAAG,CAAE;MAAAL,QAAA;IAAA,EAE9D,EACPC,IAAA,CAAC1C,MAAM;MAAC6C,CAAC,EAAC;IAAI,EAAG,EACjBH,IAAA,CAACxC,IAAI;MAACiC,MAAM;MAACQ,KAAK,EAAC,eAAe;MAACC,IAAI,EAAC,IAAI;MAAAH,QAAA;IAAA,EAErC;EAAA,EACG;AAEhB;AAEA,SAASvB,eAAeA,CAAC6B,IAUxB;EAAA,IAAAC,sBAAA;EACC,MAAM;IAAE1C,aAAa;IAAEC,MAAM;IAAEF,gBAAgB;IAAEI,QAAQ;IAAEC,MAAM;IAAEF;EAAM,CAAE,GACzEuC,IAAI;EAEN,QAAQzC,aAAa,CAACgB,IAAI;IACxB,KAAK,MAAM;MACT,OAAO;QACLf,MAAM,EAAEV,OAAO,CAACU,MAAM,EAAEF,gBAAgB,CAAC4C,QAAQ,CAAC;QAClD5B,OAAO,EAAEhB,gBAAgB,CAACgB,OAAO;QACjCX,MAAM;QACNwC,QAAQ,EAAE5C,aAAa,CAAC4C,QAAQ;QAChCC,OAAO,EAAE,CAAC,EAAE9C,gBAAgB,IAAIE,MAAM,IAAIG,MAAM,CAAC;QACjD0C,MAAM,EAAE9C,aAAa,CAAC8C,MAAM,IAAI,UAAU;QAC1CtC,aAAa,EAAEiC,IAAI,CAACjC,aAAa;QACjCD,YAAY,EAAEkC,IAAI,CAAClC,YAAY;QAC/BJ,QAAQ;QACRD,MAAM;QAAE;QACR6C,YAAY,EAAEhD,gBAAgB,CAACuB,OAAO;QACtCN,IAAI,EAAE;OACP;IACH,KAAK,QAAQ;MACX;MACA,IACEhB,aAAa,CAACiB,WAAW,CAACF,OAAO,KAAKhB,gBAAgB,CAACgB,OAAO,IAC9Df,aAAa,CAACiB,WAAW,CAACK,OAAO,CAAC0B,WAAW,EAAE,KAC7CjD,gBAAgB,CAACuB,OAAO,CAAC0B,WAAW,EAAE,EACxC;QAAA,IAAAC,qBAAA;QACA,OAAO;UACLhD,MAAM,EAAEV,OAAO,CAACU,MAAM,EAAEF,gBAAgB,CAAC4C,QAAQ,CAAC;UAClD5B,OAAO,EAAEhB,gBAAgB,CAACgB,OAAO;UACjCX,MAAM;UACNyC,OAAO,EAAE,CAAC,EAAE9C,gBAAgB,IAAIE,MAAM,IAAIG,MAAM,CAAC;UACjDK,QAAQ,EAAEgC,IAAI,CAAChC,QAAQ,IAAI,QAAQ;UACnCD,aAAa,EAAEiC,IAAI,CAACjC,aAAa;UACjCD,YAAY,EAAEkC,IAAI,CAAClC,YAAY;UAC/BJ,QAAQ;UACRD,MAAM,EACJA,MAAM,MAAA+C,qBAAA,GACNjD,aAAa,CAACkD,WAAW,CAACC,UAAU,EAAE,cAAAF,qBAAA,uBAAtCA,qBAAA,CAAwC3B,OAAO,KAC/CnB,QAAQ;UACV4C,YAAY,EAAEhD,gBAAgB,CAACuB,OAAO;UACtCN,IAAI,EAAE;SACP;MACH;MAEA,OAAO;QACLf,MAAM,EACJD,aAAa,CAACoD,MAAM,KAAK,KAAK,GAC1B7D,OAAO,CAACU,MAAM,EAAEF,gBAAgB,CAAC4C,QAAQ,CAAC,GAC1CpD,OAAO,CAACU,MAAM,EAAED,aAAa,CAACiB,WAAW,CAAC0B,QAAQ,CAAC;QACzDvC,MAAM;QACNiD,kBAAkB,EAAEtD,gBAAgB,CAACgB,OAAO;QAC5CuC,uBAAuB,EAAEvD,gBAAgB,CAACuB,OAAO;QACjDuB,OAAO,EAAE,CAAC,EAAE9C,gBAAgB,IAAIE,MAAM,IAAIG,MAAM,CAAC;QACjDmD,aAAa,EAAEvD,aAAa,CAACiB,WAAW,CAACF,OAAO;QAChDyC,kBAAkB,EAAExD,aAAa,CAACiB,WAAW,CAACK,OAAO;QACrDd,aAAa,EAAEiC,IAAI,CAACjC,aAAa;QACjCD,YAAY,EAAEkC,IAAI,CAAClC,YAAY;QAC/BJ,QAAQ;QACRD,MAAM,EACJA,MAAM,MAAAwC,sBAAA,GAAI1C,aAAa,CAACkD,WAAW,CAACC,UAAU,EAAE,cAAAT,sBAAA,uBAAtCA,sBAAA,CAAwCpB,OAAO,KAAInB,QAAQ;QACvEa,IAAI,EAAEhB,aAAa,CAACoD;OACrB;EACL;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}