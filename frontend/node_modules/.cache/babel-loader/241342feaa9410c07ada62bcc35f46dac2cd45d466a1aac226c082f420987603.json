{"ast":null,"code":"import { watchBlockNumber } from \"../../rpc/watchBlockNumber.js\";\nimport { getCallsStatus } from \"./get-calls-status.js\";\nconst DEFAULT_MAX_BLOCKS_WAIT_TIME = 100;\nconst map = new Map();\n/**\n * Waits for the [EIP-5792](https://eips.ethereum.org/EIPS/eip-5792) bundle to be confirmed.\n *\n *  This function is dependent on the wallet's support for EIP-5792 and could fail.\n *\n * @param options - The options for waiting for the bundle.\n * By default, the max wait time is 100 blocks.\n * @returns A promise that resolves with the final {@link getCallsStatus} result.\n * @throws an error if the wallet does not support EIP-5792.\n * @beta\n * @example\n * ```ts\n * import { waitForCallsReceipt } from \"thirdweb/wallets/eip5792\";\n * const result = await waitForCallsReceipt({\n *   client,\n *   chain,\n *   wallet,\n *   id: \"0x123...\",\n * });\n * ```\n *\n * Example with useSendCalls:\n * ```ts\n * const sendResult = await sendCalls({\n *   client,\n *   chain,\n *   wallet,\n *   calls: [...],\n * });\n * const confirmResult = await waitForCallsReceipt(sendResult);\n * console.log(\"Transaction confirmed: \", confirmResult.receipts?.[0].transactionHash);\n * ```\n * @extension EIP5792\n */\nexport function waitForCallsReceipt(options) {\n  var _options$maxBlocksWai;\n  const {\n    id,\n    chain,\n    wallet,\n    client\n  } = options;\n  const chainId = chain.id;\n  const key = \"\".concat(chainId, \":calls_\").concat(id);\n  const maxBlocksWaitTime = (_options$maxBlocksWai = options.maxBlocksWaitTime) !== null && _options$maxBlocksWai !== void 0 ? _options$maxBlocksWai : DEFAULT_MAX_BLOCKS_WAIT_TIME;\n  if (map.has(key)) {\n    // biome-ignore lint/style/noNonNullAssertion: the `has` above ensures that this will always be set\n    return map.get(key);\n  }\n  const promise = new Promise((resolve, reject) => {\n    // start at -1 because the first block doesn't count\n    let blocksWaited = -1;\n    const unwatch = watchBlockNumber({\n      chain: chain,\n      client: client,\n      onNewBlockNumber: async () => {\n        blocksWaited++;\n        if (blocksWaited >= maxBlocksWaitTime) {\n          unwatch();\n          reject(new Error(\"Bundle not confirmed after \".concat(maxBlocksWaitTime, \" blocks\")));\n          return;\n        }\n        try {\n          const result = await getCallsStatus({\n            client,\n            id,\n            wallet\n          });\n          if (result.status === \"success\" || result.status === \"failure\") {\n            // stop the polling\n            unwatch();\n            // resolve the top level promise with the result\n            resolve(result);\n            return;\n          }\n        } catch (_unused) {\n          // noop, we'll try again on the next blocks\n        }\n      }\n    });\n    // remove the promise from the map when it's done (one way or the other)\n  }).finally(() => {\n    map.delete(key);\n  });\n  map.set(key, promise);\n  return promise;\n}","map":{"version":3,"names":["watchBlockNumber","getCallsStatus","DEFAULT_MAX_BLOCKS_WAIT_TIME","map","Map","waitForCallsReceipt","options","_options$maxBlocksWai","id","chain","wallet","client","chainId","key","concat","maxBlocksWaitTime","has","get","promise","Promise","resolve","reject","blocksWaited","unwatch","onNewBlockNumber","Error","result","status","_unused","finally","delete","set"],"sources":["/home/user/Arbitrage/frontend/node_modules/thirdweb/src/wallets/eip5792/wait-for-calls-receipt.ts"],"sourcesContent":["import type { Chain } from \"../../chains/types.js\";\nimport type { ThirdwebClient } from \"../../client/client.js\";\nimport { watchBlockNumber } from \"../../rpc/watchBlockNumber.js\";\nimport type { Prettify } from \"../../utils/type-utils.js\";\nimport type { Wallet } from \"../interfaces/wallet.js\";\nimport { getCallsStatus } from \"./get-calls-status.js\";\nimport type { GetCallsStatusResponse } from \"./types.js\";\n\nconst DEFAULT_MAX_BLOCKS_WAIT_TIME = 100;\n\nconst map = new Map<string, Promise<GetCallsStatusResponse>>();\n\nexport type WaitForCallsReceiptOptions = Prettify<{\n  id: string;\n  client: ThirdwebClient;\n  chain: Chain;\n  wallet: Wallet;\n  maxBlocksWaitTime?: number;\n}>;\n/**\n * Waits for the [EIP-5792](https://eips.ethereum.org/EIPS/eip-5792) bundle to be confirmed.\n *\n *  This function is dependent on the wallet's support for EIP-5792 and could fail.\n *\n * @param options - The options for waiting for the bundle.\n * By default, the max wait time is 100 blocks.\n * @returns A promise that resolves with the final {@link getCallsStatus} result.\n * @throws an error if the wallet does not support EIP-5792.\n * @beta\n * @example\n * ```ts\n * import { waitForCallsReceipt } from \"thirdweb/wallets/eip5792\";\n * const result = await waitForCallsReceipt({\n *   client,\n *   chain,\n *   wallet,\n *   id: \"0x123...\",\n * });\n * ```\n *\n * Example with useSendCalls:\n * ```ts\n * const sendResult = await sendCalls({\n *   client,\n *   chain,\n *   wallet,\n *   calls: [...],\n * });\n * const confirmResult = await waitForCallsReceipt(sendResult);\n * console.log(\"Transaction confirmed: \", confirmResult.receipts?.[0].transactionHash);\n * ```\n * @extension EIP5792\n */\nexport function waitForCallsReceipt(\n  options: WaitForCallsReceiptOptions,\n): Promise<GetCallsStatusResponse> {\n  const { id, chain, wallet, client } = options;\n\n  const chainId = chain.id;\n  const key = `${chainId}:calls_${id}`;\n  const maxBlocksWaitTime =\n    options.maxBlocksWaitTime ?? DEFAULT_MAX_BLOCKS_WAIT_TIME;\n\n  if (map.has(key)) {\n    // biome-ignore lint/style/noNonNullAssertion: the `has` above ensures that this will always be set\n    return map.get(key)!;\n  }\n  const promise = new Promise<GetCallsStatusResponse>((resolve, reject) => {\n    // start at -1 because the first block doesn't count\n    let blocksWaited = -1;\n\n    const unwatch = watchBlockNumber({\n      chain: chain,\n      client: client,\n      onNewBlockNumber: async () => {\n        blocksWaited++;\n        if (blocksWaited >= maxBlocksWaitTime) {\n          unwatch();\n          reject(\n            new Error(`Bundle not confirmed after ${maxBlocksWaitTime} blocks`),\n          );\n          return;\n        }\n        try {\n          const result = await getCallsStatus({\n            client,\n            id,\n            wallet,\n          });\n          if (result.status === \"success\" || result.status === \"failure\") {\n            // stop the polling\n            unwatch();\n            // resolve the top level promise with the result\n            resolve(result);\n            return;\n          }\n        } catch {\n          // noop, we'll try again on the next blocks\n        }\n      },\n    });\n    // remove the promise from the map when it's done (one way or the other)\n  }).finally(() => {\n    map.delete(key);\n  });\n\n  map.set(key, promise);\n  return promise;\n}\n"],"mappings":"AAEA,SAASA,gBAAgB,QAAQ,+BAA+B;AAGhE,SAASC,cAAc,QAAQ,uBAAuB;AAGtD,MAAMC,4BAA4B,GAAG,GAAG;AAExC,MAAMC,GAAG,GAAG,IAAIC,GAAG,EAA2C;AAS9D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCA,OAAM,SAAUC,mBAAmBA,CACjCC,OAAmC;EAAA,IAAAC,qBAAA;EAEnC,MAAM;IAAEC,EAAE;IAAEC,KAAK;IAAEC,MAAM;IAAEC;EAAM,CAAE,GAAGL,OAAO;EAE7C,MAAMM,OAAO,GAAGH,KAAK,CAACD,EAAE;EACxB,MAAMK,GAAG,MAAAC,MAAA,CAAMF,OAAO,aAAAE,MAAA,CAAUN,EAAE,CAAE;EACpC,MAAMO,iBAAiB,IAAAR,qBAAA,GACrBD,OAAO,CAACS,iBAAiB,cAAAR,qBAAA,cAAAA,qBAAA,GAAIL,4BAA4B;EAE3D,IAAIC,GAAG,CAACa,GAAG,CAACH,GAAG,CAAC,EAAE;IAChB;IACA,OAAOV,GAAG,CAACc,GAAG,CAACJ,GAAG,CAAE;EACtB;EACA,MAAMK,OAAO,GAAG,IAAIC,OAAO,CAAyB,CAACC,OAAO,EAAEC,MAAM,KAAI;IACtE;IACA,IAAIC,YAAY,GAAG,CAAC,CAAC;IAErB,MAAMC,OAAO,GAAGvB,gBAAgB,CAAC;MAC/BS,KAAK,EAAEA,KAAK;MACZE,MAAM,EAAEA,MAAM;MACda,gBAAgB,EAAE,MAAAA,CAAA,KAAW;QAC3BF,YAAY,EAAE;QACd,IAAIA,YAAY,IAAIP,iBAAiB,EAAE;UACrCQ,OAAO,EAAE;UACTF,MAAM,CACJ,IAAII,KAAK,+BAAAX,MAAA,CAA+BC,iBAAiB,YAAS,CAAC,CACpE;UACD;QACF;QACA,IAAI;UACF,MAAMW,MAAM,GAAG,MAAMzB,cAAc,CAAC;YAClCU,MAAM;YACNH,EAAE;YACFE;WACD,CAAC;UACF,IAAIgB,MAAM,CAACC,MAAM,KAAK,SAAS,IAAID,MAAM,CAACC,MAAM,KAAK,SAAS,EAAE;YAC9D;YACAJ,OAAO,EAAE;YACT;YACAH,OAAO,CAACM,MAAM,CAAC;YACf;UACF;QACF,CAAC,CAAC,OAAAE,OAAA,EAAM;UACN;QAAA;MAEJ;KACD,CAAC;IACF;EACF,CAAC,CAAC,CAACC,OAAO,CAAC,MAAK;IACd1B,GAAG,CAAC2B,MAAM,CAACjB,GAAG,CAAC;EACjB,CAAC,CAAC;EAEFV,GAAG,CAAC4B,GAAG,CAAClB,GAAG,EAAEK,OAAO,CAAC;EACrB,OAAOA,OAAO;AAChB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}