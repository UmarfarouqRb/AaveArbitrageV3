"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[75211,93431],{17749:(e,t,a)=>{async function i(e,t){return await e({method:"eth_sendRawTransaction",params:[t]})}a.d(t,{B:()=>i})},62600:(e,t,a)=>{function i(e){return new Promise(t=>setTimeout(t,e))}a.d(t,{y:()=>i})},75211:(e,t,a)=>{a.d(t,{InAppWebConnector:()=>Y});var i=a(8),n=a(18342);const o=new Map,s={getItem:async e=>{var t;return null!==(t=o.get(e))&&void 0!==t?t:null},removeItem:async e=>{o.delete(e)},setItem:async(e,t)=>{o.set(e,t)}};var r=a(22318),c=a(58989);async function l(e){let{authToken:t,client:a,ecosystem:i}=e;const o=(0,c.KI)(a,i),s=await o("".concat((0,n.Wg)("inAppWallet"),"/api/2024-05-05/accounts"),{headers:{Authorization:"Bearer embedded-wallet-token:".concat(t),"Content-Type":"application/json"},method:"GET"});if(!s.ok){const e=await s.text().catch(()=>"Unknown error");throw new Error("Failed to get user info: ".concat(e))}return await s.json()}var d=a(77717);const u=(0,n.Wg)("inAppWallet"),h="".concat(u,"/"),g="".concat(h,"api/2023-10-20"),p="".concat(h,"api/2024-05-05"),w=("".concat(g,"/embedded-wallet/embedded-wallet-user-details"),"cognito-idp.".concat("us-west-2",".amazonaws.com/").concat("us-west-2_UFwLcZIpq"),"".concat(g,"/embedded-wallet/embedded-wallet-shares"),"".concat(g,"/embedded-wallet/embedded-wallet-shares"),"".concat(g,"/embedded-wallet/verify-thirdweb-client-id"),"".concat(g,"/embedded-wallet/validate-custom-jwt")),m="".concat(g,"/embedded-wallet/validate-custom-auth-endpoint"),y=("".concat(g,"/embedded-wallet/cognito-id-token"),"".concat(p,"/login/web-token-exchange"),(e,t)=>t instanceof Error?"".concat(e,": ").concat(t.message):"".concat(e,": ").concat((0,d.A)(t)));var v=a(86085);var f=a(89953),b=a(41940);function I(){return"".concat((0,n.Wg)("inAppWallet"),"/api/2024-05-05/login/passkey/callback")}function k(e,t){return"".concat((0,n.Wg)("inAppWallet"),"/api/2024-05-05/login/passkey?type=").concat(e).concat(t?"&username=".concat(t):"")}async function A(e){var t,a,n,o;if(!e.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const s=(0,c.KI)(e.client,e.ecosystem),r=null!==(t=e.username)&&void 0!==t?t:function(e){var t;return"".concat(null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:"wallet","-").concat((new Date).toISOString())}(e.ecosystem),l=await s(k("sign-up",r)),u=await l.json();if(!u.challenge)throw new Error("No challenge received");const h=u.challenge,g=await e.passkeyClient.register({challenge:h,name:r,rp:e.rp}),p={};null!==(a=e.ecosystem)&&void 0!==a&&a.partnerId&&(p["x-ecosystem-partner-id"]=e.ecosystem.partnerId),null!==(n=e.ecosystem)&&void 0!==n&&n.id&&(p["x-ecosystem-id"]=e.ecosystem.id);const w=await s(I(),{body:(0,d.A)({authenticatorData:g.authenticatorData,clientData:g.clientData,credential:{algorithm:g.credential.algorithm,publicKey:g.credential.publicKey},credentialId:g.credentialId,origin:g.origin,rpId:e.rp.id,serverVerificationId:u.serverVerificationId,type:"sign-up",username:r}),headers:(0,i.A)({"Content-Type":"application/json"},p),method:"POST"}),m=await w.json();var y;if(!m||!m.storedToken)throw new Error("Error verifying passkey: ".concat(null!==(y=m.message)&&void 0!==y?y:"unknown error"));return await(null===(o=e.storage)||void 0===o?void 0:o.savePasskeyCredentialId(g.credentialId)),m}var T=a(93431),W=a(9893);var S=a(84117),P=a(15222),L=a(17749),C=a(72364),j=a(83423),E=a(3340),O=a(97779),x=a(34476);class N{constructor(e){let{client:t,ecosystem:a,address:i,storage:n}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"address",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=a,this.address=i,this.localStorage=n}async postWalletSetUp(e){await this.localStorage.saveAuthCookie(e.storedToken.cookieString)}async getUserWalletStatus(){var e,t;const a=await this.localStorage.getAuthCookie();if(!a)return{status:"Logged Out"};const i=await l({authToken:a,client:this.client,ecosystem:this.ecosystem});if(!i)return{status:"Logged Out"};const n=i.wallets[0],o={email:null===(e=i.linkedAccounts.find(e=>void 0!==e.details.email))||void 0===e?void 0:e.details.email,phoneNumber:null===(t=i.linkedAccounts.find(e=>void 0!==e.details.phone))||void 0===t?void 0:t.details.phone,recoveryShareManagement:"ENCLAVE",userWalletId:i.id||""};return n?{account:await this.getAccount(),authDetails:o,status:"Logged In, Wallet Initialized",walletAddress:n.address}:{authDetails:o,status:"Logged In, Wallet Uninitialized"}}async getAccount(){const e=this.client,t=this.localStorage,o=this.address,s=this.ecosystem,r=async i=>{const o=(0,C.getRpcClient)({chain:(0,W.Q4)(i.chainId),client:e}),s={chainId:(0,E.nj)(i.chainId),data:i.data,gas:D(i.gas),nonce:D(i.nonce)||(0,E.nj)(await a.e(37338).then(a.bind(a,37338)).then(e=>{let{eth_getTransactionCount:t}=e;return t(o,{address:(0,j.bv)(this.address),blockTag:"pending"})})),to:i.to?(0,j.bv)(i.to):void 0,value:D(i.value)};return i.authorizationList&&i.authorizationList.length>0?(s.type=4,s.authorizationList=i.authorizationList,s.maxFeePerGas=D(i.maxFeePerGas),s.maxPriorityFeePerGas=D(i.maxPriorityFeePerGas)):D(i.maxFeePerGas)?(s.maxFeePerGas=D(i.maxFeePerGas),s.maxPriorityFeePerGas=D(i.maxPriorityFeePerGas),s.type=2):(s.gasPrice=D(i.gasPrice),s.type=0),async function(e){let{client:t,payload:a,storage:i}=e;const o=await i.getAuthCookie(),s=i.ecosystem,r=(0,c.KI)(t,s);if(!o)throw new Error("No auth token found when signing transaction");const l=await r("".concat((0,n.Wg)("inAppWallet"),"/api/v1/enclave-wallet/sign-transaction"),{body:(0,d.A)({transactionPayload:a}),headers:{Authorization:"Bearer embedded-wallet-token:".concat(o),"Content-Type":"application/json","x-thirdweb-client-id":t.clientId},method:"POST"});if(!l.ok)throw new Error("Failed to sign transaction - ".concat(l.status," ").concat(l.statusText));return(await l.json()).signature}({client:e,payload:s,storage:t})},l={address:(0,j.bv)(o),async sendTransaction(t){var a;const i=(0,C.getRpcClient)({chain:(0,W.Q4)(t.chainId),client:e}),n=await r(t),c=await(0,L.B)(i,n);return(0,P.E)({chainId:t.chainId,client:e,contractAddress:null!==(a=t.to)&&void 0!==a?a:void 0,ecosystem:s,gasPrice:t.gasPrice,transactionHash:c,walletAddress:o,walletType:"inApp"}),{transactionHash:c}},async signAuthorization(a){const i=await async function(e){let{client:t,payload:a,storage:i}=e;const o=await i.getAuthCookie(),s=i.ecosystem,r=(0,c.KI)(t,s);if(!o)throw new Error("No auth token found when signing message");const l={address:a.address,chainId:a.chainId,nonce:Number(a.nonce)},u=await r("".concat((0,n.Wg)("inAppWallet"),"/api/v1/enclave-wallet/sign-authorization"),{body:(0,d.A)(l),headers:{Authorization:"Bearer embedded-wallet-token:".concat(o),"Content-Type":"application/json","x-thirdweb-client-id":t.clientId},method:"POST"});if(!u.ok)throw new Error("Failed to sign message - ".concat(u.status," ").concat(u.statusText));return await u.json()}({client:e,payload:a,storage:t});return{address:(0,j.bv)(i.address),chainId:Number.parseInt(i.chainId),nonce:BigInt(i.nonce),r:BigInt(i.r),s:BigInt(i.s),yParity:Number.parseInt(i.yParity)}},async signMessage(a){let{message:i,originalMessage:o,chainId:s}=a;const r="string"===typeof i?{chainId:s,isRaw:!1,message:i,originalMessage:o}:{chainId:s,isRaw:!0,message:"string"===typeof i.raw?i.raw:(0,S.My)(i.raw),originalMessage:o},{signature:l}=await async function(e){let{client:t,payload:{message:a,isRaw:i,originalMessage:o,chainId:s},storage:r}=e;const l=await r.getAuthCookie(),u=r.ecosystem,h=(0,c.KI)(t,u);if(!l)throw new Error("No auth token found when signing message");const g=await h("".concat((0,n.Wg)("inAppWallet"),"/api/v1/enclave-wallet/sign-message"),{body:(0,d.A)({messagePayload:{chainId:s,isRaw:i,message:a,originalMessage:o}}),headers:{Authorization:"Bearer embedded-wallet-token:".concat(l),"Content-Type":"application/json","x-thirdweb-client-id":t.clientId},method:"POST"});if(!g.ok)throw new Error("Failed to sign message - ".concat(g.status," ").concat(g.statusText));return await g.json()}({client:e,payload:r,storage:t});return l},async signTransaction(e){if(!e.chainId)throw new Error("chainId required in tx to sign");return r((0,i.A)({chainId:e.chainId},e))},async signTypedData(a){const o=(0,x.y)(a),{signature:s}=await async function(e){let{client:t,payload:a,storage:o}=e;const s=await o.getAuthCookie(),r=o.ecosystem,l=(0,c.KI)(t,r);if(!s)throw new Error("No auth token found when signing typed data");const u=await l("".concat((0,n.Wg)("inAppWallet"),"/api/v1/enclave-wallet/sign-typed-data"),{body:(0,d.A)((0,i.A)({},a)),headers:{Authorization:"Bearer embedded-wallet-token:".concat(s),"Content-Type":"application/json","x-thirdweb-client-id":t.clientId},method:"POST"});if(!u.ok)throw new Error("Failed to sign typed data - ".concat(u.status," ").concat(u.statusText));return await u.json()}({client:e,payload:o,storage:t});return s},sendCalls:async e=>{const{inAppWalletSendCalls:t}=await a.e(39858).then(a.bind(a,17477)),i=e.calls[0];if(!i)throw new Error("No calls to send");const n=i.client,o=i.chain||e.chain;return{chain:o,client:n,id:await t({account:l,calls:e.calls,chain:o})}},getCallsStatus:async e=>{const{inAppWalletGetCallsStatus:t}=await a.e(39858).then(a.bind(a,17477));return t(e)},getCapabilities:async e=>{var t;return{[null!==(t=e.chainId)&&void 0!==t?t:1]:{atomic:{status:"unsupported"},paymasterService:{supported:!1}}}}};return l}}function D(e){return void 0===e||(0,O.q)(e)?e:(0,E.nj)(e)}var U=a(387),B=a(62600);const F={backgroundColor:"transparent",border:"none",colorScheme:"light",display:"none",height:"100%",pointerEvents:"all",position:"fixed",right:"0px",top:"0px",width:"100%",zIndex:"2147483646"},M=new Map;class z{constructor(e){let{link:t,baseUrl:a,iframeId:n,container:o,onIframeInitialize:s,localStorage:r,clientId:c,ecosystem:l}=e;if(Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.localStorage=r,this.clientId=c,this.ecosystem=l,this.iframeBaseUrl=a,"undefined"===typeof document)return;o=null!==o&&void 0!==o?o:document.body;let d=document.getElementById(n);const u=new URL(t);if(!d||d.src!==u.href){d=document.createElement("iframe");const e=(0,i.A)({},F);Object.assign(d.style,e),d.setAttribute("id",n),d.setAttribute("fetchpriority","high"),o.appendChild(d),d.src=u.href;const t=e=>{if("ewsIframeLoaded"===e.data.eventType){if(window.removeEventListener("message",t),!d)return void console.warn("thirdweb iFrame not found");this.onIframeLoadHandler(d,s)()}};window.addEventListener("message",t)}this.iframe=d}async onIframeLoadedInitVariables(){var e,t;return{authCookie:await this.localStorage.getAuthCookie(),clientId:this.clientId,deviceShareStored:await this.localStorage.getDeviceShare(),ecosystemId:null===(e=this.ecosystem)||void 0===e?void 0:e.id,partnerId:null===(t=this.ecosystem)||void 0===t?void 0:t.partnerId,walletUserId:await this.localStorage.getWalletUserId()}}onIframeLoadHandler(e,t){return async()=>{var a;const i=new MessageChannel,n=new Promise((a,n)=>{i.port1.onmessage=o=>{const{data:s}=o;i.port1.close(),s.success||n(new Error(s.error)),M.set(e.src,!0),t&&t(),a(!0)}});null===e||void 0===e||null===(a=e.contentWindow)||void 0===a||a.postMessage({data:await this.onIframeLoadedInitVariables(),eventType:"initIframe"},this.iframeBaseUrl,[i.port2]),await n}}async call(e){var t;let{procedureName:a,params:n,showIframe:o=!1}=e;if(!this.iframe)throw new Error("Iframe not found. You are likely calling this from the backend where the DOM is not available.");for(;!M.get(this.iframe.src);)await(0,B.y)(1e3*this.POLLING_INTERVAL_SECONDS);o&&(this.iframe.style.display="block",await(0,B.y)(5));const s=new MessageChannel,r=new Promise((e,t)=>{s.port1.onmessage=async a=>{const{data:i}=a;s.port1.close(),o&&(await(0,B.y)(100),this.iframe&&(this.iframe.style.display="none")),i.success?e(i.data):t(new Error(i.error))}});return null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage({data:(0,i.A)((0,i.A)({},n),await this.onIframeLoadedInitVariables()),eventType:a},this.iframeBaseUrl,[s.port2]),r}destroy(){this.iframe&&M.delete(this.iframe.src)}}class K extends z{constructor(e){let{clientId:t,baseUrl:a,ecosystem:i}=e;super({baseUrl:a,clientId:t,container:"undefined"===typeof document?void 0:document.body,ecosystem:i,iframeId:G+((null===i||void 0===i?void 0:i.id)||""),link:Q({baseUrl:a,clientId:t,ecosystem:i,path:U.CW}).href,localStorage:new f.t({clientId:t,ecosystem:i,storage:r.n})}),this.clientId=t,this.ecosystem=i}}function Q(e){let{clientId:t,baseUrl:a,path:i,ecosystem:n,queryParams:o}=e;const s=new URL("".concat(i),a);if(o)for(const c of Object.keys(o)){var r;s.searchParams.set(c,(null===(r=o[c])||void 0===r?void 0:r.toString())||"")}return s.searchParams.set("clientId",t),void 0!==(null===n||void 0===n?void 0:n.partnerId)&&s.searchParams.set("partnerId",n.partnerId),void 0!==(null===n||void 0===n?void 0:n.id)&&s.searchParams.set("ecosystemId",n.id),s}const G="thirdweb-in-app-wallet-iframe";class q{constructor(e){let{baseUrl:t,querier:a,preLogin:i,postLogin:n,client:o,ecosystem:s}=e;Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=t,this.LoginQuerier=a,this.preLogin=i,this.postLogin=n,this.client=o,this.ecosystem=s}async sendEmailLoginOtp(e){let{email:t}=e;return await this.LoginQuerier.call({params:{email:t},procedureName:"sendThirdwebEmailLoginOtp"})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return await this.LoginQuerier.call({params:{phoneNumber:t},procedureName:"sendThirdwebSmsLoginOtp"})}}class _ extends q{async authenticateWithModal(){return this.LoginQuerier.call({params:void 0,procedureName:"loginWithThirdwebModal",showIframe:!0})}async loginWithModal(){await this.preLogin();const e=await this.authenticateWithModal();return this.postLogin(e)}async authenticateWithIframe(e){let{email:t}=e;return this.LoginQuerier.call({params:{email:t},procedureName:"loginWithThirdwebModal",showIframe:!0})}async loginWithIframe(e){let{email:t}=e;await this.preLogin();const a=await this.authenticateWithIframe({email:t});return this.postLogin(a)}async authenticateWithCustomJwt(e){let{encryptionKey:t,jwt:a}=e;if(!t||0===t.length)throw new Error("Encryption key is required for custom jwt auth");return this.LoginQuerier.call({params:{encryptionKey:t,jwt:a},procedureName:"loginWithCustomJwt"})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:a}=e;if(!t||0===t.length)throw new Error("Encryption key is required for custom jwt auth");await this.preLogin();const i=await this.authenticateWithCustomJwt({encryptionKey:t,jwt:a});return this.postLogin(i)}async authenticateWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:a}=e;return this.LoginQuerier.call({params:{encryptionKey:t,payload:a},procedureName:"loginWithCustomAuthEndpoint"})}async loginWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:a}=e;if(!t||0===t.length)throw new Error("Encryption key is required for custom auth");await this.preLogin();const i=await this.authenticateWithCustomAuthEndpoint({encryptionKey:t,payload:a});return this.postLogin(i)}async authenticateWithEmailOtp(e){let{email:t,otp:a,recoveryCode:i}=e;return this.LoginQuerier.call({params:{email:t,otp:a,recoveryCode:i},procedureName:"verifyThirdwebEmailLoginOtp"})}async loginWithEmailOtp(e){let{email:t,otp:a,recoveryCode:i}=e;const n=await this.authenticateWithEmailOtp({email:t,otp:a,recoveryCode:i});return this.postLogin(n)}async authenticateWithSmsOtp(e){let{phoneNumber:t,otp:a,recoveryCode:i}=e;return this.LoginQuerier.call({params:{otp:a,phoneNumber:t,recoveryCode:i},procedureName:"verifyThirdwebSmsLoginOtp"})}async loginWithSmsOtp(e){let{phoneNumber:t,otp:a,recoveryCode:i}=e;const n=await this.authenticateWithSmsOtp({otp:a,phoneNumber:t,recoveryCode:i});return this.postLogin(n)}}class R{constructor(e){let{client:t,querier:a,onAuthSuccess:i,ecosystem:n,baseUrl:o,localStorage:s}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=n,this.AuthQuerier=a,this.localStorage=s,this.onAuthSuccess=i,this.BaseLogin=new _({baseUrl:o,client:t,ecosystem:n,postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},querier:a})}async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:a}=e;t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString);return await this.onAuthSuccess({storedToken:t,walletDetails:a})}async loginWithAuthToken(e,t){var a;"Backend"!==e.storedToken.authProvider&&await this.preLogin();const i=await l({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});if(!i)throw new Error("Cannot login, no user found for auth token");if(i.wallets.length>0&&"enclave"===(null===(a=i.wallets[0])||void 0===a?void 0:a.type))return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:i.wallets[0].address}});if(0===i.wallets.length){const t=await async function(e){let{client:t,ecosystem:a,authToken:i}=e;const o=(0,c.KI)(t,a),s=await o("".concat((0,n.Wg)("inAppWallet"),"/api/v1/enclave-wallet/generate"),{headers:{Authorization:"Bearer embedded-wallet-token:".concat(i),"Content-Type":"application/json","x-thirdweb-client-id":t.clientId},method:"POST"});if(!s.ok)throw new Error("Failed to generate wallet - ".concat(s.status," ").concat(s.statusText));const{wallet:r}=await s.json();return r}({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:t.address}})}const o=await this.AuthQuerier.call({params:{recoveryCode:t,storedToken:e.storedToken},procedureName:"loginWithStoredTokenDetails"});return this.postLogin(o)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async authenticateWithModal(){return this.BaseLogin.authenticateWithModal()}async loginWithIframe(e){return this.BaseLogin.loginWithIframe(e)}async authenticateWithIframe(e){return this.BaseLogin.authenticateWithIframe(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async authenticateWithCustomJwt(e){return this.BaseLogin.authenticateWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async authenticateWithCustomAuthEndpoint(e){return this.BaseLogin.authenticateWithCustomAuthEndpoint(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return this.BaseLogin.sendSmsLoginOtp({phoneNumber:t})}async loginWithEmailOtp(e){return await this.preLogin(),this.BaseLogin.loginWithEmailOtp(e)}async authenticateWithEmailOtp(e){return this.BaseLogin.authenticateWithEmailOtp(e)}async loginWithSmsOtp(e){return await this.preLogin(),this.BaseLogin.loginWithSmsOtp(e)}async authenticateWithSmsOtp(e){return this.BaseLogin.authenticateWithSmsOtp(e)}async logout(){const e=await this.localStorage.removeAuthCookie(),t=await this.localStorage.removeWalletUserId();return{success:e||t}}}var V=a(9142);const J=async e=>{const{client:t,ecosystem:a}=e,i=(0,v.K)({authOption:e.strategy,client:e.client,ecosystem:e.ecosystem}),n={"Content-Type":"application/json","x-client-id":t.clientId};null!==a&&void 0!==a&&a.id&&(n["x-ecosystem-id"]=a.id),null!==a&&void 0!==a&&a.partnerId&&(n["x-ecosystem-partner-id"]=a.partnerId);const o=(()=>{switch(e.strategy){case"email":return{code:e.verificationCode,email:e.email};case"phone":return{code:e.verificationCode,phone:e.phoneNumber}}})(),s=await fetch(i,{body:(0,d.A)(o),headers:n,method:"POST"});if(!s.ok)throw new Error("Failed to verify verification code");return await s.json()};class H{constructor(e){let{client:t,ecosystem:a,querier:i,localStorage:n}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=a,this.walletManagerQuerier=i,this.localStorage=n}async postWalletSetUp(e){e.deviceShareStored&&await this.localStorage.saveDeviceShare(e.deviceShareStored,e.storedToken.authDetails.userWalletId)}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({params:void 0,procedureName:"getUserStatus"});return"Logged In, Wallet Initialized"===e.status?(0,i.A)((0,i.A)({status:"Logged In, Wallet Initialized"},e.user),{},{account:await this.getAccount()}):"Logged In, New Device"===e.status?(0,i.A)({status:"Logged In, New Device"},e.user):"Logged In, Wallet Uninitialized"===e.status?(0,i.A)({status:"Logged In, Wallet Uninitialized"},e.user):{status:e.status}}async getAccount(){var e;const t=this.walletManagerQuerier,a=this.client,o=null===(e=this.ecosystem)||void 0===e?void 0:e.partnerId,{address:s}=await t.call({params:void 0,procedureName:"getAddress"}),r=async e=>{var a;const i={chainId:e.chainId,data:e.data,gasLimit:e.gas,nonce:e.nonce,to:null!==(a=e.to)&&void 0!==a?a:void 0,value:e.value};e.maxFeePerGas?(i.accessList=e.accessList,i.maxFeePerGas=e.maxFeePerGas,i.maxPriorityFeePerGas=e.maxPriorityFeePerGas,i.type=2):(i.gasPrice=e.gasPrice,i.type=0);const s=(0,n.JD)().rpc,{signedTransaction:r}=await t.call({params:{chainId:e.chainId,partnerId:o,rpcEndpoint:"https://".concat(e.chainId,".").concat(s),transaction:i},procedureName:"signTransaction"});return r};return{address:(0,j.bv)(s),async sendTransaction(e){var t;const i=(0,C.getRpcClient)({chain:(0,W.Q4)(e.chainId),client:a}),n=await r(e),o=await(0,L.B)(i,n);return(0,P.E)({chainId:e.chainId,client:a,contractAddress:null!==(t=e.to)&&void 0!==t?t:void 0,gasPrice:e.gasPrice,transactionHash:o,walletAddress:s,walletType:"inApp"}),{transactionHash:o}},async signMessage(e){let{message:a}=e;const i="string"===typeof a?a:a.raw instanceof Uint8Array?a.raw:(0,E.IQ)(a.raw),{signedMessage:n}=await t.call({params:{chainId:1,message:i,partnerId:o},procedureName:"signMessage"});return n},async signTransaction(e){if(!e.chainId)throw new Error("chainId required in tx to sign");return r((0,i.A)((0,i.A)({},e),{},{chainId:e.chainId}))},async signTypedData(e){var a;const s=(0,x.y)(e);null!==(a=s.types)&&void 0!==a&&a.EIP712Domain&&(s.types.EIP712Domain=void 0);const r=s.domain,c=null===r||void 0===r?void 0:r.chainId,l=null!==r&&void 0!==r&&r.verifyingContract?{verifyingContract:null===r||void 0===r?void 0:r.verifyingContract}:{},d=(0,i.A)((0,i.A)({},l),{},{name:null===r||void 0===r?void 0:r.name,version:null===r||void 0===r?void 0:r.version});c&&(d.chainId=c);const u=(0,n.JD)().rpc,{signedTypedData:h}=await t.call({params:{chainId:Number.parseInt(BigInt(c||1).toString()),domain:d,message:s.message,partnerId:o,rpcEndpoint:"https://".concat(c,".").concat(u),types:s.types},procedureName:"signTypedDataV4"});return h}}}}class Y{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}constructor(e){let{client:t,onAuthSuccess:a,ecosystem:i,passkeyDomain:o,storage:s}=e;if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passkeyDomain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(t.clientId))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");const r=(0,n.Wg)("inAppWallet");this.client=t,this.ecosystem=i,this.passkeyDomain=o,this.storage=new f.t({clientId:t.clientId,ecosystem:i,storage:null!==s&&void 0!==s?s:Z()}),this.querier=new K({baseUrl:r,clientId:t.clientId,ecosystem:i}),this.auth=new R({baseUrl:r,client:t,ecosystem:i,localStorage:this.storage,onAuthSuccess:async e=>{if(null===a||void 0===a||a(e),"sharded"===e.storedToken.authDetails.walletType){await this.querier.call({params:{storedToken:e.storedToken},procedureName:"migrateFromShardToEnclave"})||console.warn("Failed to migrate from sharded to enclave wallet, continuing with sharded wallet")}if(this.wallet=await this.initializeWallet(e.storedToken.cookieString),!this.wallet)throw new Error("Failed to initialize wallet");const t="deviceShareStored"in e.walletDetails?e.walletDetails.deviceShareStored:void 0;return await this.wallet.postWalletSetUp({deviceShareStored:t,storedToken:e.storedToken}),this.wallet instanceof H&&await this.querier.call({params:{authCookie:e.storedToken.cookieString,clientId:this.client.clientId,deviceShareStored:"deviceShareStored"in e.walletDetails?e.walletDetails.deviceShareStored:null,ecosystemId:null===i||void 0===i?void 0:i.id,partnerId:null===i||void 0===i?void 0:i.partnerId,walletUserId:e.storedToken.authDetails.userWalletId},procedureName:"initIframe"}),{user:{account:await this.wallet.getAccount(),authDetails:e.storedToken.authDetails,status:"Logged In, Wallet Initialized",walletAddress:e.walletDetails.walletAddress}}},querier:this.querier})}async initializeWallet(e){var t;const a=await this.storage.getAuthCookie();if(!e&&null===a)throw new Error("No auth token provided and no stored auth token found to initialize the wallet");const i=await l({authToken:e||a,client:this.client,ecosystem:this.ecosystem});if(!i)throw new Error("Cannot initialize wallet, no user logged in");if(0===i.wallets.length)throw new Error("Cannot initialize wallet, this user does not have a wallet generated yet");return"enclave"===(null===(t=i.wallets[0])||void 0===t?void 0:t.type)?new N({address:i.wallets[0].address,client:this.client,ecosystem:this.ecosystem,storage:this.storage}):new H({client:this.client,ecosystem:this.ecosystem,localStorage:this.storage,querier:this.querier})}async getUser(){if(!this.wallet){const e=await this.storage.getAuthCookie();if(!e)return{status:"Logged Out"};this.wallet=await this.initializeWallet(e)}if(!this.wallet)throw new Error("Wallet not initialized");return await this.wallet.getUserWalletStatus()}getAccount(){if(!this.wallet)throw new Error("Wallet not initialized");return this.wallet.getAccount()}async preAuthenticate(e){return(async e=>{const{client:t,ecosystem:a}=e,i=(0,v.f)({authOption:e.strategy,client:t,ecosystem:a}),n={"Content-Type":"application/json","x-client-id":t.clientId};null!==a&&void 0!==a&&a.id&&(n["x-ecosystem-id"]=a.id),null!==a&&void 0!==a&&a.partnerId&&(n["x-ecosystem-partner-id"]=a.partnerId);const o=(()=>{switch(e.strategy){case"email":return{email:e.email};case"phone":return{phone:e.phoneNumber}}})(),s=await fetch(i,{body:(0,d.A)(o),headers:n,method:"POST"});if(!s.ok)throw new Error("Failed to send verification code");return await s.json()})((0,i.A)((0,i.A)({},e),{},{client:this.client,ecosystem:this.ecosystem}))}async authenticateWithRedirect(e,t,a){return(0,V.N)({authOption:e,client:this.client,ecosystem:this.ecosystem,mode:t,redirectUrl:a})}async loginWithAuthToken(e,t){return this.auth.loginWithAuthToken(e,t)}async authenticate(e){const t=e.strategy;switch(t){case"email":case"phone":return J((0,i.A)((0,i.A)({},e),{},{client:this.client,ecosystem:this.ecosystem}));case"auth_endpoint":return async function(e){const t=(0,c.KI)(e.client,e.ecosystem),a=await t(m,{body:(0,d.A)({developerClientId:e.client.clientId,payload:e.payload}),headers:{"Content-Type":"application/json"},method:"POST"});if(!a.ok){const e=await a.json();throw new Error("Custom auth endpoint authentication error: ".concat(e.message))}try{const{verifiedToken:e}=await a.json();return{storedToken:e}}catch(i){throw new Error(y("Malformed response from post auth_endpoint authentication",i))}}({client:this.client,ecosystem:this.ecosystem,payload:e.payload});case"jwt":return async function(e){const t=(0,c.KI)(e.client,e.ecosystem),a=await t(w,{body:(0,d.A)({developerClientId:e.client.clientId,jwt:e.jwt}),headers:{"Content-Type":"application/json"},method:"POST"});if(!a.ok){const e=await a.json();throw new Error("JWT authentication error: ".concat(e.message))}try{const{verifiedToken:e}=await a.json();return{storedToken:e}}catch(i){throw new Error(y("Malformed response from post jwt authentication",i))}}({client:this.client,ecosystem:this.ecosystem,jwt:e.jwt});case"passkey":return this.passkeyAuth(e);case"iframe_email_verification":return this.auth.authenticateWithIframe({email:e.email});case"iframe":return this.auth.authenticateWithModal();case"apple":case"facebook":case"google":case"telegram":case"github":case"twitch":case"farcaster":case"line":case"x":case"tiktok":case"steam":case"coinbase":case"discord":return(0,V.x)({authOption:t,client:this.client,closeOpenedWindow:e.closeOpenedWindow,ecosystem:this.ecosystem,openedWindow:e.openedWindow});case"guest":return async function(e){let t=await e.storage.getGuestSessionId();t||(t=(0,b.O)(32),e.storage.saveGuestSessionId(t));const a=(0,c.KI)(e.client,e.ecosystem),i=(0,v.K)({authOption:"guest",client:e.client,ecosystem:e.ecosystem}),n=await a("".concat(i),{body:(0,d.A)({sessionId:t}),headers:{"Content-Type":"application/json"},method:"POST"});if(!n.ok){const e=await n.text();throw new Error("Failed to generate guest account: ".concat(n.status," ").concat(n.statusText," ").concat(e))}return await n.json()}({client:this.client,ecosystem:this.ecosystem,storage:this.storage});case"backend":return async function(e){const t=(0,c.KI)(e.client,e.ecosystem),a=(0,v.f)({authOption:"backend",client:e.client,ecosystem:e.ecosystem}),i=await t("".concat(a),{body:(0,d.A)({walletSecret:e.walletSecret}),headers:{"Content-Type":"application/json"},method:"POST"});if(!i.ok){const e=await i.text();throw new Error("Failed to generate backend account: ".concat(e))}return await i.json()}({client:this.client,ecosystem:this.ecosystem,walletSecret:e.walletSecret});case"wallet":return async function(e){const{wallet:t,client:a,ecosystem:i}=e,n=(0,W.Q4)(1),o=t.getAccount()||await t.connect({chain:n,client:a}),s=(0,c.KI)(a,i),r=await(async()=>{const t=(0,v.f)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),a=await s("".concat(t,"&address=").concat(o.address,"&chainId=").concat(n.id));if(!a.ok)throw new Error("Failed to generate SIWE login payload");return await a.json()})(),{signature:l}=await(0,T.signLoginPayload)({account:o,payload:r});return await(async()=>{const t=(0,v.K)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),a=await s("".concat(t,"&signature=").concat(l,"&payload=").concat(encodeURIComponent(r)),{body:(0,d.A)({payload:r,signature:l}),headers:{"Content-Type":"application/json"},method:"POST"});if(!a.ok)throw new Error("Failed to verify SIWE signature");return await a.json()})()}({client:this.client,ecosystem:this.ecosystem,wallet:e.wallet})}}async connect(e){const t=e.strategy;switch(t){case"auth_endpoint":case"jwt":{const t=await this.authenticate(e);return await this.loginWithAuthToken(t,e.encryptionKey)}case"iframe_email_verification":return this.auth.loginWithIframe({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{const t=await this.passkeyAuth(e);return this.loginWithAuthToken(t)}case"backend":case"phone":case"email":case"wallet":case"apple":case"facebook":case"google":case"farcaster":case"telegram":case"github":case"line":case"x":case"tiktok":case"guest":case"coinbase":case"twitch":case"steam":case"discord":{const t=await this.authenticate(e);return await this.auth.loginWithAuthToken(t)}default:!function(e,t){throw new Error(null!==t&&void 0!==t?t:"Invalid param: ".concat(e))}(t)}}async logout(){return await this.auth.logout()}async passkeyAuth(e){var t,n;const{PasskeyWebClient:o}=await a.e(89199).then(a.bind(a,89199)),{passkeyName:s,storeLastUsedPasskey:r=!0}=e,l=new o,u=this.storage;var h,g;return"sign-up"===e.type?A({client:this.client,ecosystem:this.ecosystem,passkeyClient:l,rp:{id:null!==(h=this.passkeyDomain)&&void 0!==h?h:window.location.hostname,name:null!==(g=this.passkeyDomain)&&void 0!==g?g:window.document.title},storage:r?u:void 0,username:s}):async function(e){var t,a,n,o;if(!e.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const s=(0,c.KI)(e.client,e.ecosystem),[r,l]=await Promise.all([s(k("sign-in")).then(e=>e.json()),null===(t=e.storage)||void 0===t?void 0:t.getPasskeyCredentialId()]);if(!r.challenge)throw new Error("No challenge received");const u=r.challenge,h=await e.passkeyClient.authenticate({challenge:u,credentialId:null!==l&&void 0!==l?l:void 0,rp:e.rp}),g={};null!==(a=e.ecosystem)&&void 0!==a&&a.partnerId&&(g["x-ecosystem-partner-id"]=e.ecosystem.partnerId),null!==(n=e.ecosystem)&&void 0!==n&&n.id&&(g["x-ecosystem-id"]=e.ecosystem.id);const p=await s(I(),{body:(0,d.A)({authenticatorData:h.authenticatorData,clientData:h.clientData,credentialId:h.credentialId,origin:h.origin,rpId:e.rp.id,serverVerificationId:r.serverVerificationId,signature:h.signature,type:"sign-in"}),headers:(0,i.A)({"Content-Type":"application/json"},g),method:"POST"}),w=await p.json();var m;if(!w||!w.storedToken)throw new Error("Error verifying passkey: ".concat(null!==(m=w.message)&&void 0!==m?m:"unknown error"));return await(null===(o=e.storage)||void 0===o?void 0:o.savePasskeyCredentialId(h.credentialId)),w}({client:this.client,ecosystem:this.ecosystem,passkeyClient:l,rp:{id:null!==(t=this.passkeyDomain)&&void 0!==t?t:window.location.hostname,name:null!==(n=this.passkeyDomain)&&void 0!==n?n:window.document.title},storage:r?u:void 0})}async linkProfile(e){const{storedToken:t}=await this.authenticate(e);return await async function(e){let{client:t,ecosystem:a,tokenToLink:i,storage:o}=e;const s=(0,c.KI)(t,a),r=(0,n.Wg)("inAppWallet"),l=await o.getAuthCookie();if(!l)throw new Error("Failed to link account, no user logged in");const u={Authorization:"Bearer iaw-auth-token:".concat(l),"Content-Type":"application/json"},h=await s("".concat(r,"/api/2024-05-05/account/connect"),{body:(0,d.A)({accountAuthTokenToConnect:i}),headers:u,method:"POST"});if(!h.ok){const e=await h.json();throw new Error(e.message||"Failed to link account.")}const{linkedAccounts:g}=await h.json();return null!==g&&void 0!==g?g:[]}({client:e.client,ecosystem:e.ecosystem||this.ecosystem,storage:this.storage,tokenToLink:t.cookieString})}async unlinkProfile(e,t){return await async function(e){let{client:t,ecosystem:a,profileToUnlink:i,allowAccountDeletion:o=!1,storage:s}=e;const r=(0,c.KI)(t,a),l=(0,n.Wg)("inAppWallet"),u=await s.getAuthCookie();if(!u)throw new Error("Failed to unlink account, no user logged in");const h={Authorization:"Bearer iaw-auth-token:".concat(u),"Content-Type":"application/json"},g=await r("".concat(l,"/api/2024-05-05/account/disconnect"),{body:(0,d.A)({allowAccountDeletion:o,details:i.details,type:i.type}),headers:h,method:"POST"});if(!g.ok){const e=await g.json();throw new Error(e.message||"Failed to unlink account.")}const{linkedAccounts:p}=await g.json();return null!==p&&void 0!==p?p:[]}({allowAccountDeletion:t,client:this.client,ecosystem:this.ecosystem,profileToUnlink:e,storage:this.storage})}async getProfiles(){return async function(e){let{client:t,ecosystem:a,storage:i}=e;const o=(0,c.KI)(t,a),s=(0,n.Wg)("inAppWallet"),r=await i.getAuthCookie();if(!r)throw new Error("Failed to get linked accounts, no user logged in");const l={Authorization:"Bearer iaw-auth-token:".concat(r),"Content-Type":"application/json"},d=await o("".concat(s,"/api/2024-05-05/accounts"),{headers:l,method:"GET"});if(!d.ok){const e=await d.json();throw new Error(e.message||"Failed to get linked accounts.")}const{linkedAccounts:u}=await d.json();return null!==u&&void 0!==u?u:[]}({client:this.client,ecosystem:this.ecosystem,storage:this.storage})}}function Z(){return"undefined"!==typeof window&&window.localStorage?r.n:s}},93431:(e,t,a)=>{function i(e){let t=["".concat(e.domain," wants you to sign in with your ").concat("Ethereum"," account:"),e.address].join("\n");t=[t,e.statement].join("\n\n"),e.statement&&(t+="\n");const a=[];if(e.uri){const t="URI: ".concat(e.uri);a.push(t)}const i="Version: ".concat(e.version);if(a.push(i),e.chain_id){const t="Chain ID: ".concat(e.chain_id)||0;a.push(t)}const n="Nonce: ".concat(e.nonce);a.push(n);const o="Issued At: ".concat(e.issued_at);a.push(o);const s="Expiration Time: ".concat(e.expiration_time);if(a.push(s),e.invalid_before){const t="Not Before: ".concat(e.invalid_before);a.push(t)}e.resources&&a.push(["Resources:",...e.resources.map(e=>"- ".concat(e))].join("\n"));return[t,a.join("\n")].join("\n")}async function n(e){const{payload:t,account:a}=e;return{payload:t,signature:await a.signMessage({message:i(t)})}}a.r(t),a.d(t,{signLoginPayload:()=>n})}}]);
//# sourceMappingURL=75211.2b9a40b6.chunk.js.map