"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[55384,86511],{55384:(t,e,n)=>{n.d(e,{relayEngineTransaction:()=>l});var a=n(38736),r=n(77717),o=n(86511),s=n(83583);const i=[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"gas",type:"uint256"},{name:"nonce",type:"uint256"},{name:"data",type:"bytes"}],c=[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"gas",type:"uint256"},{name:"nonce",type:"uint256"},{name:"data",type:"bytes"},{name:"chainid",type:"uint256"}];async function l(t){const{message:e,messageType:n,signature:s}=await async function(t){let{account:e,serializableTransaction:n,transaction:r,gasless:s}=t;const l=(0,a.P)({address:s.relayerForwarderAddress,chain:r.chain,client:r.client}),u=await(0,o.readContract)({contract:l,method:"function getNonce(address) view returns (uint256)",params:[e.address]}),[d,f]=await(async(t,a)=>{if(!n.to)throw new Error("engine transactions must have a 'to' address");if(!n.gas)throw new Error("engine transactions must have a 'gas' value");if(!n.data)throw new Error("engine transactions must have a 'data' value");if(s.experimentalChainlessSupport){const t={chainid:BigInt(r.chain.id),data:n.data,from:e.address,gas:n.gas,nonce:u,to:n.to,value:0n};return[await e.signTypedData({domain:{name:"GSNv2 Forwarder",verifyingContract:l.address,version:"0.0.1"},message:t,primaryType:"ForwardRequest",types:{ForwardRequest:c}}),t]}const o={data:n.data,from:e.address,gas:n.gas,nonce:u,to:n.to,value:0n};return[await e.signTypedData({domain:{chainId:r.chain.id,name:null!==(t=s.domainName)&&void 0!==t?t:"GSNv2 Forwarder",verifyingContract:l.address,version:null!==(a=s.domainVersion)&&void 0!==a?a:"0.0.1"},message:o,primaryType:"ForwardRequest",types:{ForwardRequest:i}}),o]})();return{message:f,messageType:"forward",signature:d}}(t),l=await fetch(t.gasless.relayerUrl,{body:(0,r.A)({forwarderAddress:t.gasless.relayerForwarderAddress,request:e,signature:s,type:n}),headers:{"Content-Type":"application/json"},method:"POST"});if(!l.ok)throw new Error("Failed to send transaction: ".concat(await l.text()));const d=await l.json();if(!d.result)throw new Error("Relay transaction failed: ".concat(d.message));const f=d.result.queueId,h=Date.now()+6e4;for(;Date.now()<h;){const e=await u({options:t,queueId:f});if(e)return{chain:t.transaction.chain,client:t.transaction.client,transactionHash:e.transactionHash};await new Promise(t=>setTimeout(t,1e3))}throw new Error("Failed to find relayed transaction after ".concat(6e4,"ms"))}async function u(t){const{options:e,queueId:n}=t,a=e.gasless.relayerUrl.split("/relayer/")[0],r=await fetch("".concat(a,"/transaction/status/").concat(n),{method:"GET"}),o=await r.json();if(!r.ok)return null;const i=o.result;if(!i)return null;switch(i.status){case"errored":throw new Error("Transaction errored with reason: ".concat(i.errorMessage));case"cancelled":throw new Error("Transaction execution cancelled.");case"mined":return await(0,s.L)({chain:e.transaction.chain,client:e.transaction.client,transactionHash:i.transactionHash});default:return null}}},62600:(t,e,n)=>{function a(t){return new Promise(e=>setTimeout(e,t))}n.d(e,{y:()=>a})},75666:(t,e,n)=>{n.d(e,{l:()=>c});var a=n(8),r=n(67962);var o=n(83213);const s={"0x0":"reverted","0x1":"success"};function i(t){const e=(0,a.A)((0,a.A)({},t),{},{blockNumber:t.blockNumber?BigInt(t.blockNumber):null,contractAddress:t.contractAddress?t.contractAddress:null,cumulativeGasUsed:t.cumulativeGasUsed?BigInt(t.cumulativeGasUsed):null,effectiveGasPrice:t.effectiveGasPrice?BigInt(t.effectiveGasPrice):null,gasUsed:t.gasUsed?BigInt(t.gasUsed):null,logs:t.logs?t.logs.map(t=>function(t){let{args:e,eventName:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.A)((0,a.A)({},t),{},{blockHash:t.blockHash?t.blockHash:null,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,logIndex:t.logIndex?Number(t.logIndex):null,transactionHash:t.transactionHash?t.transactionHash:null,transactionIndex:t.transactionIndex?Number(t.transactionIndex):null},n?{args:e,eventName:n}:{})}(t)):null,to:t.to?t.to:null,transactionIndex:t.transactionIndex?(0,r.ME)(t.transactionIndex):null,status:t.status?s[t.status]:null,type:t.type?o.b4[t.type]||t.type:null});return t.blobGasPrice&&(e.blobGasPrice=BigInt(t.blobGasPrice)),t.blobGasUsed&&(e.blobGasUsed=BigInt(t.blobGasUsed)),e}async function c(t,e){const n=await t({method:"eth_getTransactionReceipt",params:[e.hash]});if(!n)throw new Error("Transaction receipt not found.");return i(n)}},83583:(t,e,n)=>{n.d(e,{L:()=>g});var a=n(75666),r=n(72364),o=n(62600),s=n(3340);const i=5e3,c=1e3,l=500,u=2,d=10;function f(t,e,n,a){let f,h,m=[],w=[],g=!1;const y=(0,r.getRpcClient)({chain:e,client:t});async function p(){if(!g)return;try{const t=await async function(t){const e=await t({method:"eth_blockNumber"});return(0,s.uU)(e)}(y);if(!f||t>f){let e=[];if(f)for(let a=f+1n;a<=t;a++)e.push(BigInt(a));else e=[t];f=t;const n=Date.now();if(h){const t=(n-h)/e.length;w.push(t),w=w.slice(-d)}h=n;for(const t of e)for(const e of m)e(t)}}catch(r){a?a(r):console.error("[watchBlockNumber]: Failed to poll for latest block number: ".concat(r))}const t=function(t){for(;t.length<d;)t.unshift(c);return t.reduce((t,e)=>t+e,0)/t.length}(w),e=Math.max(l,Math.min(i,Math.max(l,t)));await(0,o.y)(e/(null!==n&&void 0!==n?n:u)),p()}return function(t,e){return m.push(t),g||(f=e,g=!0,p()),function(){m=m.filter(e=>e!==t),0===m.length&&(f=void 0,h=void 0,g=!1)}}}const h=new Map;const m=100,w=new Map;function g(t){var e;const{transactionHash:n,chain:o,client:s}=t,i=o.id,c="".concat(i,":tx_").concat(n),l=null!==(e=t.maxBlocksWaitTime)&&void 0!==e?e:m;if(w.has(c))return w.get(c);const u=new Promise((t,e)=>{n||e(new Error("Transaction has no transactionHash to wait for, did you execute it?"));const i=(0,r.getRpcClient)({chain:o,client:s});let c=-1;const u=function(t){const{client:e,chain:n,onNewBlockNumber:a,overPollRatio:r,latestBlockNumber:o,onError:s}=t,i=n.id;let c=h.get(i);return c||(c=f(e,n,r,s),h.set(i,c)),c(a,o)}({chain:o,client:s,onNewBlockNumber:async()=>{if(c++,c>=l)return u(),void e(new Error("Transaction receipt for ".concat(n," not found after ").concat(l," blocks")));try{const e=await(0,a.l)(i,{hash:n});u(),t(e)}catch(r){}}})}).finally(()=>{w.delete(c)});return w.set(c,u),u}},86511:(t,e,n)=>{n.d(e,{readContract:()=>h});var a=n(55907),r=n(60005),o=n(53986),s=n(3340);const i=["blockNumber","blockTag"];var c=n(72364),l=n(71760),u=n(64819),d=n(83423),f=n(9363);async function h(t){const{contract:e,method:n,params:h}=t,[m,w]=await Promise.all([(async()=>{var t;if(Array.isArray(n))return n;if((0,f.d)(n))return(0,u.v)(n);if("function"===typeof n)return(0,u.v)(await n(e));if("string"===typeof n&&n.startsWith("function ")){const t=(0,a.$)(n);if("function"===t.type)return(0,u.v)(t);throw new Error('"method" passed is not of type "function"')}if(e.abi&&(null===(t=e.abi)||void 0===t?void 0:t.length)>0){var r;const t=null===(r=e.abi)||void 0===r?void 0:r.find(t=>"function"===t.type&&t.name===n);if(t)return(0,u.v)(t)}throw new Error('Could not resolve method "'.concat(n,'".'))})(),"function"===typeof h?h():h]);let g;g=0===m[1].length?m[0]:m[0]+(0,l.hd)(m[1],w).slice(2);const y=(0,c.getRpcClient)({chain:e.chain,client:e.client}),p=await async function(t,e){const{blockNumber:n,blockTag:a}=e,r=(0,o.A)(e,i),c=(n?(0,s.cK)(n):void 0)||a||"latest";return await t({method:"eth_call",params:e.stateOverrides?[r,c,(l=e.stateOverrides,Object.fromEntries(Object.entries(l).map(t=>{let[e,n]=t;return[e,{balance:n.balance?(0,s.cK)(n.balance):void 0,code:n.code,nonce:n.nonce?(0,s.cK)(n.nonce):void 0,state:n.state,stateDiff:n.stateDiff}]})))]:[r,c]});var l}(y,{data:g,from:t.from?(0,d.bv)(t.from):void 0,to:e.address}),b=(0,r.n)(m[2],p);return Array.isArray(b)&&1===b.length?b[0]:b}}}]);
//# sourceMappingURL=55384.f5ece3a7.chunk.js.map